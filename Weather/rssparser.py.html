<html>
<head>
  <title>ports//irc/py-supybot-plugins/work/Supybot-plugins-20060723/Weather/rssparser.py</title>
</head>
<body bgcolor="#ffffff" text="#000000">
<pre>
<font color="#008000">&quot;&quot;</font><font color="#008000">&quot;Universal feed parser

Handles RSS 0.9x, RSS 1.0, RSS 2.0, CDF, Atom feeds

Visit http://feedparser.org/ for the latest version
Visit http://feedparser.org/docs/ for the latest documentation

Required: Python 2.1 or later
Recommended: Python 2.3 or later
Recommended: CJKCodecs and iconv_codec &lt;http://cjkpython.i18n.org/&gt;
&quot;</font><font color="#008000">&quot;&quot;</font>

<font color="#444444">#__version__ = &quot;pre-3.3-&quot; + &quot;$Revision: 1.9 $&quot;[11:15] + &quot;-cvs&quot;</font>
<font color="#2040a0">__version__</font> <font color="4444FF">=</font> <font color="#008000">&quot;3.3&quot;</font>
<font color="#2040a0">__license__</font> <font color="4444FF">=</font> <font color="#008000">&quot;Python&quot;</font>
<font color="#2040a0">__copyright__</font> <font color="4444FF">=</font> <font color="#008000">&quot;Copyright 2002-4, Mark Pilgrim&quot;</font>
<font color="#2040a0">__author__</font> <font color="4444FF">=</font> <font color="#008000">&quot;Mark Pilgrim &lt;http://diveintomark.org/&gt;&quot;</font>
<font color="#2040a0">__contributors__</font> <font color="4444FF">=</font> <font color="4444FF">[</font><font color="#008000">&quot;Jason Diamond &lt;http://injektilo.org/&gt;&quot;</font>,
                    <font color="#008000">&quot;John Beimler &lt;http://john.beimler.org/&gt;&quot;</font>,
                    <font color="#008000">&quot;Fazal Majid &lt;http://www.majid.info/mylos/weblog/&gt;&quot;</font>,
                    <font color="#008000">&quot;Aaron Swartz &lt;http://aaronsw.com&gt;&quot;</font><font color="4444FF">]</font>
<font color="#2040a0">_debug</font> <font color="4444FF">=</font> <font color="#FF0000">0</font>

<font color="#444444"># HTTP &quot;User-Agent&quot; header to send to servers when downloading feeds.</font>
<font color="#444444"># If you are embedding feedparser in a larger application, you should</font>
<font color="#444444"># change this to your application name and URL.</font>
<font color="#2040a0">USER_AGENT</font> <font color="4444FF">=</font> <font color="#008000">&quot;UniversalFeedParser/%s +http://feedparser.org/&quot;</font> <font color="4444FF">%</font> <font color="#2040a0">__version__</font>

<font color="#444444"># HTTP &quot;Accept&quot; header to send to servers when downloading feeds.  If you don't</font>
<font color="#444444"># want to send an Accept header, set this to None.</font>
<font color="#2040a0">ACCEPT_HEADER</font> <font color="4444FF">=</font> <font color="#008000">&quot;application/atom+xml,application/rdf+xml,application/rss+xml,application/x-netcdf,application/xml;q=0.9,text/xml;q=0.2,*/*;q=0.1&quot;</font>

<font color="#444444"># List of preferred XML parsers, by SAX driver name.  These will be tried first,</font>
<font color="#444444"># but if they're not installed, Python will keep searching through its own list</font>
<font color="#444444"># of pre-installed parsers until it finds one that supports everything we need.</font>
<font color="#2040a0">PREFERRED_XML_PARSERS</font> <font color="4444FF">=</font> <font color="4444FF">[</font><font color="#008000">&quot;drv_libxml2&quot;</font><font color="4444FF">]</font>

<font color="#444444"># If you want feedparser to automatically run HTML markup through HTML Tidy, set</font>
<font color="#444444"># this to 1.  This is off by default because of reports of crashing on some</font>
<font color="#444444"># platforms.  If it crashes for you, please submit a bug report with your OS</font>
<font color="#444444"># platform, Python version, and the URL of the feed you were attempting to parse.</font>
<font color="#444444"># Requires mxTidy &lt;http://www.egenix.com/files/python/mxTidy.html&gt;</font>
<font color="#2040a0">TIDY_MARKUP</font> <font color="4444FF">=</font> <font color="#FF0000">0</font>

<font color="#444444"># ---------- required modules (should come with any Python distribution) ----------</font>
<strong>import</strong> <font color="#2040a0">sgmllib</font>, <font color="#2040a0">re</font>, <font color="#2040a0">sys</font>, <font color="#2040a0">copy</font>, <font color="#2040a0">urlparse</font>, <font color="#2040a0">time</font>, <font color="#2040a0">rfc822</font>, <font color="#2040a0">types</font>, <font color="#2040a0">cgi</font>
<strong>try</strong><font color="4444FF">:</font>
    <strong>from</strong> <font color="#2040a0">cStringIO</font> <strong>import</strong> <font color="#2040a0">StringIO</font> <font color="#2040a0">as</font> <font color="#2040a0">_StringIO</font>
<strong>except</strong><font color="4444FF">:</font>
    <strong>from</strong> <font color="#2040a0">StringIO</font> <strong>import</strong> <font color="#2040a0">StringIO</font> <font color="#2040a0">as</font> <font color="#2040a0">_StringIO</font>

<font color="#444444"># ---------- optional modules (feedparser will work without these, but with reduced functionality) ----------</font>

<font color="#444444"># gzip is included with most Python distributions, but may not be available if you compiled your own</font>
<strong>try</strong><font color="4444FF">:</font>
    <strong>import</strong> <font color="#2040a0">gzip</font>
<strong>except</strong><font color="4444FF">:</font>
    <font color="#2040a0">gzip</font> <font color="4444FF">=</font> <font color="#2040a0">None</font>
<strong>try</strong><font color="4444FF">:</font>
    <strong>import</strong> <font color="#2040a0">zlib</font>
<strong>except</strong><font color="4444FF">:</font>
    <font color="#2040a0">zlib</font> <font color="4444FF">=</font> <font color="#2040a0">None</font>
    
<font color="#444444"># timeoutsocket allows feedparser to time out rather than hang forever on ultra-slow servers.</font>
<font color="#444444"># Python 2.3 now has this functionality available in the standard socket library, so under</font>
<font color="#444444"># 2.3 you don't need to install anything.  But you probably should anyway, because the socket</font>
<font color="#444444"># module is buggy and timeoutsocket is better.</font>
<strong>try</strong><font color="4444FF">:</font>
    <strong>import</strong> <font color="#2040a0">timeoutsocket</font> <font color="#444444"># http://www.timo-tasi.org/python/timeoutsocket.py</font>
    <font color="#2040a0">timeoutsocket</font>.<font color="#2040a0">setDefaultSocketTimeout</font><font color="4444FF">(</font><font color="#FF0000">20</font><font color="4444FF">)</font>
<strong>except</strong> <font color="#2040a0">ImportError</font><font color="4444FF">:</font>
    <strong>import</strong> <font color="#2040a0">socket</font>
    <strong>if</strong> <font color="#2040a0">hasattr</font><font color="4444FF">(</font><font color="#2040a0">socket</font>, <font color="#008000">'setdefaulttimeout'</font><font color="4444FF">)</font><font color="4444FF">:</font>
        <font color="#2040a0">socket</font>.<font color="#2040a0">setdefaulttimeout</font><font color="4444FF">(</font><font color="#FF0000">20</font><font color="4444FF">)</font>
<strong>import</strong> <font color="#2040a0">urllib</font>, <font color="#2040a0">urllib2</font>

<font color="#2040a0">_mxtidy</font> <font color="4444FF">=</font> <font color="#2040a0">None</font>
<strong>if</strong> <font color="#2040a0">TIDY_MARKUP</font><font color="4444FF">:</font>
    <strong>try</strong><font color="4444FF">:</font>
        <strong>from</strong> <font color="#2040a0">mx</font>.<font color="#2040a0">Tidy</font> <strong>import</strong> <font color="#2040a0">Tidy</font> <font color="#2040a0">as</font> <font color="#2040a0">_mxtidy</font>
    <strong>except</strong><font color="4444FF">:</font>
        <strong>pass</strong>

<font color="#444444"># If a real XML parser is available, feedparser will attempt to use it.  feedparser has</font>
<font color="#444444"># been tested with the built-in SAX parser, PyXML, and libxml2.  On platforms where the</font>
<font color="#444444"># Python distribution does not come with an XML parser (such as Mac OS X 10.2 and some</font>
<font color="#444444"># versions of FreeBSD), feedparser will quietly fall back on regex-based parsing.</font>
<strong>try</strong><font color="4444FF">:</font>
    <strong>import</strong> <font color="#2040a0">xml</font>.<font color="#2040a0">sax</font>
    <font color="#2040a0">xml</font>.<font color="#2040a0">sax</font>.<font color="#2040a0">make_parser</font><font color="4444FF">(</font><font color="#2040a0">PREFERRED_XML_PARSERS</font><font color="4444FF">)</font> <font color="#444444"># test for valid parsers</font>
    <strong>from</strong> <font color="#2040a0">xml</font>.<font color="#2040a0">sax</font>.<font color="#2040a0">saxutils</font> <strong>import</strong> <font color="#2040a0">escape</font> <font color="#2040a0">as</font> <font color="#2040a0">_xmlescape</font>
    <font color="#2040a0">_XML_AVAILABLE</font> <font color="4444FF">=</font> <font color="#FF0000">1</font>
<strong>except</strong><font color="4444FF">:</font>
    <font color="#2040a0">_XML_AVAILABLE</font> <font color="4444FF">=</font> <font color="#FF0000">0</font>
<strong>   <font color="ff0000"> def</font><font color="ff0000"> _xmlescape</font><font color="2040a0">(data)</font>:
</strong>        <font color="#2040a0">data</font> <font color="4444FF">=</font> <font color="#2040a0">data</font>.<font color="#2040a0">replace</font><font color="4444FF">(</font><font color="#008000">&quot;&amp;&quot;</font>, <font color="#008000">&quot;&amp;amp;&quot;</font><font color="4444FF">)</font>
        <font color="#2040a0">data</font> <font color="4444FF">=</font> <font color="#2040a0">data</font>.<font color="#2040a0">replace</font><font color="4444FF">(</font><font color="#008000">&quot;&gt;&quot;</font>, <font color="#008000">&quot;&amp;gt;&quot;</font><font color="4444FF">)</font>
        <font color="#2040a0">data</font> <font color="4444FF">=</font> <font color="#2040a0">data</font>.<font color="#2040a0">replace</font><font color="4444FF">(</font><font color="#008000">&quot;&lt;&quot;</font>, <font color="#008000">&quot;&amp;lt;&quot;</font><font color="4444FF">)</font>
        <strong>return</strong> <font color="#2040a0">data</font>

<font color="#444444"># base64 support for Atom feeds that contain embedded binary data</font>
<strong>try</strong><font color="4444FF">:</font>
    <strong>import</strong> <font color="#2040a0">base64</font>, <font color="#2040a0">binascii</font>
<strong>except</strong><font color="4444FF">:</font>
    <font color="#2040a0">base64</font> <font color="4444FF">=</font> <font color="#2040a0">binascii</font> <font color="4444FF">=</font> <font color="#2040a0">None</font>

<font color="#444444"># cjkcodecs and iconv_codec provide support for more character encodings.</font>
<font color="#444444"># Both are available from http://cjkpython.i18n.org/</font>
<strong>try</strong><font color="4444FF">:</font>
    <strong>import</strong> <font color="#2040a0">cjkcodecs</font>.<font color="#2040a0">aliases</font>
<strong>except</strong><font color="4444FF">:</font>
    <strong>pass</strong>
<strong>try</strong><font color="4444FF">:</font>
    <strong>import</strong> <font color="#2040a0">iconv_codec</font>
<strong>except</strong><font color="4444FF">:</font>
    <strong>pass</strong>

<font color="#444444"># ---------- don't touch these ----------</font>
<strong>class</strong> <font color="#2040a0">CharacterEncodingOverride</font><font color="4444FF">(</font><font color="#2040a0">Exception</font><font color="4444FF">)</font><font color="4444FF">:</font> <strong>pass</strong>
<strong>class</strong> <font color="#2040a0">CharacterEncodingUnknown</font><font color="4444FF">(</font><font color="#2040a0">Exception</font><font color="4444FF">)</font><font color="4444FF">:</font> <strong>pass</strong>
<strong>class</strong> <font color="#2040a0">NonXMLContentType</font><font color="4444FF">(</font><font color="#2040a0">Exception</font><font color="4444FF">)</font><font color="4444FF">:</font> <strong>pass</strong>

<font color="#2040a0">sgmllib</font>.<font color="#2040a0">tagfind</font> <font color="4444FF">=</font> <font color="#2040a0">re</font>.<font color="#2040a0">compile</font><font color="4444FF">(</font><font color="#008000">'[a-zA-Z][-_.:a-zA-Z0-9]*'</font><font color="4444FF">)</font>
<font color="#2040a0">sgmllib</font>.<font color="#2040a0">special</font> <font color="4444FF">=</font> <font color="#2040a0">re</font>.<font color="#2040a0">compile</font><font color="4444FF">(</font><font color="#008000">'&lt;!'</font><font color="4444FF">)</font>
<font color="#2040a0">sgmllib</font>.<font color="#2040a0">charref</font> <font color="4444FF">=</font> <font color="#2040a0">re</font>.<font color="#2040a0">compile</font><font color="4444FF">(</font><font color="#008000">'&amp;#(x?[0-9A-Fa-f]+)[^0-9A-Fa-f]'</font><font color="4444FF">)</font>

<font color="#2040a0">SUPPORTED_VERSIONS</font> <font color="4444FF">=</font> <font color="4444FF"><strong>{</strong></font><font color="#008000">''</font><font color="4444FF">:</font> <font color="#008000">'unknown'</font>,
                      <font color="#008000">'rss090'</font><font color="4444FF">:</font> <font color="#008000">'RSS 0.90'</font>,
                      <font color="#008000">'rss091n'</font><font color="4444FF">:</font> <font color="#008000">'RSS 0.91 (Netscape)'</font>,
                      <font color="#008000">'rss091u'</font><font color="4444FF">:</font> <font color="#008000">'RSS 0.91 (Userland)'</font>,
                      <font color="#008000">'rss092'</font><font color="4444FF">:</font> <font color="#008000">'RSS 0.92'</font>,
                      <font color="#008000">'rss093'</font><font color="4444FF">:</font> <font color="#008000">'RSS 0.93'</font>,
                      <font color="#008000">'rss094'</font><font color="4444FF">:</font> <font color="#008000">'RSS 0.94'</font>,
                      <font color="#008000">'rss20'</font><font color="4444FF">:</font> <font color="#008000">'RSS 2.0'</font>,
                      <font color="#008000">'rss10'</font><font color="4444FF">:</font> <font color="#008000">'RSS 1.0'</font>,
                      <font color="#008000">'rss'</font><font color="4444FF">:</font> <font color="#008000">'RSS (unknown version)'</font>,
                      <font color="#008000">'atom01'</font><font color="4444FF">:</font> <font color="#008000">'Atom 0.1'</font>,
                      <font color="#008000">'atom02'</font><font color="4444FF">:</font> <font color="#008000">'Atom 0.2'</font>,
                      <font color="#008000">'atom03'</font><font color="4444FF">:</font> <font color="#008000">'Atom 0.3'</font>,
                      <font color="#008000">'atom'</font><font color="4444FF">:</font> <font color="#008000">'Atom (unknown version)'</font>,
                      <font color="#008000">'cdf'</font><font color="4444FF">:</font> <font color="#008000">'CDF'</font>,
                      <font color="#008000">'hotrss'</font><font color="4444FF">:</font> <font color="#008000">'Hot RSS'</font>
                      <font color="4444FF"><strong>}</strong></font>

<strong>try</strong><font color="4444FF">:</font>
    <font color="#2040a0">UserDict</font> <font color="4444FF">=</font> <font color="#2040a0">dict</font>
<strong>except</strong> <font color="#2040a0">NameError</font><font color="4444FF">:</font>
    <font color="#444444"># Python 2.1 does not have dict</font>
    <strong>from</strong> <font color="#2040a0">UserDict</font> <strong>import</strong> <font color="#2040a0">UserDict</font>
<strong>   <font color="ff0000"> def</font><font color="ff0000"> dict</font><font color="2040a0">(aList)</font>:
</strong>        <font color="#2040a0">rc</font> <font color="4444FF">=</font> <font color="4444FF"><strong>{</strong></font><font color="4444FF"><strong>}</strong></font>
        <strong>for</strong> <font color="#2040a0">k</font>, <font color="#2040a0">v</font> <strong>in</strong> <font color="#2040a0">aList</font><font color="4444FF">:</font>
            <font color="#2040a0">rc</font><font color="4444FF">[</font><font color="#2040a0">k</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">v</font>
        <strong>return</strong> <font color="#2040a0">rc</font>

<strong>class</strong> <font color="#2040a0">FeedParserDict</font><font color="4444FF">(</font><font color="#2040a0">UserDict</font><font color="4444FF">)</font><font color="4444FF">:</font>
<strong>   <font color="ff0000"> def</font><font color="ff0000"> __getitem__</font><font color="2040a0">(self, key)</font>:
</strong>        <font color="#2040a0">keymap</font> <font color="4444FF">=</font> <font color="4444FF"><strong>{</strong></font><font color="#008000">'channel'</font><font color="4444FF">:</font> <font color="#008000">'feed'</font>,
                  <font color="#008000">'items'</font><font color="4444FF">:</font> <font color="#008000">'entries'</font>,
                  <font color="#008000">'guid'</font><font color="4444FF">:</font> <font color="#008000">'id'</font>,
                  <font color="#008000">'date'</font><font color="4444FF">:</font> <font color="#008000">'modified'</font>,
                  <font color="#008000">'date_parsed'</font><font color="4444FF">:</font> <font color="#008000">'modified_parsed'</font>,
                  <font color="#008000">'description'</font><font color="4444FF">:</font> <font color="4444FF">[</font><font color="#008000">'tagline'</font>, <font color="#008000">'summary'</font><font color="4444FF">]</font><font color="4444FF"><strong>}</strong></font>
        <font color="#2040a0">realkey</font> <font color="4444FF">=</font> <font color="#2040a0">keymap</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#2040a0">key</font>, <font color="#2040a0">key</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">type</font><font color="4444FF">(</font><font color="#2040a0">realkey</font><font color="4444FF">)</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#2040a0">types</font>.<font color="#2040a0">ListType</font><font color="4444FF">:</font>
            <strong>for</strong> <font color="#2040a0">k</font> <strong>in</strong> <font color="#2040a0">realkey</font><font color="4444FF">:</font>
                <strong>if</strong> <font color="#2040a0">UserDict</font>.<font color="#2040a0">has_key</font><font color="4444FF">(</font><font color="#2040a0">self</font>, <font color="#2040a0">k</font><font color="4444FF">)</font><font color="4444FF">:</font>
                    <strong>return</strong> <font color="#2040a0">UserDict</font>.<font color="#2040a0">__getitem__</font><font color="4444FF">(</font><font color="#2040a0">self</font>, <font color="#2040a0">k</font><font color="4444FF">)</font>
            <strong>return</strong> <font color="#2040a0">UserDict</font>.<font color="#2040a0">__getitem__</font><font color="4444FF">(</font><font color="#2040a0">self</font>, <font color="#2040a0">key</font><font color="4444FF">)</font>
        <strong>return</strong> <font color="#2040a0">UserDict</font>.<font color="#2040a0">__getitem__</font><font color="4444FF">(</font><font color="#2040a0">self</font>, <font color="#2040a0">realkey</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> has_key</font><font color="2040a0">(self, key)</font>:
</strong>        <strong>return</strong> <font color="#2040a0">hasattr</font><font color="4444FF">(</font><font color="#2040a0">self</font>, <font color="#2040a0">key</font><font color="4444FF">)</font> <strong>or</strong> <font color="#2040a0">UserDict</font>.<font color="#2040a0">has_key</font><font color="4444FF">(</font><font color="#2040a0">self</font>, <font color="#2040a0">key</font><font color="4444FF">)</font>
        
<strong>   <font color="ff0000"> def</font><font color="ff0000"> __getattr__</font><font color="2040a0">(self, key)</font>:
</strong>        <strong>try</strong><font color="4444FF">:</font>
            <strong>return</strong> <font color="#2040a0">self</font>.<font color="#2040a0">__dict__</font><font color="4444FF">[</font><font color="#2040a0">key</font><font color="4444FF">]</font>
        <strong>except</strong> <font color="#2040a0">KeyError</font><font color="4444FF">:</font>
            <strong>pass</strong>
        <strong>try</strong><font color="4444FF">:</font>
            <strong>return</strong> <font color="#2040a0">self</font>.<font color="#2040a0">__getitem__</font><font color="4444FF">(</font><font color="#2040a0">key</font><font color="4444FF">)</font>
        <strong>except</strong><font color="4444FF">:</font>
            <strong>raise</strong> <font color="#2040a0">AttributeError</font>, <font color="#008000">&quot;object has no attribute '%s'&quot;</font> <font color="4444FF">%</font> <font color="#2040a0">key</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> __contains__</font><font color="2040a0">(self, key)</font>:
</strong>        <strong>return</strong> <font color="#2040a0">self</font>.<font color="#2040a0">has_key</font><font color="4444FF">(</font><font color="#2040a0">key</font><font color="4444FF">)</font>

<font color="#2040a0">def</font> <font color="#2040a0">zopeCompatibilityHack</font><font color="4444FF">(</font><font color="4444FF">)</font><font color="4444FF">:</font>
    <strong>global</strong> <font color="#2040a0">FeedParserDict</font>
    <strong>del</strong> <font color="#2040a0">FeedParserDict</font>
<strong>   <font color="ff0000"> def</font><font color="ff0000"> FeedParserDict</font><font color="2040a0">(aDict=None)</font>:
</strong>        <font color="#2040a0">rc</font> <font color="4444FF">=</font> <font color="4444FF"><strong>{</strong></font><font color="4444FF"><strong>}</strong></font>
        <strong>if</strong> <font color="#2040a0">aDict</font><font color="4444FF">:</font>
            <font color="#2040a0">rc</font>.<font color="#2040a0">update</font><font color="4444FF">(</font><font color="#2040a0">aDict</font><font color="4444FF">)</font>
        <strong>return</strong> <font color="#2040a0">rc</font>

<font color="#2040a0">_ebcdic_to_ascii_map</font> <font color="4444FF">=</font> <font color="#2040a0">None</font>
<font color="#2040a0">def</font> <font color="#2040a0">_ebcdic_to_ascii</font><font color="4444FF">(</font><font color="#2040a0">s</font><font color="4444FF">)</font><font color="4444FF">:</font>
    <strong>global</strong> <font color="#2040a0">_ebcdic_to_ascii_map</font>
    <strong>if</strong> <strong>not</strong> <font color="#2040a0">_ebcdic_to_ascii_map</font><font color="4444FF">:</font>
        <font color="#2040a0">emap</font> <font color="4444FF">=</font> <font color="4444FF">(</font>
            <font color="#FF0000">0</font>,<font color="#FF0000">1</font>,<font color="#FF0000">2</font>,<font color="#FF0000">3</font>,<font color="#FF0000">156</font>,<font color="#FF0000">9</font>,<font color="#FF0000">134</font>,<font color="#FF0000">127</font>,<font color="#FF0000">151</font>,<font color="#FF0000">141</font>,<font color="#FF0000">142</font>,<font color="#FF0000">11</font>,<font color="#FF0000">12</font>,<font color="#FF0000">13</font>,<font color="#FF0000">14</font>,<font color="#FF0000">15</font>,
            <font color="#FF0000">16</font>,<font color="#FF0000">17</font>,<font color="#FF0000">18</font>,<font color="#FF0000">19</font>,<font color="#FF0000">157</font>,<font color="#FF0000">133</font>,<font color="#FF0000">8</font>,<font color="#FF0000">135</font>,<font color="#FF0000">24</font>,<font color="#FF0000">25</font>,<font color="#FF0000">146</font>,<font color="#FF0000">143</font>,<font color="#FF0000">28</font>,<font color="#FF0000">29</font>,<font color="#FF0000">30</font>,<font color="#FF0000">31</font>,
            <font color="#FF0000">128</font>,<font color="#FF0000">129</font>,<font color="#FF0000">130</font>,<font color="#FF0000">131</font>,<font color="#FF0000">132</font>,<font color="#FF0000">10</font>,<font color="#FF0000">23</font>,<font color="#FF0000">27</font>,<font color="#FF0000">136</font>,<font color="#FF0000">137</font>,<font color="#FF0000">138</font>,<font color="#FF0000">139</font>,<font color="#FF0000">140</font>,<font color="#FF0000">5</font>,<font color="#FF0000">6</font>,<font color="#FF0000">7</font>,
            <font color="#FF0000">144</font>,<font color="#FF0000">145</font>,<font color="#FF0000">22</font>,<font color="#FF0000">147</font>,<font color="#FF0000">148</font>,<font color="#FF0000">149</font>,<font color="#FF0000">150</font>,<font color="#FF0000">4</font>,<font color="#FF0000">152</font>,<font color="#FF0000">153</font>,<font color="#FF0000">154</font>,<font color="#FF0000">155</font>,<font color="#FF0000">20</font>,<font color="#FF0000">21</font>,<font color="#FF0000">158</font>,<font color="#FF0000">26</font>,
            <font color="#FF0000">32</font>,<font color="#FF0000">160</font>,<font color="#FF0000">161</font>,<font color="#FF0000">162</font>,<font color="#FF0000">163</font>,<font color="#FF0000">164</font>,<font color="#FF0000">165</font>,<font color="#FF0000">166</font>,<font color="#FF0000">167</font>,<font color="#FF0000">168</font>,<font color="#FF0000">91</font>,<font color="#FF0000">46</font>,<font color="#FF0000">60</font>,<font color="#FF0000">40</font>,<font color="#FF0000">43</font>,<font color="#FF0000">33</font>,
            <font color="#FF0000">38</font>,<font color="#FF0000">169</font>,<font color="#FF0000">170</font>,<font color="#FF0000">171</font>,<font color="#FF0000">172</font>,<font color="#FF0000">173</font>,<font color="#FF0000">174</font>,<font color="#FF0000">175</font>,<font color="#FF0000">176</font>,<font color="#FF0000">177</font>,<font color="#FF0000">93</font>,<font color="#FF0000">36</font>,<font color="#FF0000">42</font>,<font color="#FF0000">41</font>,<font color="#FF0000">59</font>,<font color="#FF0000">94</font>,
            <font color="#FF0000">45</font>,<font color="#FF0000">47</font>,<font color="#FF0000">178</font>,<font color="#FF0000">179</font>,<font color="#FF0000">180</font>,<font color="#FF0000">181</font>,<font color="#FF0000">182</font>,<font color="#FF0000">183</font>,<font color="#FF0000">184</font>,<font color="#FF0000">185</font>,<font color="#FF0000">124</font>,<font color="#FF0000">44</font>,<font color="#FF0000">37</font>,<font color="#FF0000">95</font>,<font color="#FF0000">62</font>,<font color="#FF0000">63</font>,
            <font color="#FF0000">186</font>,<font color="#FF0000">187</font>,<font color="#FF0000">188</font>,<font color="#FF0000">189</font>,<font color="#FF0000">190</font>,<font color="#FF0000">191</font>,<font color="#FF0000">192</font>,<font color="#FF0000">193</font>,<font color="#FF0000">194</font>,<font color="#FF0000">96</font>,<font color="#FF0000">58</font>,<font color="#FF0000">35</font>,<font color="#FF0000">64</font>,<font color="#FF0000">39</font>,<font color="#FF0000">61</font>,<font color="#FF0000">34</font>,
            <font color="#FF0000">195</font>,<font color="#FF0000">97</font>,<font color="#FF0000">98</font>,<font color="#FF0000">99</font>,<font color="#FF0000">100</font>,<font color="#FF0000">101</font>,<font color="#FF0000">102</font>,<font color="#FF0000">103</font>,<font color="#FF0000">104</font>,<font color="#FF0000">105</font>,<font color="#FF0000">196</font>,<font color="#FF0000">197</font>,<font color="#FF0000">198</font>,<font color="#FF0000">199</font>,<font color="#FF0000">200</font>,<font color="#FF0000">201</font>,
            <font color="#FF0000">202</font>,<font color="#FF0000">106</font>,<font color="#FF0000">107</font>,<font color="#FF0000">108</font>,<font color="#FF0000">109</font>,<font color="#FF0000">110</font>,<font color="#FF0000">111</font>,<font color="#FF0000">112</font>,<font color="#FF0000">113</font>,<font color="#FF0000">114</font>,<font color="#FF0000">203</font>,<font color="#FF0000">204</font>,<font color="#FF0000">205</font>,<font color="#FF0000">206</font>,<font color="#FF0000">207</font>,<font color="#FF0000">208</font>,
            <font color="#FF0000">209</font>,<font color="#FF0000">126</font>,<font color="#FF0000">115</font>,<font color="#FF0000">116</font>,<font color="#FF0000">117</font>,<font color="#FF0000">118</font>,<font color="#FF0000">119</font>,<font color="#FF0000">120</font>,<font color="#FF0000">121</font>,<font color="#FF0000">122</font>,<font color="#FF0000">210</font>,<font color="#FF0000">211</font>,<font color="#FF0000">212</font>,<font color="#FF0000">213</font>,<font color="#FF0000">214</font>,<font color="#FF0000">215</font>,
            <font color="#FF0000">216</font>,<font color="#FF0000">217</font>,<font color="#FF0000">218</font>,<font color="#FF0000">219</font>,<font color="#FF0000">220</font>,<font color="#FF0000">221</font>,<font color="#FF0000">222</font>,<font color="#FF0000">223</font>,<font color="#FF0000">224</font>,<font color="#FF0000">225</font>,<font color="#FF0000">226</font>,<font color="#FF0000">227</font>,<font color="#FF0000">228</font>,<font color="#FF0000">229</font>,<font color="#FF0000">230</font>,<font color="#FF0000">231</font>,
            <font color="#FF0000">123</font>,<font color="#FF0000">65</font>,<font color="#FF0000">66</font>,<font color="#FF0000">67</font>,<font color="#FF0000">68</font>,<font color="#FF0000">69</font>,<font color="#FF0000">70</font>,<font color="#FF0000">71</font>,<font color="#FF0000">72</font>,<font color="#FF0000">73</font>,<font color="#FF0000">232</font>,<font color="#FF0000">233</font>,<font color="#FF0000">234</font>,<font color="#FF0000">235</font>,<font color="#FF0000">236</font>,<font color="#FF0000">237</font>,
            <font color="#FF0000">125</font>,<font color="#FF0000">74</font>,<font color="#FF0000">75</font>,<font color="#FF0000">76</font>,<font color="#FF0000">77</font>,<font color="#FF0000">78</font>,<font color="#FF0000">79</font>,<font color="#FF0000">80</font>,<font color="#FF0000">81</font>,<font color="#FF0000">82</font>,<font color="#FF0000">238</font>,<font color="#FF0000">239</font>,<font color="#FF0000">240</font>,<font color="#FF0000">241</font>,<font color="#FF0000">242</font>,<font color="#FF0000">243</font>,
            <font color="#FF0000">92</font>,<font color="#FF0000">159</font>,<font color="#FF0000">83</font>,<font color="#FF0000">84</font>,<font color="#FF0000">85</font>,<font color="#FF0000">86</font>,<font color="#FF0000">87</font>,<font color="#FF0000">88</font>,<font color="#FF0000">89</font>,<font color="#FF0000">90</font>,<font color="#FF0000">244</font>,<font color="#FF0000">245</font>,<font color="#FF0000">246</font>,<font color="#FF0000">247</font>,<font color="#FF0000">248</font>,<font color="#FF0000">249</font>,
            <font color="#FF0000">48</font>,<font color="#FF0000">49</font>,<font color="#FF0000">50</font>,<font color="#FF0000">51</font>,<font color="#FF0000">52</font>,<font color="#FF0000">53</font>,<font color="#FF0000">54</font>,<font color="#FF0000">55</font>,<font color="#FF0000">56</font>,<font color="#FF0000">57</font>,<font color="#FF0000">250</font>,<font color="#FF0000">251</font>,<font color="#FF0000">252</font>,<font color="#FF0000">253</font>,<font color="#FF0000">254</font>,<font color="#FF0000">255</font>
            <font color="4444FF">)</font>
        <strong>import</strong> <font color="#2040a0">string</font>
        <font color="#2040a0">_ebcdic_to_ascii_map</font> <font color="4444FF">=</font> <font color="#2040a0">string</font>.<font color="#2040a0">maketrans</font><font color="4444FF">(</font> \
            <font color="#008000">&quot;&quot;</font>.<font color="#2040a0">join</font><font color="4444FF">(</font><font color="#2040a0">map</font><font color="4444FF">(</font><font color="#2040a0">chr</font>, <font color="#2040a0">range</font><font color="4444FF">(</font><font color="#FF0000">256</font><font color="4444FF">)</font><font color="4444FF">)</font><font color="4444FF">)</font>, <font color="#008000">&quot;&quot;</font>.<font color="#2040a0">join</font><font color="4444FF">(</font><font color="#2040a0">map</font><font color="4444FF">(</font><font color="#2040a0">chr</font>, <font color="#2040a0">emap</font><font color="4444FF">)</font><font color="4444FF">)</font><font color="4444FF">)</font>
    <strong>return</strong> <font color="#2040a0">s</font>.<font color="#2040a0">translate</font><font color="4444FF">(</font><font color="#2040a0">_ebcdic_to_ascii_map</font><font color="4444FF">)</font>

<strong>class</strong> <font color="#2040a0">_FeedParserMixin</font><font color="4444FF">:</font>
    <font color="#2040a0">namespaces</font> <font color="4444FF">=</font> <font color="4444FF"><strong>{</strong></font><font color="#008000">&quot;&quot;</font><font color="4444FF">:</font> <font color="#008000">&quot;&quot;</font>,
                  <font color="#008000">&quot;http://backend.userland.com/rss&quot;</font><font color="4444FF">:</font> <font color="#008000">&quot;&quot;</font>,
                  <font color="#008000">&quot;http://blogs.law.harvard.edu/tech/rss&quot;</font><font color="4444FF">:</font> <font color="#008000">&quot;&quot;</font>,
                  <font color="#008000">&quot;http://purl.org/rss/1.0/&quot;</font><font color="4444FF">:</font> <font color="#008000">&quot;&quot;</font>,
                  <font color="#008000">&quot;http://my.netscape.com/rdf/simple/0.9/&quot;</font><font color="4444FF">:</font> <font color="#008000">&quot;&quot;</font>,
                  <font color="#008000">&quot;http://example.com/newformat#&quot;</font><font color="4444FF">:</font> <font color="#008000">&quot;&quot;</font>,
                  <font color="#008000">&quot;http://example.com/necho&quot;</font><font color="4444FF">:</font> <font color="#008000">&quot;&quot;</font>,
                  <font color="#008000">&quot;http://purl.org/echo/&quot;</font><font color="4444FF">:</font> <font color="#008000">&quot;&quot;</font>,
                  <font color="#008000">&quot;uri/of/echo/namespace#&quot;</font><font color="4444FF">:</font> <font color="#008000">&quot;&quot;</font>,
                  <font color="#008000">&quot;http://purl.org/pie/&quot;</font><font color="4444FF">:</font> <font color="#008000">&quot;&quot;</font>,
                  <font color="#008000">&quot;http://purl.org/atom/ns#&quot;</font><font color="4444FF">:</font> <font color="#008000">&quot;&quot;</font>,
                  <font color="#008000">&quot;http://purl.org/rss/1.0/modules/rss091#&quot;</font><font color="4444FF">:</font> <font color="#008000">&quot;&quot;</font>,
                  
                  <font color="#008000">&quot;http://webns.net/mvcb/&quot;</font><font color="4444FF">:</font>                               <font color="#008000">&quot;admin&quot;</font>,
                  <font color="#008000">&quot;http://purl.org/rss/1.0/modules/aggregation/&quot;</font><font color="4444FF">:</font>         <font color="#008000">&quot;ag&quot;</font>,
                  <font color="#008000">&quot;http://purl.org/rss/1.0/modules/annotate/&quot;</font><font color="4444FF">:</font>            <font color="#008000">&quot;annotate&quot;</font>,
                  <font color="#008000">&quot;http://media.tangent.org/rss/1.0/&quot;</font><font color="4444FF">:</font>                    <font color="#008000">&quot;audio&quot;</font>,
                  <font color="#008000">&quot;http://backend.userland.com/blogChannelModule&quot;</font><font color="4444FF">:</font>        <font color="#008000">&quot;blogChannel&quot;</font>,
                  <font color="#008000">&quot;http://web.resource.org/cc/&quot;</font><font color="4444FF">:</font>                          <font color="#008000">&quot;cc&quot;</font>,
                  <font color="#008000">&quot;http://backend.userland.com/creativeCommonsRssModule&quot;</font><font color="4444FF">:</font> <font color="#008000">&quot;creativeCommons&quot;</font>,
                  <font color="#008000">&quot;http://purl.org/rss/1.0/modules/company&quot;</font><font color="4444FF">:</font>              <font color="#008000">&quot;co&quot;</font>,
                  <font color="#008000">&quot;http://purl.org/rss/1.0/modules/content/&quot;</font><font color="4444FF">:</font>             <font color="#008000">&quot;content&quot;</font>,
                  <font color="#008000">&quot;http://my.theinfo.org/changed/1.0/rss/&quot;</font><font color="4444FF">:</font>               <font color="#008000">&quot;cp&quot;</font>,
                  <font color="#008000">&quot;http://purl.org/dc/elements/1.1/&quot;</font><font color="4444FF">:</font>                     <font color="#008000">&quot;dc&quot;</font>,
                  <font color="#008000">&quot;http://purl.org/dc/terms/&quot;</font><font color="4444FF">:</font>                            <font color="#008000">&quot;dcterms&quot;</font>,
                  <font color="#008000">&quot;http://purl.org/rss/1.0/modules/email/&quot;</font><font color="4444FF">:</font>               <font color="#008000">&quot;email&quot;</font>,
                  <font color="#008000">&quot;http://purl.org/rss/1.0/modules/event/&quot;</font><font color="4444FF">:</font>               <font color="#008000">&quot;ev&quot;</font>,
                  <font color="#008000">&quot;http://postneo.com/icbm/&quot;</font><font color="4444FF">:</font>                             <font color="#008000">&quot;icbm&quot;</font>,
                  <font color="#008000">&quot;http://purl.org/rss/1.0/modules/image/&quot;</font><font color="4444FF">:</font>               <font color="#008000">&quot;image&quot;</font>,
                  <font color="#008000">&quot;http://xmlns.com/foaf/0.1/&quot;</font><font color="4444FF">:</font>                           <font color="#008000">&quot;foaf&quot;</font>,
                  <font color="#008000">&quot;http://freshmeat.net/rss/fm/&quot;</font><font color="4444FF">:</font>                         <font color="#008000">&quot;fm&quot;</font>,
                  <font color="#008000">&quot;http://purl.org/rss/1.0/modules/link/&quot;</font><font color="4444FF">:</font>                <font color="#008000">&quot;l&quot;</font>,
                  <font color="#008000">&quot;http://madskills.com/public/xml/rss/module/pingback/&quot;</font><font color="4444FF">:</font> <font color="#008000">&quot;pingback&quot;</font>,
                  <font color="#008000">&quot;http://prismstandard.org/namespaces/1.2/basic/&quot;</font><font color="4444FF">:</font>       <font color="#008000">&quot;prism&quot;</font>,
                  <font color="#008000">&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;</font><font color="4444FF">:</font>          <font color="#008000">&quot;rdf&quot;</font>,
                  <font color="#008000">&quot;http://www.w3.org/2000/01/rdf-schema#&quot;</font><font color="4444FF">:</font>                <font color="#008000">&quot;rdfs&quot;</font>,
                  <font color="#008000">&quot;http://purl.org/rss/1.0/modules/reference/&quot;</font><font color="4444FF">:</font>           <font color="#008000">&quot;ref&quot;</font>,
                  <font color="#008000">&quot;http://purl.org/rss/1.0/modules/richequiv/&quot;</font><font color="4444FF">:</font>           <font color="#008000">&quot;reqv&quot;</font>,
                  <font color="#008000">&quot;http://purl.org/rss/1.0/modules/search/&quot;</font><font color="4444FF">:</font>              <font color="#008000">&quot;search&quot;</font>,
                  <font color="#008000">&quot;http://purl.org/rss/1.0/modules/slash/&quot;</font><font color="4444FF">:</font>               <font color="#008000">&quot;slash&quot;</font>,
                  <font color="#008000">&quot;http://purl.org/rss/1.0/modules/servicestatus/&quot;</font><font color="4444FF">:</font>       <font color="#008000">&quot;ss&quot;</font>,
                  <font color="#008000">&quot;http://hacks.benhammersley.com/rss/streaming/&quot;</font><font color="4444FF">:</font>        <font color="#008000">&quot;str&quot;</font>,
                  <font color="#008000">&quot;http://purl.org/rss/1.0/modules/subscription/&quot;</font><font color="4444FF">:</font>        <font color="#008000">&quot;sub&quot;</font>,
                  <font color="#008000">&quot;http://purl.org/rss/1.0/modules/syndication/&quot;</font><font color="4444FF">:</font>         <font color="#008000">&quot;sy&quot;</font>,
                  <font color="#008000">&quot;http://purl.org/rss/1.0/modules/taxonomy/&quot;</font><font color="4444FF">:</font>            <font color="#008000">&quot;taxo&quot;</font>,
                  <font color="#008000">&quot;http://purl.org/rss/1.0/modules/threading/&quot;</font><font color="4444FF">:</font>           <font color="#008000">&quot;thr&quot;</font>,
                  <font color="#008000">&quot;http://purl.org/rss/1.0/modules/textinput/&quot;</font><font color="4444FF">:</font>           <font color="#008000">&quot;ti&quot;</font>,
                  <font color="#008000">&quot;http://madskills.com/public/xml/rss/module/trackback/&quot;</font><font color="4444FF">:</font><font color="#008000">&quot;trackback&quot;</font>,
                  <font color="#008000">&quot;http://wellformedweb.org/CommentAPI/&quot;</font><font color="4444FF">:</font>                 <font color="#008000">&quot;wfw&quot;</font>,
                  <font color="#008000">&quot;http://purl.org/rss/1.0/modules/wiki/&quot;</font><font color="4444FF">:</font>                <font color="#008000">&quot;wiki&quot;</font>,
                  <font color="#008000">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</font><font color="4444FF">:</font>            <font color="#008000">&quot;soap&quot;</font>,
                  <font color="#008000">&quot;http://www.w3.org/1999/xhtml&quot;</font><font color="4444FF">:</font>                         <font color="#008000">&quot;xhtml&quot;</font>,
                  <font color="#008000">&quot;http://www.w3.org/XML/1998/namespace&quot;</font><font color="4444FF">:</font>                 <font color="#008000">&quot;xml&quot;</font>
<font color="4444FF"><strong>}</strong></font>

    <font color="#2040a0">can_be_relative_uri</font> <font color="4444FF">=</font> <font color="4444FF">[</font><font color="#008000">'link'</font>, <font color="#008000">'id'</font>, <font color="#008000">'wfw_comment'</font>, <font color="#008000">'wfw_commentrss'</font>, <font color="#008000">'docs'</font>, <font color="#008000">'url'</font>, <font color="#008000">'comments'</font>, <font color="#008000">'license'</font><font color="4444FF">]</font>
    <font color="#2040a0">can_contain_relative_uris</font> <font color="4444FF">=</font> <font color="4444FF">[</font><font color="#008000">'content'</font>, <font color="#008000">'title'</font>, <font color="#008000">'summary'</font>, <font color="#008000">'info'</font>, <font color="#008000">'tagline'</font>, <font color="#008000">'copyright'</font>, <font color="#008000">'description'</font><font color="4444FF">]</font>
    <font color="#2040a0">can_contain_dangerous_markup</font> <font color="4444FF">=</font> <font color="4444FF">[</font><font color="#008000">'content'</font>, <font color="#008000">'title'</font>, <font color="#008000">'summary'</font>, <font color="#008000">'info'</font>, <font color="#008000">'tagline'</font>, <font color="#008000">'copyright'</font>, <font color="#008000">'description'</font><font color="4444FF">]</font>
    <font color="#2040a0">html_types</font> <font color="4444FF">=</font> <font color="4444FF">[</font><font color="#008000">'text/html'</font>, <font color="#008000">'application/xhtml+xml'</font><font color="4444FF">]</font>
    
<strong>   <font color="ff0000"> def</font><font color="ff0000"> __init__</font><font color="2040a0">(self, baseuri=None, baselang=None, encoding='utf-8')</font>:
</strong>        <strong>if</strong> <font color="#2040a0">_debug</font><font color="4444FF">:</font> <font color="#2040a0">sys</font>.<font color="#2040a0">stderr</font>.<font color="#2040a0">write</font><font color="4444FF">(</font><font color="#008000">&quot;initializing FeedParser<font color="#77dd77">\n</font>&quot;</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">feeddata</font> <font color="4444FF">=</font> <font color="#2040a0">FeedParserDict</font><font color="4444FF">(</font><font color="4444FF">)</font> <font color="#444444"># feed-level data</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">encoding</font> <font color="4444FF">=</font> <font color="#2040a0">encoding</font> <font color="#444444"># character encoding</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">entries</font> <font color="4444FF">=</font> <font color="4444FF">[</font><font color="4444FF">]</font> <font color="#444444"># list of entry-level data</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">version</font> <font color="4444FF">=</font> <font color="#008000">''</font> <font color="#444444"># feed type/version, see SUPPORTED_VERSIONS</font>

        <font color="#444444"># the following are used internally to track state;</font>
        <font color="#444444"># some of this is kind of out of control and should</font>
        <font color="#444444"># probably be refactored into a finite state machine</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">infeed</font> <font color="4444FF">=</font> <font color="#FF0000">0</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">inentry</font> <font color="4444FF">=</font> <font color="#FF0000">0</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">incontent</font> <font color="4444FF">=</font> <font color="#FF0000">0</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">intextinput</font> <font color="4444FF">=</font> <font color="#FF0000">0</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">inimage</font> <font color="4444FF">=</font> <font color="#FF0000">0</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">inauthor</font> <font color="4444FF">=</font> <font color="#FF0000">0</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">incontributor</font> <font color="4444FF">=</font> <font color="#FF0000">0</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">contentparams</font> <font color="4444FF">=</font> <font color="#2040a0">FeedParserDict</font><font color="4444FF">(</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">namespacemap</font> <font color="4444FF">=</font> <font color="4444FF"><strong>{</strong></font><font color="4444FF"><strong>}</strong></font>
        <font color="#2040a0">self</font>.<font color="#2040a0">elementstack</font> <font color="4444FF">=</font> <font color="4444FF">[</font><font color="4444FF">]</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">basestack</font> <font color="4444FF">=</font> <font color="4444FF">[</font><font color="4444FF">]</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">langstack</font> <font color="4444FF">=</font> <font color="4444FF">[</font><font color="4444FF">]</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">baseuri</font> <font color="4444FF">=</font> <font color="#2040a0">baseuri</font> <strong>or</strong> <font color="#008000">''</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">lang</font> <font color="4444FF">=</font> <font color="#2040a0">baselang</font> <strong>or</strong> <font color="#2040a0">None</font>
        <strong>if</strong> <font color="#2040a0">baselang</font><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">feeddata</font><font color="4444FF">[</font><font color="#008000">'language'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">baselang</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> unknown_starttag</font><font color="2040a0">(self, tag, attrs)</font>:
</strong>        <strong>if</strong> <font color="#2040a0">_debug</font><font color="4444FF">:</font> <font color="#2040a0">sys</font>.<font color="#2040a0">stderr</font>.<font color="#2040a0">write</font><font color="4444FF">(</font><font color="#008000">'start %s with %s\n'</font> <font color="4444FF">%</font> <font color="4444FF">(</font><font color="#2040a0">tag</font>, <font color="#2040a0">attrs</font><font color="4444FF">)</font><font color="4444FF">)</font>
        <font color="#444444"># normalize attrs</font>
        <font color="#2040a0">attrs</font> <font color="4444FF">=</font> <font color="4444FF">[</font><font color="4444FF">(</font><font color="#2040a0">k</font>.<font color="#2040a0">lower</font><font color="4444FF">(</font><font color="4444FF">)</font>, <font color="#2040a0">v</font><font color="4444FF">)</font> <strong>for</strong> <font color="#2040a0">k</font>, <font color="#2040a0">v</font> <strong>in</strong> <font color="#2040a0">attrs</font><font color="4444FF">]</font>
        <font color="#2040a0">attrs</font> <font color="4444FF">=</font> <font color="4444FF">[</font><font color="4444FF">(</font><font color="#2040a0">k</font>, <font color="#2040a0">k</font> <strong>in</strong> <font color="4444FF">(</font><font color="#008000">'rel'</font>, <font color="#008000">'type'</font><font color="4444FF">)</font> <strong>and</strong> <font color="#2040a0">v</font>.<font color="#2040a0">lower</font><font color="4444FF">(</font><font color="4444FF">)</font> <strong>or</strong> <font color="#2040a0">v</font><font color="4444FF">)</font> <strong>for</strong> <font color="#2040a0">k</font>, <font color="#2040a0">v</font> <strong>in</strong> <font color="#2040a0">attrs</font><font color="4444FF">]</font>
        
        <font color="#444444"># track xml:base and xml:lang</font>
        <font color="#2040a0">attrsD</font> <font color="4444FF">=</font> <font color="#2040a0">dict</font><font color="4444FF">(</font><font color="#2040a0">attrs</font><font color="4444FF">)</font>
        <font color="#2040a0">baseuri</font> <font color="4444FF">=</font> <font color="#2040a0">attrsD</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'xml:base'</font>, <font color="#2040a0">attrsD</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'base'</font><font color="4444FF">)</font><font color="4444FF">)</font> <strong>or</strong> <font color="#2040a0">self</font>.<font color="#2040a0">baseuri</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">baseuri</font> <font color="4444FF">=</font> <font color="#2040a0">baseuri</font>
        <font color="#2040a0">lang</font> <font color="4444FF">=</font> <font color="#2040a0">attrsD</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'xml:lang'</font>, <font color="#2040a0">attrsD</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'lang'</font><font color="4444FF">)</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">lang</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">''</font><font color="4444FF">:</font>
            <font color="#444444"># xml:lang could be explicitly set to '', we need to capture that</font>
            <font color="#2040a0">lang</font> <font color="4444FF">=</font> <font color="#2040a0">None</font>
        <strong>elif</strong> <font color="#2040a0">lang</font> <strong>is</strong> <font color="#2040a0">None</font><font color="4444FF">:</font>
            <font color="#444444"># if no xml:lang is specified, use parent lang</font>
            <font color="#2040a0">lang</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">lang</font>
        <strong>if</strong> <font color="#2040a0">lang</font><font color="4444FF">:</font>
            <strong>if</strong> <font color="#2040a0">tag</font> <strong>in</strong> <font color="4444FF">(</font><font color="#008000">'feed'</font>, <font color="#008000">'rss'</font>, <font color="#008000">'rdf:RDF'</font><font color="4444FF">)</font><font color="4444FF">:</font>
                <font color="#2040a0">self</font>.<font color="#2040a0">feeddata</font><font color="4444FF">[</font><font color="#008000">'language'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">lang</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">lang</font> <font color="4444FF">=</font> <font color="#2040a0">lang</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">basestack</font>.<font color="#2040a0">append</font><font color="4444FF">(</font><font color="#2040a0">baseuri</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">langstack</font>.<font color="#2040a0">append</font><font color="4444FF">(</font><font color="#2040a0">lang</font><font color="4444FF">)</font>
        
        <font color="#444444"># track namespaces</font>
        <strong>for</strong> <font color="#2040a0">prefix</font>, <font color="#2040a0">uri</font> <strong>in</strong> <font color="#2040a0">attrs</font><font color="4444FF">:</font>
            <strong>if</strong> <font color="#2040a0">prefix</font>.<font color="#2040a0">startswith</font><font color="4444FF">(</font><font color="#008000">'xmlns:'</font><font color="4444FF">)</font><font color="4444FF">:</font>
                <font color="#2040a0">self</font>.<font color="#2040a0">trackNamespace</font><font color="4444FF">(</font><font color="#2040a0">prefix</font><font color="4444FF">[</font><font color="#FF0000">6</font><font color="4444FF">:</font><font color="4444FF">]</font>, <font color="#2040a0">uri</font><font color="4444FF">)</font>
            <strong>elif</strong> <font color="#2040a0">prefix</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">'xmlns'</font><font color="4444FF">:</font>
                <font color="#2040a0">self</font>.<font color="#2040a0">trackNamespace</font><font color="4444FF">(</font><font color="#2040a0">None</font>, <font color="#2040a0">uri</font><font color="4444FF">)</font>

        <font color="#444444"># track inline content</font>
        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">incontent</font> <strong>and</strong> <font color="#2040a0">self</font>.<font color="#2040a0">contentparams</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'mode'</font><font color="4444FF">)</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">'escaped'</font><font color="4444FF">:</font>
            <font color="#444444"># element declared itself as escaped markup, but it isn't really</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">contentparams</font><font color="4444FF">[</font><font color="#008000">'mode'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#008000">'xml'</font>
        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">incontent</font> <strong>and</strong> <font color="#2040a0">self</font>.<font color="#2040a0">contentparams</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'mode'</font><font color="4444FF">)</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">'xml'</font><font color="4444FF">:</font>
            <font color="#444444"># Note: probably shouldn't simply recreate localname here, but</font>
            <font color="#444444"># our namespace handling isn't actually 100% correct in cases where</font>
            <font color="#444444"># the feed redefines the default namespace (which is actually</font>
            <font color="#444444"># the usual case for inline content, thanks Sam), so here we</font>
            <font color="#444444"># cheat and just reconstruct the element based on localname</font>
            <font color="#444444"># because that compensates for the bugs in our namespace handling.</font>
            <font color="#444444"># This will horribly munge inline content with non-empty qnames,</font>
            <font color="#444444"># but nobody actually does that, so I'm not fixing it.</font>
            <font color="#2040a0">tag</font> <font color="4444FF">=</font> <font color="#2040a0">tag</font>.<font color="#2040a0">split</font><font color="4444FF">(</font><font color="#008000">':'</font><font color="4444FF">)</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font>
            <strong>return</strong> <font color="#2040a0">self</font>.<font color="#2040a0">handle_data</font><font color="4444FF">(</font><font color="#008000">&quot;&lt;%s%s&gt;&quot;</font> <font color="4444FF">%</font> <font color="4444FF">(</font><font color="#2040a0">tag</font>, <font color="#008000">&quot;&quot;</font>.<font color="#2040a0">join</font><font color="4444FF">(</font><font color="4444FF">[</font><font color="#008000">' %s=&quot;%s&quot;'</font> <font color="4444FF">%</font> <font color="#2040a0">t</font> <strong>for</strong> <font color="#2040a0">t</font> <strong>in</strong> <font color="#2040a0">attrs</font><font color="4444FF">]</font><font color="4444FF">)</font><font color="4444FF">)</font>, <font color="#2040a0">escape</font><font color="4444FF">=</font><font color="#FF0000">0</font><font color="4444FF">)</font>

        <font color="#444444"># match namespaces</font>
        <strong>if</strong> <font color="#2040a0">tag</font>.<font color="#2040a0">find</font><font color="4444FF">(</font><font color="#008000">':'</font><font color="4444FF">)</font> <font color="4444FF">&lt;</font><font color="4444FF">&gt;</font> <font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">:</font>
            <font color="#2040a0">prefix</font>, <font color="#2040a0">suffix</font> <font color="4444FF">=</font> <font color="#2040a0">tag</font>.<font color="#2040a0">split</font><font color="4444FF">(</font><font color="#008000">':'</font>, <font color="#FF0000">1</font><font color="4444FF">)</font>
        <strong>else</strong><font color="4444FF">:</font>
            <font color="#2040a0">prefix</font>, <font color="#2040a0">suffix</font> <font color="4444FF">=</font> <font color="#008000">''</font>, <font color="#2040a0">tag</font>
        <font color="#2040a0">prefix</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">namespacemap</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#2040a0">prefix</font>, <font color="#2040a0">prefix</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">prefix</font><font color="4444FF">:</font>
            <font color="#2040a0">prefix</font> <font color="4444FF">=</font> <font color="#2040a0">prefix</font> <font color="4444FF">+</font> <font color="#008000">'_'</font>

        <font color="#444444"># special hack for better tracking of empty textinput/image elements in illformed feeds</font>
        <strong>if</strong> <font color="4444FF">(</font><strong>not</strong> <font color="#2040a0">prefix</font><font color="4444FF">)</font> <strong>and</strong> <font color="#2040a0">tag</font> <strong>not</strong> <strong>in</strong> <font color="4444FF">(</font><font color="#008000">'title'</font>, <font color="#008000">'link'</font>, <font color="#008000">'description'</font>, <font color="#008000">'name'</font><font color="4444FF">)</font><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">intextinput</font> <font color="4444FF">=</font> <font color="#FF0000">0</font>
        <strong>if</strong> <font color="4444FF">(</font><strong>not</strong> <font color="#2040a0">prefix</font><font color="4444FF">)</font> <strong>and</strong> <font color="#2040a0">tag</font> <strong>not</strong> <strong>in</strong> <font color="4444FF">(</font><font color="#008000">'title'</font>, <font color="#008000">'link'</font>, <font color="#008000">'description'</font>, <font color="#008000">'url'</font>, <font color="#008000">'width'</font>, <font color="#008000">'height'</font><font color="4444FF">)</font><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">inimage</font> <font color="4444FF">=</font> <font color="#FF0000">0</font>
        
        <font color="#444444"># call special handler (if defined) or default handler</font>
        <font color="#2040a0">methodname</font> <font color="4444FF">=</font> <font color="#008000">'_start_'</font> <font color="4444FF">+</font> <font color="#2040a0">prefix</font> <font color="4444FF">+</font> <font color="#2040a0">suffix</font>
        <strong>try</strong><font color="4444FF">:</font>
            <font color="#2040a0">method</font> <font color="4444FF">=</font> <font color="#2040a0">getattr</font><font color="4444FF">(</font><font color="#2040a0">self</font>, <font color="#2040a0">methodname</font><font color="4444FF">)</font>
            <strong>return</strong> <font color="#2040a0">method</font><font color="4444FF">(</font><font color="#2040a0">attrsD</font><font color="4444FF">)</font>
        <strong>except</strong> <font color="#2040a0">AttributeError</font><font color="4444FF">:</font>
            <strong>return</strong> <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#2040a0">prefix</font> <font color="4444FF">+</font> <font color="#2040a0">suffix</font>, <font color="#FF0000">1</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> unknown_endtag</font><font color="2040a0">(self, tag)</font>:
</strong>        <strong>if</strong> <font color="#2040a0">_debug</font><font color="4444FF">:</font> <font color="#2040a0">sys</font>.<font color="#2040a0">stderr</font>.<font color="#2040a0">write</font><font color="4444FF">(</font><font color="#008000">'end %s\n'</font> <font color="4444FF">%</font> <font color="#2040a0">tag</font><font color="4444FF">)</font>
        <font color="#444444"># match namespaces</font>
        <strong>if</strong> <font color="#2040a0">tag</font>.<font color="#2040a0">find</font><font color="4444FF">(</font><font color="#008000">':'</font><font color="4444FF">)</font> <font color="4444FF">&lt;</font><font color="4444FF">&gt;</font> <font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">:</font>
            <font color="#2040a0">prefix</font>, <font color="#2040a0">suffix</font> <font color="4444FF">=</font> <font color="#2040a0">tag</font>.<font color="#2040a0">split</font><font color="4444FF">(</font><font color="#008000">':'</font>, <font color="#FF0000">1</font><font color="4444FF">)</font>
        <strong>else</strong><font color="4444FF">:</font>
            <font color="#2040a0">prefix</font>, <font color="#2040a0">suffix</font> <font color="4444FF">=</font> <font color="#008000">''</font>, <font color="#2040a0">tag</font>
        <font color="#2040a0">prefix</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">namespacemap</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#2040a0">prefix</font>, <font color="#2040a0">prefix</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">prefix</font><font color="4444FF">:</font>
            <font color="#2040a0">prefix</font> <font color="4444FF">=</font> <font color="#2040a0">prefix</font> <font color="4444FF">+</font> <font color="#008000">'_'</font>

        <font color="#444444"># call special handler (if defined) or default handler</font>
        <font color="#2040a0">methodname</font> <font color="4444FF">=</font> <font color="#008000">'_end_'</font> <font color="4444FF">+</font> <font color="#2040a0">prefix</font> <font color="4444FF">+</font> <font color="#2040a0">suffix</font>
        <strong>try</strong><font color="4444FF">:</font>
            <font color="#2040a0">method</font> <font color="4444FF">=</font> <font color="#2040a0">getattr</font><font color="4444FF">(</font><font color="#2040a0">self</font>, <font color="#2040a0">methodname</font><font color="4444FF">)</font>
            <font color="#2040a0">method</font><font color="4444FF">(</font><font color="4444FF">)</font>
        <strong>except</strong> <font color="#2040a0">AttributeError</font><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="#2040a0">prefix</font> <font color="4444FF">+</font> <font color="#2040a0">suffix</font><font color="4444FF">)</font>

        <font color="#444444"># track inline content</font>
        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">incontent</font> <strong>and</strong> <font color="#2040a0">self</font>.<font color="#2040a0">contentparams</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'mode'</font><font color="4444FF">)</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">'escaped'</font><font color="4444FF">:</font>
            <font color="#444444"># element declared itself as escaped markup, but it isn't really</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">contentparams</font><font color="4444FF">[</font><font color="#008000">'mode'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#008000">'xml'</font>
        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">incontent</font> <strong>and</strong> <font color="#2040a0">self</font>.<font color="#2040a0">contentparams</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'mode'</font><font color="4444FF">)</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">'xml'</font><font color="4444FF">:</font>
            <font color="#2040a0">tag</font> <font color="4444FF">=</font> <font color="#2040a0">tag</font>.<font color="#2040a0">split</font><font color="4444FF">(</font><font color="#008000">':'</font><font color="4444FF">)</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">handle_data</font><font color="4444FF">(</font><font color="#008000">&quot;&lt;/%s&gt;&quot;</font> <font color="4444FF">%</font> <font color="#2040a0">tag</font>, <font color="#2040a0">escape</font><font color="4444FF">=</font><font color="#FF0000">0</font><font color="4444FF">)</font>

        <font color="#444444"># track xml:base and xml:lang going out of scope</font>
        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">basestack</font><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">basestack</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="4444FF">)</font>
            <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">basestack</font> <strong>and</strong> <font color="#2040a0">self</font>.<font color="#2040a0">basestack</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font><font color="4444FF">:</font>
                <font color="#2040a0">self</font>.<font color="#2040a0">baseuri</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">basestack</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font>
        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">langstack</font><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">langstack</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="4444FF">)</font>
            <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">langstack</font><font color="4444FF">:</font> <font color="#444444"># and (self.langstack[-1] is not None):</font>
                <font color="#2040a0">self</font>.<font color="#2040a0">lang</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">langstack</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> handle_charref</font><font color="2040a0">(self, ref)</font>:
</strong>        <font color="#444444"># called for each character reference, e.g. for &quot;&amp;#160;&quot;, ref will be &quot;160&quot;</font>
        <strong>if</strong> <strong>not</strong> <font color="#2040a0">self</font>.<font color="#2040a0">elementstack</font><font color="4444FF">:</font> <strong>return</strong>
        <font color="#2040a0">ref</font> <font color="4444FF">=</font> <font color="#2040a0">ref</font>.<font color="#2040a0">lower</font><font color="4444FF">(</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">ref</font> <strong>in</strong> <font color="4444FF">(</font><font color="#008000">'34'</font>, <font color="#008000">'38'</font>, <font color="#008000">'39'</font>, <font color="#008000">'60'</font>, <font color="#008000">'62'</font>, <font color="#008000">'x22'</font>, <font color="#008000">'x26'</font>, <font color="#008000">'x27'</font>, <font color="#008000">'x3c'</font>, <font color="#008000">'x3e'</font><font color="4444FF">)</font><font color="4444FF">:</font>
            <font color="#2040a0">text</font> <font color="4444FF">=</font> <font color="#008000">&quot;&amp;#%s;&quot;</font> <font color="4444FF">%</font> <font color="#2040a0">ref</font>
        <strong>else</strong><font color="4444FF">:</font>
            <strong>if</strong> <font color="#2040a0">ref</font><font color="4444FF">[</font><font color="#FF0000">0</font><font color="4444FF">]</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">'x'</font><font color="4444FF">:</font>
                <font color="#2040a0">c</font> <font color="4444FF">=</font> <font color="#2040a0">int</font><font color="4444FF">(</font><font color="#2040a0">ref</font><font color="4444FF">[</font><font color="#FF0000">1</font><font color="4444FF">:</font><font color="4444FF">]</font>, <font color="#FF0000">16</font><font color="4444FF">)</font>
            <strong>else</strong><font color="4444FF">:</font>
                <font color="#2040a0">c</font> <font color="4444FF">=</font> <font color="#2040a0">int</font><font color="4444FF">(</font><font color="#2040a0">ref</font><font color="4444FF">)</font>
            <font color="#2040a0">text</font> <font color="4444FF">=</font> <font color="#2040a0">unichr</font><font color="4444FF">(</font><font color="#2040a0">c</font><font color="4444FF">)</font>.<font color="#2040a0">encode</font><font color="4444FF">(</font><font color="#008000">'utf-8'</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">elementstack</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#FF0000">2</font><font color="4444FF">]</font>.<font color="#2040a0">append</font><font color="4444FF">(</font><font color="#2040a0">text</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> handle_entityref</font><font color="2040a0">(self, ref)</font>:
</strong>        <font color="#444444"># called for each entity reference, e.g. for &quot;&amp;copy;&quot;, ref will be &quot;copy&quot;</font>
        <strong>if</strong> <strong>not</strong> <font color="#2040a0">self</font>.<font color="#2040a0">elementstack</font><font color="4444FF">:</font> <strong>return</strong>
        <strong>if</strong> <font color="#2040a0">_debug</font><font color="4444FF">:</font> <font color="#2040a0">sys</font>.<font color="#2040a0">stderr</font>.<font color="#2040a0">write</font><font color="4444FF">(</font><font color="#008000">&quot;entering handle_entityref with %s<font color="#77dd77">\n</font>&quot;</font> <font color="4444FF">%</font> <font color="#2040a0">ref</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">ref</font> <strong>in</strong> <font color="4444FF">(</font><font color="#008000">'lt'</font>, <font color="#008000">'gt'</font>, <font color="#008000">'quot'</font>, <font color="#008000">'amp'</font>, <font color="#008000">'apos'</font><font color="4444FF">)</font><font color="4444FF">:</font>
            <font color="#2040a0">text</font> <font color="4444FF">=</font> <font color="#008000">'&amp;%s;'</font> <font color="4444FF">%</font> <font color="#2040a0">ref</font>
        <strong>else</strong><font color="4444FF">:</font>
            <font color="#444444"># entity resolution graciously donated by Aaron Swartz</font>
<strong>           <font color="ff0000"> def</font><font color="ff0000"> name2cp</font><font color="2040a0">(k)</font>:
</strong>                <strong>import</strong> <font color="#2040a0">htmlentitydefs</font>
                <strong>if</strong> <font color="#2040a0">hasattr</font><font color="4444FF">(</font><font color="#2040a0">htmlentitydefs</font>, <font color="#008000">&quot;name2codepoint&quot;</font><font color="4444FF">)</font><font color="4444FF">:</font> <font color="#444444"># requires Python 2.3</font>
                    <strong>return</strong> <font color="#2040a0">htmlentitydefs</font>.<font color="#2040a0">name2codepoint</font><font color="4444FF">[</font><font color="#2040a0">k</font><font color="4444FF">]</font>
                <font color="#2040a0">k</font> <font color="4444FF">=</font> <font color="#2040a0">htmlentitydefs</font>.<font color="#2040a0">entitydefs</font><font color="4444FF">[</font><font color="#2040a0">k</font><font color="4444FF">]</font>
                <strong>if</strong> <font color="#2040a0">k</font>.<font color="#2040a0">startswith</font><font color="4444FF">(</font><font color="#008000">&quot;&amp;#&quot;</font><font color="4444FF">)</font> <strong>and</strong> <font color="#2040a0">k</font>.<font color="#2040a0">endswith</font><font color="4444FF">(</font><font color="#008000">&quot;;&quot;</font><font color="4444FF">)</font><font color="4444FF">:</font>
                    <strong>return</strong> <font color="#2040a0">int</font><font color="4444FF">(</font><font color="#2040a0">k</font><font color="4444FF">[</font><font color="#FF0000">2</font><font color="4444FF">:</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font><font color="4444FF">)</font> <font color="#444444"># not in latin-1</font>
                <strong>return</strong> <font color="#2040a0">ord</font><font color="4444FF">(</font><font color="#2040a0">k</font><font color="4444FF">)</font>
            <strong>try</strong><font color="4444FF">:</font> <font color="#2040a0">name2cp</font><font color="4444FF">(</font><font color="#2040a0">ref</font><font color="4444FF">)</font>
            <strong>except</strong> <font color="#2040a0">KeyError</font><font color="4444FF">:</font> <font color="#2040a0">text</font> <font color="4444FF">=</font> <font color="#008000">&quot;&amp;%s;&quot;</font> <font color="4444FF">%</font> <font color="#2040a0">ref</font>
            <strong>else</strong><font color="4444FF">:</font> <font color="#2040a0">text</font> <font color="4444FF">=</font> <font color="#2040a0">unichr</font><font color="4444FF">(</font><font color="#2040a0">name2cp</font><font color="4444FF">(</font><font color="#2040a0">ref</font><font color="4444FF">)</font><font color="4444FF">)</font>.<font color="#2040a0">encode</font><font color="4444FF">(</font><font color="#008000">'utf-8'</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">elementstack</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#FF0000">2</font><font color="4444FF">]</font>.<font color="#2040a0">append</font><font color="4444FF">(</font><font color="#2040a0">text</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> handle_data</font><font color="2040a0">(self, text, escape=1)</font>:
</strong>        <font color="#444444"># called for each block of plain text, i.e. outside of any tag and</font>
        <font color="#444444"># not containing any character or entity references</font>
        <strong>if</strong> <strong>not</strong> <font color="#2040a0">self</font>.<font color="#2040a0">elementstack</font><font color="4444FF">:</font> <strong>return</strong>
        <strong>if</strong> <font color="#2040a0">escape</font> <strong>and</strong> <font color="#2040a0">self</font>.<font color="#2040a0">contentparams</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'mode'</font><font color="4444FF">)</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">'xml'</font><font color="4444FF">:</font>
            <font color="#2040a0">text</font> <font color="4444FF">=</font> <font color="#2040a0">_xmlescape</font><font color="4444FF">(</font><font color="#2040a0">text</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">elementstack</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#FF0000">2</font><font color="4444FF">]</font>.<font color="#2040a0">append</font><font color="4444FF">(</font><font color="#2040a0">text</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> handle_comment</font><font color="2040a0">(self, text)</font>:
</strong>        <font color="#444444"># called for each comment, e.g. &lt;!-- insert message here --&gt;</font>
        <strong>pass</strong>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> handle_pi</font><font color="2040a0">(self, text)</font>:
</strong>        <font color="#444444"># called for each processing instruction, e.g. &lt;?instruction&gt;</font>
        <strong>pass</strong>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> handle_decl</font><font color="2040a0">(self, text)</font>:
</strong>        <strong>pass</strong>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> parse_declaration</font><font color="2040a0">(self, i)</font>:
</strong>        <font color="#444444"># override internal declaration handler to handle CDATA blocks</font>
        <strong>if</strong> <font color="#2040a0">_debug</font><font color="4444FF">:</font> <font color="#2040a0">sys</font>.<font color="#2040a0">stderr</font>.<font color="#2040a0">write</font><font color="4444FF">(</font><font color="#008000">&quot;entering parse_declaration<font color="#77dd77">\n</font>&quot;</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">rawdata</font><font color="4444FF">[</font><font color="#2040a0">i</font><font color="4444FF">:</font><font color="#2040a0">i</font><font color="4444FF">+</font><font color="#FF0000">9</font><font color="4444FF">]</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">'&lt;![CDATA['</font><font color="4444FF">:</font>
            <font color="#2040a0">k</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">rawdata</font>.<font color="#2040a0">find</font><font color="4444FF">(</font><font color="#008000">']]&gt;'</font>, <font color="#2040a0">i</font><font color="4444FF">)</font>
            <strong>if</strong> <font color="#2040a0">k</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">:</font> <font color="#2040a0">k</font> <font color="4444FF">=</font> <font color="#2040a0">len</font><font color="4444FF">(</font><font color="#2040a0">self</font>.<font color="#2040a0">rawdata</font><font color="4444FF">)</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">handle_data</font><font color="4444FF">(</font><font color="#2040a0">_xmlescape</font><font color="4444FF">(</font><font color="#2040a0">self</font>.<font color="#2040a0">rawdata</font><font color="4444FF">[</font><font color="#2040a0">i</font><font color="4444FF">+</font><font color="#FF0000">9</font><font color="4444FF">:</font><font color="#2040a0">k</font><font color="4444FF">]</font><font color="4444FF">)</font>, <font color="#FF0000">0</font><font color="4444FF">)</font>
            <strong>return</strong> <font color="#2040a0">k</font><font color="4444FF">+</font><font color="#FF0000">3</font>
        <strong>else</strong><font color="4444FF">:</font>
            <font color="#2040a0">k</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">rawdata</font>.<font color="#2040a0">find</font><font color="4444FF">(</font><font color="#008000">'&gt;'</font>, <font color="#2040a0">i</font><font color="4444FF">)</font>
            <strong>return</strong> <font color="#2040a0">k</font><font color="4444FF">+</font><font color="#FF0000">1</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> trackNamespace</font><font color="2040a0">(self, prefix, uri)</font>:
</strong>        <strong>if</strong> <font color="4444FF">(</font><font color="#2040a0">prefix</font>, <font color="#2040a0">uri</font><font color="4444FF">)</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="4444FF">(</font><font color="#2040a0">None</font>, <font color="#008000">'http://my.netscape.com/rdf/simple/0.9/'</font><font color="4444FF">)</font> <strong>and</strong> <strong>not</strong> <font color="#2040a0">self</font>.<font color="#2040a0">version</font><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">version</font> <font color="4444FF">=</font> <font color="#008000">'rss090'</font>
        <strong>if</strong> <font color="#2040a0">uri</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">'http://purl.org/rss/1.0/'</font> <strong>and</strong> <strong>not</strong> <font color="#2040a0">self</font>.<font color="#2040a0">version</font><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">version</font> <font color="4444FF">=</font> <font color="#008000">'rss10'</font>
        <strong>if</strong> <strong>not</strong> <font color="#2040a0">prefix</font><font color="4444FF">:</font> <strong>return</strong>
        <strong>if</strong> <font color="#2040a0">uri</font>.<font color="#2040a0">find</font><font color="4444FF">(</font><font color="#008000">'backend.userland.com/rss'</font><font color="4444FF">)</font> <font color="4444FF">&lt;</font><font color="4444FF">&gt;</font> <font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">:</font>
            <font color="#444444"># match any backend.userland.com namespace</font>
            <font color="#2040a0">uri</font> <font color="4444FF">=</font> <font color="#008000">'http://backend.userland.com/rss'</font>
        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">namespaces</font>.<font color="#2040a0">has_key</font><font color="4444FF">(</font><font color="#2040a0">uri</font><font color="4444FF">)</font><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">namespacemap</font><font color="4444FF">[</font><font color="#2040a0">prefix</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">namespaces</font><font color="4444FF">[</font><font color="#2040a0">uri</font><font color="4444FF">]</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> resolveURI</font><font color="2040a0">(self, uri)</font>:
</strong>        <strong>return</strong> <font color="#2040a0">urlparse</font>.<font color="#2040a0">urljoin</font><font color="4444FF">(</font><font color="#2040a0">self</font>.<font color="#2040a0">baseuri</font> <strong>or</strong> <font color="#008000">''</font>, <font color="#2040a0">uri</font><font color="4444FF">)</font>
    
<strong>   <font color="ff0000"> def</font><font color="ff0000"> decodeEntities</font><font color="2040a0">(self, element, data)</font>:
</strong>        <strong>return</strong> <font color="#2040a0">data</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> push</font><font color="2040a0">(self, element, expectingText)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">elementstack</font>.<font color="#2040a0">append</font><font color="4444FF">(</font><font color="4444FF">[</font><font color="#2040a0">element</font>, <font color="#2040a0">expectingText</font>, <font color="4444FF">[</font><font color="4444FF">]</font><font color="4444FF">]</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> pop</font><font color="2040a0">(self, element)</font>:
</strong>        <strong>if</strong> <strong>not</strong> <font color="#2040a0">self</font>.<font color="#2040a0">elementstack</font><font color="4444FF">:</font> <strong>return</strong>
        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">elementstack</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#FF0000">0</font><font color="4444FF">]</font> <font color="4444FF">!</font><font color="4444FF">=</font> <font color="#2040a0">element</font><font color="4444FF">:</font> <strong>return</strong>

        <font color="#2040a0">element</font>, <font color="#2040a0">expectingText</font>, <font color="#2040a0">pieces</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">elementstack</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="4444FF">)</font>
        <font color="#2040a0">output</font> <font color="4444FF">=</font> <font color="#008000">&quot;&quot;</font>.<font color="#2040a0">join</font><font color="4444FF">(</font><font color="#2040a0">pieces</font><font color="4444FF">)</font>
        <font color="#2040a0">output</font> <font color="4444FF">=</font> <font color="#2040a0">output</font>.<font color="#2040a0">strip</font><font color="4444FF">(</font><font color="4444FF">)</font>
        <strong>if</strong> <strong>not</strong> <font color="#2040a0">expectingText</font><font color="4444FF">:</font> <strong>return</strong> <font color="#2040a0">output</font>
        
        <font color="#444444"># decode base64 content</font>
        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">contentparams</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'mode'</font><font color="4444FF">)</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">'base64'</font> <strong>and</strong> <font color="#2040a0">base64</font><font color="4444FF">:</font>
            <strong>try</strong><font color="4444FF">:</font>
                <font color="#2040a0">output</font> <font color="4444FF">=</font> <font color="#2040a0">base64</font>.<font color="#2040a0">decodestring</font><font color="4444FF">(</font><font color="#2040a0">output</font><font color="4444FF">)</font>
            <strong>except</strong> <font color="#2040a0">binascii</font>.<font color="#2040a0">Error</font><font color="4444FF">:</font>
                <strong>pass</strong>
            <strong>except</strong> <font color="#2040a0">binascii</font>.<font color="#2040a0">Incomplete</font><font color="4444FF">:</font>
                <strong>pass</strong>
                
        <font color="#444444"># resolve relative URIs</font>
        <strong>if</strong> <font color="4444FF">(</font><font color="#2040a0">element</font> <strong>in</strong> <font color="#2040a0">self</font>.<font color="#2040a0">can_be_relative_uri</font><font color="4444FF">)</font> <strong>and</strong> <font color="#2040a0">output</font><font color="4444FF">:</font>
            <font color="#2040a0">output</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">resolveURI</font><font color="4444FF">(</font><font color="#2040a0">output</font><font color="4444FF">)</font>
        
        <font color="#444444"># decode entities within embedded markup</font>
        <font color="#2040a0">output</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">decodeEntities</font><font color="4444FF">(</font><font color="#2040a0">element</font>, <font color="#2040a0">output</font><font color="4444FF">)</font>

        <font color="#444444"># resolve relative URIs within embedded markup</font>
        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">contentparams</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'type'</font>, <font color="#008000">'text/html'</font><font color="4444FF">)</font> <strong>in</strong> <font color="#2040a0">self</font>.<font color="#2040a0">html_types</font><font color="4444FF">:</font>
            <strong>if</strong> <font color="#2040a0">element</font> <strong>in</strong> <font color="#2040a0">self</font>.<font color="#2040a0">can_contain_relative_uris</font><font color="4444FF">:</font>
                <font color="#2040a0">output</font> <font color="4444FF">=</font> <font color="#2040a0">_resolveRelativeURIs</font><font color="4444FF">(</font><font color="#2040a0">output</font>, <font color="#2040a0">self</font>.<font color="#2040a0">baseuri</font>, <font color="#2040a0">self</font>.<font color="#2040a0">encoding</font><font color="4444FF">)</font>
        
        <font color="#444444"># sanitize embedded markup</font>
        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">contentparams</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'type'</font>, <font color="#008000">'text/html'</font><font color="4444FF">)</font> <strong>in</strong> <font color="#2040a0">self</font>.<font color="#2040a0">html_types</font><font color="4444FF">:</font>
            <strong>if</strong> <font color="#2040a0">element</font> <strong>in</strong> <font color="#2040a0">self</font>.<font color="#2040a0">can_contain_dangerous_markup</font><font color="4444FF">:</font>
                <font color="#2040a0">output</font> <font color="4444FF">=</font> <font color="#2040a0">_sanitizeHTML</font><font color="4444FF">(</font><font color="#2040a0">output</font>, <font color="#2040a0">self</font>.<font color="#2040a0">encoding</font><font color="4444FF">)</font>

        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">encoding</font> <strong>and</strong> <font color="4444FF">(</font><font color="#2040a0">type</font><font color="4444FF">(</font><font color="#2040a0">output</font><font color="4444FF">)</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#2040a0">types</font>.<font color="#2040a0">StringType</font><font color="4444FF">)</font><font color="4444FF">:</font>
            <strong>try</strong><font color="4444FF">:</font>
                <font color="#2040a0">output</font> <font color="4444FF">=</font> <font color="#2040a0">unicode</font><font color="4444FF">(</font><font color="#2040a0">output</font>, <font color="#2040a0">self</font>.<font color="#2040a0">encoding</font><font color="4444FF">)</font>
            <strong>except</strong><font color="4444FF">:</font>
                <strong>pass</strong>
            
        <font color="#444444"># store output in appropriate place(s)</font>
        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">inentry</font><font color="4444FF">:</font>
            <strong>if</strong> <font color="#2040a0">element</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">'content'</font><font color="4444FF">:</font>
                <font color="#2040a0">self</font>.<font color="#2040a0">entries</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font>.<font color="#2040a0">setdefault</font><font color="4444FF">(</font><font color="#2040a0">element</font>, <font color="4444FF">[</font><font color="4444FF">]</font><font color="4444FF">)</font>
                <font color="#2040a0">contentparams</font> <font color="4444FF">=</font> <font color="#2040a0">copy</font>.<font color="#2040a0">deepcopy</font><font color="4444FF">(</font><font color="#2040a0">self</font>.<font color="#2040a0">contentparams</font><font color="4444FF">)</font>
                <font color="#2040a0">contentparams</font><font color="4444FF">[</font><font color="#008000">'value'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">output</font>
                <font color="#2040a0">self</font>.<font color="#2040a0">entries</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#2040a0">element</font><font color="4444FF">]</font>.<font color="#2040a0">append</font><font color="4444FF">(</font><font color="#2040a0">contentparams</font><font color="4444FF">)</font>
            <strong>elif</strong> <font color="#2040a0">element</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">'category'</font><font color="4444FF">:</font>
                <font color="#2040a0">self</font>.<font color="#2040a0">entries</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#2040a0">element</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">output</font>
                <font color="#2040a0">domain</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">entries</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#008000">'categories'</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#FF0000">0</font><font color="4444FF">]</font>
                <font color="#2040a0">self</font>.<font color="#2040a0">entries</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#008000">'categories'</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="4444FF">(</font><font color="#2040a0">domain</font>, <font color="#2040a0">output</font><font color="4444FF">)</font>
            <strong>elif</strong> <font color="#2040a0">element</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">'source'</font><font color="4444FF">:</font>
                <font color="#2040a0">self</font>.<font color="#2040a0">entries</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#008000">'source'</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#008000">'value'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">output</font>
            <strong>elif</strong> <font color="#2040a0">element</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">'link'</font><font color="4444FF">:</font>
                <font color="#2040a0">self</font>.<font color="#2040a0">entries</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#2040a0">element</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">output</font>
                <strong>if</strong> <font color="#2040a0">output</font><font color="4444FF">:</font>
                    <font color="#2040a0">self</font>.<font color="#2040a0">entries</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#008000">'links'</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#008000">'href'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">output</font>
            <strong>else</strong><font color="4444FF">:</font>
                <strong>if</strong> <font color="#2040a0">element</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">'description'</font><font color="4444FF">:</font>
                    <font color="#2040a0">element</font> <font color="4444FF">=</font> <font color="#008000">'summary'</font>
                <font color="#2040a0">self</font>.<font color="#2040a0">entries</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#2040a0">element</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">output</font>
                <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">incontent</font><font color="4444FF">:</font>
                    <font color="#2040a0">contentparams</font> <font color="4444FF">=</font> <font color="#2040a0">copy</font>.<font color="#2040a0">deepcopy</font><font color="4444FF">(</font><font color="#2040a0">self</font>.<font color="#2040a0">contentparams</font><font color="4444FF">)</font>
                    <font color="#2040a0">contentparams</font><font color="4444FF">[</font><font color="#008000">'value'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">output</font>
                    <font color="#2040a0">self</font>.<font color="#2040a0">entries</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#2040a0">element</font> <font color="4444FF">+</font> <font color="#008000">'_detail'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">contentparams</font>
        <strong>elif</strong> <font color="#2040a0">self</font>.<font color="#2040a0">infeed</font> <strong>and</strong> <font color="4444FF">(</font><strong>not</strong> <font color="#2040a0">self</font>.<font color="#2040a0">intextinput</font><font color="4444FF">)</font> <strong>and</strong> <font color="4444FF">(</font><strong>not</strong> <font color="#2040a0">self</font>.<font color="#2040a0">inimage</font><font color="4444FF">)</font><font color="4444FF">:</font>
            <strong>if</strong> <font color="#2040a0">element</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">'description'</font><font color="4444FF">:</font>
                <font color="#2040a0">element</font> <font color="4444FF">=</font> <font color="#008000">'tagline'</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">feeddata</font><font color="4444FF">[</font><font color="#2040a0">element</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">output</font>
            <strong>if</strong> <font color="#2040a0">element</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">'category'</font><font color="4444FF">:</font>
                <font color="#2040a0">domain</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">feeddata</font><font color="4444FF">[</font><font color="#008000">'categories'</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#FF0000">0</font><font color="4444FF">]</font>
                <font color="#2040a0">self</font>.<font color="#2040a0">feeddata</font><font color="4444FF">[</font><font color="#008000">'categories'</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="4444FF">(</font><font color="#2040a0">domain</font>, <font color="#2040a0">output</font><font color="4444FF">)</font>
            <strong>elif</strong> <font color="#2040a0">element</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">'link'</font><font color="4444FF">:</font>
                <font color="#2040a0">self</font>.<font color="#2040a0">feeddata</font><font color="4444FF">[</font><font color="#008000">'links'</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#008000">'href'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">output</font>
            <strong>elif</strong> <font color="#2040a0">self</font>.<font color="#2040a0">incontent</font><font color="4444FF">:</font>
                <font color="#2040a0">contentparams</font> <font color="4444FF">=</font> <font color="#2040a0">copy</font>.<font color="#2040a0">deepcopy</font><font color="4444FF">(</font><font color="#2040a0">self</font>.<font color="#2040a0">contentparams</font><font color="4444FF">)</font>
                <font color="#2040a0">contentparams</font><font color="4444FF">[</font><font color="#008000">'value'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">output</font>
                <font color="#2040a0">self</font>.<font color="#2040a0">feeddata</font><font color="4444FF">[</font><font color="#2040a0">element</font> <font color="4444FF">+</font> <font color="#008000">'_detail'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">contentparams</font>
        <strong>return</strong> <font color="#2040a0">output</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _mapToStandardPrefix</font><font color="2040a0">(self, name)</font>:
</strong>        <font color="#2040a0">colonpos</font> <font color="4444FF">=</font> <font color="#2040a0">name</font>.<font color="#2040a0">find</font><font color="4444FF">(</font><font color="#008000">':'</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">colonpos</font> <font color="4444FF">&lt;</font><font color="4444FF">&gt;</font> <font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">:</font>
            <font color="#2040a0">prefix</font> <font color="4444FF">=</font> <font color="#2040a0">name</font><font color="4444FF">[</font><font color="4444FF">:</font><font color="#2040a0">colonpos</font><font color="4444FF">]</font>
            <font color="#2040a0">suffix</font> <font color="4444FF">=</font> <font color="#2040a0">name</font><font color="4444FF">[</font><font color="#2040a0">colonpos</font><font color="4444FF">+</font><font color="#FF0000">1</font><font color="4444FF">:</font><font color="4444FF">]</font>
            <font color="#2040a0">prefix</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">namespacemap</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#2040a0">prefix</font>, <font color="#2040a0">prefix</font><font color="4444FF">)</font>
            <font color="#2040a0">name</font> <font color="4444FF">=</font> <font color="#2040a0">prefix</font> <font color="4444FF">+</font> <font color="#008000">':'</font> <font color="4444FF">+</font> <font color="#2040a0">suffix</font>
        <strong>return</strong> <font color="#2040a0">name</font>
        
<strong>   <font color="ff0000"> def</font><font color="ff0000"> _getAttribute</font><font color="2040a0">(self, attrsD, name)</font>:
</strong>        <strong>return</strong> <font color="#2040a0">attrsD</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#2040a0">self</font>.<font color="#2040a0">_mapToStandardPrefix</font><font color="4444FF">(</font><font color="#2040a0">name</font><font color="4444FF">)</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _save</font><font color="2040a0">(self, key, value)</font>:
</strong>        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">inentry</font><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">entries</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font>.<font color="#2040a0">setdefault</font><font color="4444FF">(</font><font color="#2040a0">key</font>, <font color="#2040a0">value</font><font color="4444FF">)</font>
        <strong>elif</strong> <font color="#2040a0">self</font>.<font color="#2040a0">feeddata</font><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">feeddata</font>.<font color="#2040a0">setdefault</font><font color="4444FF">(</font><font color="#2040a0">key</font>, <font color="#2040a0">value</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_rss</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">versionmap</font> <font color="4444FF">=</font> <font color="4444FF"><strong>{</strong></font><font color="#008000">'0.91'</font><font color="4444FF">:</font> <font color="#008000">'rss091u'</font>,
                      <font color="#008000">'0.92'</font><font color="4444FF">:</font> <font color="#008000">'rss092'</font>,
                      <font color="#008000">'0.93'</font><font color="4444FF">:</font> <font color="#008000">'rss093'</font>,
                      <font color="#008000">'0.94'</font><font color="4444FF">:</font> <font color="#008000">'rss094'</font><font color="4444FF"><strong>}</strong></font>
        <strong>if</strong> <strong>not</strong> <font color="#2040a0">self</font>.<font color="#2040a0">version</font><font color="4444FF">:</font>
            <font color="#2040a0">attr_version</font> <font color="4444FF">=</font> <font color="#2040a0">attrsD</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'version'</font>, <font color="#008000">''</font><font color="4444FF">)</font>
            <font color="#2040a0">version</font> <font color="4444FF">=</font> <font color="#2040a0">versionmap</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#2040a0">attr_version</font><font color="4444FF">)</font>
            <strong>if</strong> <font color="#2040a0">version</font><font color="4444FF">:</font>
                <font color="#2040a0">self</font>.<font color="#2040a0">version</font> <font color="4444FF">=</font> <font color="#2040a0">version</font>
            <strong>elif</strong> <font color="#2040a0">attr_version</font>.<font color="#2040a0">startswith</font><font color="4444FF">(</font><font color="#008000">'2.'</font><font color="4444FF">)</font><font color="4444FF">:</font>
                <font color="#2040a0">self</font>.<font color="#2040a0">version</font> <font color="4444FF">=</font> <font color="#008000">'rss20'</font>
            <strong>else</strong><font color="4444FF">:</font>
                <font color="#2040a0">self</font>.<font color="#2040a0">version</font> <font color="4444FF">=</font> <font color="#008000">'rss'</font>
    
<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_dlhottitles</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">version</font> <font color="4444FF">=</font> <font color="#008000">'hotrss'</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_channel</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">infeed</font> <font color="4444FF">=</font> <font color="#FF0000">1</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">_cdf_common</font><font color="4444FF">(</font><font color="#2040a0">attrsD</font><font color="4444FF">)</font>
    <font color="#2040a0">_start_feedinfo</font> <font color="4444FF">=</font> <font color="#2040a0">_start_channel</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _cdf_common</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <strong>if</strong> <font color="#2040a0">attrsD</font>.<font color="#2040a0">has_key</font><font color="4444FF">(</font><font color="#008000">'lastmod'</font><font color="4444FF">)</font><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">_start_modified</font><font color="4444FF">(</font><font color="4444FF"><strong>{</strong></font><font color="4444FF"><strong>}</strong></font><font color="4444FF">)</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">elementstack</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">attrsD</font><font color="4444FF">[</font><font color="#008000">'lastmod'</font><font color="4444FF">]</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">_end_modified</font><font color="4444FF">(</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">attrsD</font>.<font color="#2040a0">has_key</font><font color="4444FF">(</font><font color="#008000">'href'</font><font color="4444FF">)</font><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">_start_link</font><font color="4444FF">(</font><font color="4444FF"><strong>{</strong></font><font color="4444FF"><strong>}</strong></font><font color="4444FF">)</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">elementstack</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">attrsD</font><font color="4444FF">[</font><font color="#008000">'href'</font><font color="4444FF">]</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">_end_link</font><font color="4444FF">(</font><font color="4444FF">)</font>
    
<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_feed</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">infeed</font> <font color="4444FF">=</font> <font color="#FF0000">1</font>
        <font color="#2040a0">versionmap</font> <font color="4444FF">=</font> <font color="4444FF"><strong>{</strong></font><font color="#008000">'0.1'</font><font color="4444FF">:</font> <font color="#008000">'atom01'</font>,
                      <font color="#008000">'0.2'</font><font color="4444FF">:</font> <font color="#008000">'atom02'</font>,
                      <font color="#008000">'0.3'</font><font color="4444FF">:</font> <font color="#008000">'atom03'</font><font color="4444FF"><strong>}</strong></font>
        <strong>if</strong> <strong>not</strong> <font color="#2040a0">self</font>.<font color="#2040a0">version</font><font color="4444FF">:</font>
            <font color="#2040a0">attr_version</font> <font color="4444FF">=</font> <font color="#2040a0">attrsD</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'version'</font><font color="4444FF">)</font>
            <font color="#2040a0">version</font> <font color="4444FF">=</font> <font color="#2040a0">versionmap</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#2040a0">attr_version</font><font color="4444FF">)</font>
            <strong>if</strong> <font color="#2040a0">version</font><font color="4444FF">:</font>
                <font color="#2040a0">self</font>.<font color="#2040a0">version</font> <font color="4444FF">=</font> <font color="#2040a0">version</font>
            <strong>else</strong><font color="4444FF">:</font>
                <font color="#2040a0">self</font>.<font color="#2040a0">version</font> <font color="4444FF">=</font> <font color="#008000">'atom'</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _end_channel</font><font color="2040a0">(self)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">infeed</font> <font color="4444FF">=</font> <font color="#FF0000">0</font>
    <font color="#2040a0">_end_feed</font> <font color="4444FF">=</font> <font color="#2040a0">_end_channel</font>
    
<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_image</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">inimage</font> <font color="4444FF">=</font> <font color="#FF0000">1</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'image'</font>, <font color="#FF0000">0</font><font color="4444FF">)</font>
        <font color="#2040a0">context</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">_getContext</font><font color="4444FF">(</font><font color="4444FF">)</font>
        <font color="#2040a0">context</font>.<font color="#2040a0">setdefault</font><font color="4444FF">(</font><font color="#008000">'image'</font>, <font color="#2040a0">FeedParserDict</font><font color="4444FF">(</font><font color="4444FF">)</font><font color="4444FF">)</font>
            
<strong>   <font color="ff0000"> def</font><font color="ff0000"> _end_image</font><font color="2040a0">(self)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="#008000">'image'</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">inimage</font> <font color="4444FF">=</font> <font color="#FF0000">0</font>
                
<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_textinput</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">intextinput</font> <font color="4444FF">=</font> <font color="#FF0000">1</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'textinput'</font>, <font color="#FF0000">0</font><font color="4444FF">)</font>
        <font color="#2040a0">context</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">_getContext</font><font color="4444FF">(</font><font color="4444FF">)</font>
        <font color="#2040a0">context</font>.<font color="#2040a0">setdefault</font><font color="4444FF">(</font><font color="#008000">'textinput'</font>, <font color="#2040a0">FeedParserDict</font><font color="4444FF">(</font><font color="4444FF">)</font><font color="4444FF">)</font>
    <font color="#2040a0">_start_textInput</font> <font color="4444FF">=</font> <font color="#2040a0">_start_textinput</font>
    
<strong>   <font color="ff0000"> def</font><font color="ff0000"> _end_textinput</font><font color="2040a0">(self)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="#008000">'textinput'</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">intextinput</font> <font color="4444FF">=</font> <font color="#FF0000">0</font>
    <font color="#2040a0">_end_textInput</font> <font color="4444FF">=</font> <font color="#2040a0">_end_textinput</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_author</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">inauthor</font> <font color="4444FF">=</font> <font color="#FF0000">1</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'author'</font>, <font color="#FF0000">1</font><font color="4444FF">)</font>
    <font color="#2040a0">_start_managingeditor</font> <font color="4444FF">=</font> <font color="#2040a0">_start_author</font>
    <font color="#2040a0">_start_dc_author</font> <font color="4444FF">=</font> <font color="#2040a0">_start_author</font>
    <font color="#2040a0">_start_dc_creator</font> <font color="4444FF">=</font> <font color="#2040a0">_start_author</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _end_author</font><font color="2040a0">(self)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="#008000">'author'</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">inauthor</font> <font color="4444FF">=</font> <font color="#FF0000">0</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">_sync_author_detail</font><font color="4444FF">(</font><font color="4444FF">)</font>
    <font color="#2040a0">_end_managingeditor</font> <font color="4444FF">=</font> <font color="#2040a0">_end_author</font>
    <font color="#2040a0">_end_dc_author</font> <font color="4444FF">=</font> <font color="#2040a0">_end_author</font>
    <font color="#2040a0">_end_dc_creator</font> <font color="4444FF">=</font> <font color="#2040a0">_end_author</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_contributor</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">incontributor</font> <font color="4444FF">=</font> <font color="#FF0000">1</font>
        <font color="#2040a0">context</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">_getContext</font><font color="4444FF">(</font><font color="4444FF">)</font>
        <font color="#2040a0">context</font>.<font color="#2040a0">setdefault</font><font color="4444FF">(</font><font color="#008000">'contributors'</font>, <font color="4444FF">[</font><font color="4444FF">]</font><font color="4444FF">)</font>
        <font color="#2040a0">context</font><font color="4444FF">[</font><font color="#008000">'contributors'</font><font color="4444FF">]</font>.<font color="#2040a0">append</font><font color="4444FF">(</font><font color="#2040a0">FeedParserDict</font><font color="4444FF">(</font><font color="4444FF">)</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'contributor'</font>, <font color="#FF0000">0</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _end_contributor</font><font color="2040a0">(self)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="#008000">'contributor'</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">incontributor</font> <font color="4444FF">=</font> <font color="#FF0000">0</font>
        
<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_name</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'name'</font>, <font color="#FF0000">0</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _end_name</font><font color="2040a0">(self)</font>:
</strong>        <font color="#2040a0">value</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="#008000">'name'</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">inauthor</font><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">_save_author</font><font color="4444FF">(</font><font color="#008000">'name'</font>, <font color="#2040a0">value</font><font color="4444FF">)</font>
        <strong>elif</strong> <font color="#2040a0">self</font>.<font color="#2040a0">incontributor</font><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">_save_contributor</font><font color="4444FF">(</font><font color="#008000">'name'</font>, <font color="#2040a0">value</font><font color="4444FF">)</font>
        <strong>elif</strong> <font color="#2040a0">self</font>.<font color="#2040a0">intextinput</font><font color="4444FF">:</font>
            <font color="#2040a0">context</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">_getContext</font><font color="4444FF">(</font><font color="4444FF">)</font>
            <font color="#2040a0">context</font><font color="4444FF">[</font><font color="#008000">'textinput'</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#008000">'name'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">value</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_width</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'width'</font>, <font color="#FF0000">0</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _end_width</font><font color="2040a0">(self)</font>:
</strong>        <font color="#2040a0">value</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="#008000">'width'</font><font color="4444FF">)</font>
        <strong>try</strong><font color="4444FF">:</font>
            <font color="#2040a0">value</font> <font color="4444FF">=</font> <font color="#2040a0">int</font><font color="4444FF">(</font><font color="#2040a0">value</font><font color="4444FF">)</font>
        <strong>except</strong><font color="4444FF">:</font>
            <font color="#2040a0">value</font> <font color="4444FF">=</font> <font color="#FF0000">0</font>
        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">inimage</font><font color="4444FF">:</font>
            <font color="#2040a0">context</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">_getContext</font><font color="4444FF">(</font><font color="4444FF">)</font>
            <font color="#2040a0">context</font><font color="4444FF">[</font><font color="#008000">'image'</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#008000">'width'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">value</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_height</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'height'</font>, <font color="#FF0000">0</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _end_height</font><font color="2040a0">(self)</font>:
</strong>        <font color="#2040a0">value</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="#008000">'height'</font><font color="4444FF">)</font>
        <strong>try</strong><font color="4444FF">:</font>
            <font color="#2040a0">value</font> <font color="4444FF">=</font> <font color="#2040a0">int</font><font color="4444FF">(</font><font color="#2040a0">value</font><font color="4444FF">)</font>
        <strong>except</strong><font color="4444FF">:</font>
            <font color="#2040a0">value</font> <font color="4444FF">=</font> <font color="#FF0000">0</font>
        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">inimage</font><font color="4444FF">:</font>
            <font color="#2040a0">context</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">_getContext</font><font color="4444FF">(</font><font color="4444FF">)</font>
            <font color="#2040a0">context</font><font color="4444FF">[</font><font color="#008000">'image'</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#008000">'height'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">value</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_url</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'url'</font>, <font color="#FF0000">1</font><font color="4444FF">)</font>
    <font color="#2040a0">_start_homepage</font> <font color="4444FF">=</font> <font color="#2040a0">_start_url</font>
    <font color="#2040a0">_start_uri</font> <font color="4444FF">=</font> <font color="#2040a0">_start_url</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _end_url</font><font color="2040a0">(self)</font>:
</strong>        <font color="#2040a0">value</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="#008000">'url'</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">inauthor</font><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">_save_author</font><font color="4444FF">(</font><font color="#008000">'url'</font>, <font color="#2040a0">value</font><font color="4444FF">)</font>
        <strong>elif</strong> <font color="#2040a0">self</font>.<font color="#2040a0">incontributor</font><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">_save_contributor</font><font color="4444FF">(</font><font color="#008000">'url'</font>, <font color="#2040a0">value</font><font color="4444FF">)</font>
        <strong>elif</strong> <font color="#2040a0">self</font>.<font color="#2040a0">inimage</font><font color="4444FF">:</font>
            <font color="#2040a0">context</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">_getContext</font><font color="4444FF">(</font><font color="4444FF">)</font>
            <font color="#2040a0">context</font><font color="4444FF">[</font><font color="#008000">'image'</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#008000">'url'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">value</font>
        <strong>elif</strong> <font color="#2040a0">self</font>.<font color="#2040a0">intextinput</font><font color="4444FF">:</font>
            <font color="#2040a0">context</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">_getContext</font><font color="4444FF">(</font><font color="4444FF">)</font>
            <font color="#2040a0">context</font><font color="4444FF">[</font><font color="#008000">'textinput'</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#008000">'link'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">value</font>
    <font color="#2040a0">_end_homepage</font> <font color="4444FF">=</font> <font color="#2040a0">_end_url</font>
    <font color="#2040a0">_end_uri</font> <font color="4444FF">=</font> <font color="#2040a0">_end_url</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_email</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'email'</font>, <font color="#FF0000">0</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _end_email</font><font color="2040a0">(self)</font>:
</strong>        <font color="#2040a0">value</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="#008000">'email'</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">inauthor</font><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">_save_author</font><font color="4444FF">(</font><font color="#008000">'email'</font>, <font color="#2040a0">value</font><font color="4444FF">)</font>
        <strong>elif</strong> <font color="#2040a0">self</font>.<font color="#2040a0">incontributor</font><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">_save_contributor</font><font color="4444FF">(</font><font color="#008000">'email'</font>, <font color="#2040a0">value</font><font color="4444FF">)</font>
            <strong>pass</strong>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _getContext</font><font color="2040a0">(self)</font>:
</strong>        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">inentry</font><font color="4444FF">:</font>
            <font color="#2040a0">context</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">entries</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font>
        <strong>else</strong><font color="4444FF">:</font>
            <font color="#2040a0">context</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">feeddata</font>
        <strong>return</strong> <font color="#2040a0">context</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _save_author</font><font color="2040a0">(self, key, value)</font>:
</strong>        <font color="#2040a0">context</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">_getContext</font><font color="4444FF">(</font><font color="4444FF">)</font>
        <font color="#2040a0">context</font>.<font color="#2040a0">setdefault</font><font color="4444FF">(</font><font color="#008000">'author_detail'</font>, <font color="#2040a0">FeedParserDict</font><font color="4444FF">(</font><font color="4444FF">)</font><font color="4444FF">)</font>
        <font color="#2040a0">context</font><font color="4444FF">[</font><font color="#008000">'author_detail'</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#2040a0">key</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">value</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">_sync_author_detail</font><font color="4444FF">(</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _save_contributor</font><font color="2040a0">(self, key, value)</font>:
</strong>        <font color="#2040a0">context</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">_getContext</font><font color="4444FF">(</font><font color="4444FF">)</font>
        <font color="#2040a0">context</font>.<font color="#2040a0">setdefault</font><font color="4444FF">(</font><font color="#008000">'contributors'</font>, <font color="4444FF">[</font><font color="#2040a0">FeedParserDict</font><font color="4444FF">(</font><font color="4444FF">)</font><font color="4444FF">]</font><font color="4444FF">)</font>
        <font color="#2040a0">context</font><font color="4444FF">[</font><font color="#008000">'contributors'</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#2040a0">key</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">value</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _sync_author_detail</font><font color="2040a0">(self, key='author')</font>:
</strong>        <font color="#2040a0">context</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">_getContext</font><font color="4444FF">(</font><font color="4444FF">)</font>
        <font color="#2040a0">detail</font> <font color="4444FF">=</font> <font color="#2040a0">context</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'%s_detail'</font> <font color="4444FF">%</font> <font color="#2040a0">key</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">detail</font><font color="4444FF">:</font>
            <font color="#2040a0">name</font> <font color="4444FF">=</font> <font color="#2040a0">detail</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'name'</font><font color="4444FF">)</font>
            <font color="#2040a0">email</font> <font color="4444FF">=</font> <font color="#2040a0">detail</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'email'</font><font color="4444FF">)</font>
            <strong>if</strong> <font color="#2040a0">name</font> <strong>and</strong> <font color="#2040a0">email</font><font color="4444FF">:</font>
                <font color="#2040a0">context</font><font color="4444FF">[</font><font color="#2040a0">key</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#008000">&quot;%s (%s)&quot;</font> <font color="4444FF">%</font> <font color="4444FF">(</font><font color="#2040a0">name</font>, <font color="#2040a0">email</font><font color="4444FF">)</font>
            <strong>elif</strong> <font color="#2040a0">name</font><font color="4444FF">:</font>
                <font color="#2040a0">context</font><font color="4444FF">[</font><font color="#2040a0">key</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">name</font>
            <strong>elif</strong> <font color="#2040a0">email</font><font color="4444FF">:</font>
                <font color="#2040a0">context</font><font color="4444FF">[</font><font color="#2040a0">key</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">email</font>
        <strong>else</strong><font color="4444FF">:</font>
            <font color="#2040a0">author</font> <font color="4444FF">=</font> <font color="#2040a0">context</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#2040a0">key</font><font color="4444FF">)</font>
            <strong>if</strong> <strong>not</strong> <font color="#2040a0">author</font><font color="4444FF">:</font> <strong>return</strong>
            <font color="#2040a0">emailmatch</font> <font color="4444FF">=</font> <font color="#2040a0">re</font>.<font color="#2040a0">search</font><font color="4444FF">(</font><font color="#2040a0">r</font><font color="#008000">&quot;&quot;</font><font color="#008000">&quot;(([a-zA-Z0-9<font color="#77dd77">\_</font><font color="#77dd77">\-</font><font color="#77dd77">\.</font><font color="#77dd77">\+</font>]+)@((<font color="#77dd77">\[</font>[0-9]{1,3}<font color="#77dd77">\.</font>[0-9]{1,3}<font color="#77dd77">\.</font>[0-9]{1,3}<font color="#77dd77">\.</font>)|(([a-zA-Z0-9<font color="#77dd77">\-</font>]+<font color="#77dd77">\.</font>)+))([a-zA-Z]{2,4}|[0-9]{1,3})(<font color="#77dd77">\]</font>?))&quot;</font><font color="#008000">&quot;&quot;</font>, <font color="#2040a0">author</font><font color="4444FF">)</font>
            <strong>if</strong> <strong>not</strong> <font color="#2040a0">emailmatch</font><font color="4444FF">:</font> <strong>return</strong>
            <font color="#2040a0">email</font> <font color="4444FF">=</font> <font color="#2040a0">emailmatch</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#FF0000">0</font><font color="4444FF">)</font>
            <font color="#444444"># probably a better way to do the following, but it passes all the tests</font>
            <font color="#2040a0">author</font> <font color="4444FF">=</font> <font color="#2040a0">author</font>.<font color="#2040a0">replace</font><font color="4444FF">(</font><font color="#2040a0">email</font>, <font color="#008000">''</font><font color="4444FF">)</font>
            <font color="#2040a0">author</font> <font color="4444FF">=</font> <font color="#2040a0">author</font>.<font color="#2040a0">replace</font><font color="4444FF">(</font><font color="#008000">'()'</font>, <font color="#008000">''</font><font color="4444FF">)</font>
            <font color="#2040a0">author</font> <font color="4444FF">=</font> <font color="#2040a0">author</font>.<font color="#2040a0">strip</font><font color="4444FF">(</font><font color="4444FF">)</font>
            <strong>if</strong> <font color="#2040a0">author</font> <strong>and</strong> <font color="4444FF">(</font><font color="#2040a0">author</font><font color="4444FF">[</font><font color="#FF0000">0</font><font color="4444FF">]</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">'('</font><font color="4444FF">)</font><font color="4444FF">:</font>
                <font color="#2040a0">author</font> <font color="4444FF">=</font> <font color="#2040a0">author</font><font color="4444FF">[</font><font color="#FF0000">1</font><font color="4444FF">:</font><font color="4444FF">]</font>
            <strong>if</strong> <font color="#2040a0">author</font> <strong>and</strong> <font color="4444FF">(</font><font color="#2040a0">author</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">')'</font><font color="4444FF">)</font><font color="4444FF">:</font>
                <font color="#2040a0">author</font> <font color="4444FF">=</font> <font color="#2040a0">author</font><font color="4444FF">[</font><font color="4444FF">:</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font>
            <font color="#2040a0">author</font> <font color="4444FF">=</font> <font color="#2040a0">author</font>.<font color="#2040a0">strip</font><font color="4444FF">(</font><font color="4444FF">)</font>
            <font color="#2040a0">context</font>.<font color="#2040a0">setdefault</font><font color="4444FF">(</font><font color="#008000">'%s_detail'</font> <font color="4444FF">%</font> <font color="#2040a0">key</font>, <font color="#2040a0">FeedParserDict</font><font color="4444FF">(</font><font color="4444FF">)</font><font color="4444FF">)</font>
            <font color="#2040a0">context</font><font color="4444FF">[</font><font color="#008000">'%s_detail'</font> <font color="4444FF">%</font> <font color="#2040a0">key</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#008000">'name'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">author</font>
            <font color="#2040a0">context</font><font color="4444FF">[</font><font color="#008000">'%s_detail'</font> <font color="4444FF">%</font> <font color="#2040a0">key</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#008000">'email'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">email</font>
            
<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_tagline</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">incontent</font> <font color="4444FF">+</font><font color="4444FF">=</font> <font color="#FF0000">1</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">contentparams</font> <font color="4444FF">=</font> <font color="#2040a0">FeedParserDict</font><font color="4444FF">(</font><font color="4444FF"><strong>{</strong></font><font color="#008000">'mode'</font><font color="4444FF">:</font> <font color="#2040a0">attrsD</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'mode'</font>, <font color="#008000">'escaped'</font><font color="4444FF">)</font>,
                              <font color="#008000">'type'</font><font color="4444FF">:</font> <font color="#2040a0">attrsD</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'type'</font>, <font color="#008000">'text/plain'</font><font color="4444FF">)</font>,
                              <font color="#008000">'language'</font><font color="4444FF">:</font> <font color="#2040a0">self</font>.<font color="#2040a0">lang</font>,
                              <font color="#008000">'base'</font><font color="4444FF">:</font> <font color="#2040a0">self</font>.<font color="#2040a0">baseuri</font><font color="4444FF"><strong>}</strong></font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'tagline'</font>, <font color="#FF0000">1</font><font color="4444FF">)</font>
    <font color="#2040a0">_start_subtitle</font> <font color="4444FF">=</font> <font color="#2040a0">_start_tagline</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _end_tagline</font><font color="2040a0">(self)</font>:
</strong>        <font color="#2040a0">value</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="#008000">'tagline'</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">incontent</font> <font color="4444FF">-</font><font color="4444FF">=</font> <font color="#FF0000">1</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">contentparams</font>.<font color="#2040a0">clear</font><font color="4444FF">(</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">infeed</font><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">feeddata</font><font color="4444FF">[</font><font color="#008000">'description'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">value</font>
    <font color="#2040a0">_end_subtitle</font> <font color="4444FF">=</font> <font color="#2040a0">_end_tagline</font>
            
<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_copyright</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">incontent</font> <font color="4444FF">+</font><font color="4444FF">=</font> <font color="#FF0000">1</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">contentparams</font> <font color="4444FF">=</font> <font color="#2040a0">FeedParserDict</font><font color="4444FF">(</font><font color="4444FF"><strong>{</strong></font><font color="#008000">'mode'</font><font color="4444FF">:</font> <font color="#2040a0">attrsD</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'mode'</font>, <font color="#008000">'escaped'</font><font color="4444FF">)</font>,
                              <font color="#008000">'type'</font><font color="4444FF">:</font> <font color="#2040a0">attrsD</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'type'</font>, <font color="#008000">'text/plain'</font><font color="4444FF">)</font>,
                              <font color="#008000">'language'</font><font color="4444FF">:</font> <font color="#2040a0">self</font>.<font color="#2040a0">lang</font>,
                              <font color="#008000">'base'</font><font color="4444FF">:</font> <font color="#2040a0">self</font>.<font color="#2040a0">baseuri</font><font color="4444FF"><strong>}</strong></font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'copyright'</font>, <font color="#FF0000">1</font><font color="4444FF">)</font>
    <font color="#2040a0">_start_dc_rights</font> <font color="4444FF">=</font> <font color="#2040a0">_start_copyright</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _end_copyright</font><font color="2040a0">(self)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="#008000">'copyright'</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">incontent</font> <font color="4444FF">-</font><font color="4444FF">=</font> <font color="#FF0000">1</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">contentparams</font>.<font color="#2040a0">clear</font><font color="4444FF">(</font><font color="4444FF">)</font>
    <font color="#2040a0">_end_dc_rights</font> <font color="4444FF">=</font> <font color="#2040a0">_end_copyright</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_item</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">entries</font>.<font color="#2040a0">append</font><font color="4444FF">(</font><font color="#2040a0">FeedParserDict</font><font color="4444FF">(</font><font color="4444FF">)</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'item'</font>, <font color="#FF0000">0</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">inentry</font> <font color="4444FF">=</font> <font color="#FF0000">1</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">guidislink</font> <font color="4444FF">=</font> <font color="#FF0000">0</font>
        <font color="#2040a0">id</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">_getAttribute</font><font color="4444FF">(</font><font color="#2040a0">attrsD</font>, <font color="#008000">'rdf:about'</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">id</font><font color="4444FF">:</font>
            <font color="#2040a0">context</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">_getContext</font><font color="4444FF">(</font><font color="4444FF">)</font>
            <font color="#2040a0">context</font><font color="4444FF">[</font><font color="#008000">'id'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">id</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">_cdf_common</font><font color="4444FF">(</font><font color="#2040a0">attrsD</font><font color="4444FF">)</font>
    <font color="#2040a0">_start_entry</font> <font color="4444FF">=</font> <font color="#2040a0">_start_item</font>
    <font color="#2040a0">_start_product</font> <font color="4444FF">=</font> <font color="#2040a0">_start_item</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _end_item</font><font color="2040a0">(self)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="#008000">'item'</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">inentry</font> <font color="4444FF">=</font> <font color="#FF0000">0</font>
    <font color="#2040a0">_end_entry</font> <font color="4444FF">=</font> <font color="#2040a0">_end_item</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_dc_language</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'language'</font>, <font color="#FF0000">1</font><font color="4444FF">)</font>
    <font color="#2040a0">_start_language</font> <font color="4444FF">=</font> <font color="#2040a0">_start_dc_language</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _end_dc_language</font><font color="2040a0">(self)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">lang</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="#008000">'language'</font><font color="4444FF">)</font>
    <font color="#2040a0">_end_language</font> <font color="4444FF">=</font> <font color="#2040a0">_end_dc_language</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_dc_publisher</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'publisher'</font>, <font color="#FF0000">1</font><font color="4444FF">)</font>
    <font color="#2040a0">_start_webmaster</font> <font color="4444FF">=</font> <font color="#2040a0">_start_dc_publisher</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _end_dc_publisher</font><font color="2040a0">(self)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="#008000">'publisher'</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">_sync_author_detail</font><font color="4444FF">(</font><font color="#008000">'publisher'</font><font color="4444FF">)</font>
    <font color="#2040a0">_end_webmaster</font> <font color="4444FF">=</font> <font color="#2040a0">_end_dc_publisher</font>
        
<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_dcterms_issued</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'issued'</font>, <font color="#FF0000">1</font><font color="4444FF">)</font>
    <font color="#2040a0">_start_issued</font> <font color="4444FF">=</font> <font color="#2040a0">_start_dcterms_issued</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _end_dcterms_issued</font><font color="2040a0">(self)</font>:
</strong>        <font color="#2040a0">value</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="#008000">'issued'</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">_save</font><font color="4444FF">(</font><font color="#008000">'issued_parsed'</font>, <font color="#2040a0">_parse_date</font><font color="4444FF">(</font><font color="#2040a0">value</font><font color="4444FF">)</font><font color="4444FF">)</font>
    <font color="#2040a0">_end_issued</font> <font color="4444FF">=</font> <font color="#2040a0">_end_dcterms_issued</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_dcterms_created</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'created'</font>, <font color="#FF0000">1</font><font color="4444FF">)</font>
    <font color="#2040a0">_start_created</font> <font color="4444FF">=</font> <font color="#2040a0">_start_dcterms_created</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _end_dcterms_created</font><font color="2040a0">(self)</font>:
</strong>        <font color="#2040a0">value</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="#008000">'created'</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">_save</font><font color="4444FF">(</font><font color="#008000">'created_parsed'</font>, <font color="#2040a0">_parse_date</font><font color="4444FF">(</font><font color="#2040a0">value</font><font color="4444FF">)</font><font color="4444FF">)</font>
    <font color="#2040a0">_end_created</font> <font color="4444FF">=</font> <font color="#2040a0">_end_dcterms_created</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_dcterms_modified</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'modified'</font>, <font color="#FF0000">1</font><font color="4444FF">)</font>
    <font color="#2040a0">_start_modified</font> <font color="4444FF">=</font> <font color="#2040a0">_start_dcterms_modified</font>
    <font color="#2040a0">_start_dc_date</font> <font color="4444FF">=</font> <font color="#2040a0">_start_dcterms_modified</font>
    <font color="#2040a0">_start_pubdate</font> <font color="4444FF">=</font> <font color="#2040a0">_start_dcterms_modified</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _end_dcterms_modified</font><font color="2040a0">(self)</font>:
</strong>        <font color="#2040a0">value</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="#008000">'modified'</font><font color="4444FF">)</font>
        <font color="#2040a0">parsed_value</font> <font color="4444FF">=</font> <font color="#2040a0">_parse_date</font><font color="4444FF">(</font><font color="#2040a0">value</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">_save</font><font color="4444FF">(</font><font color="#008000">'modified_parsed'</font>, <font color="#2040a0">parsed_value</font><font color="4444FF">)</font>
    <font color="#2040a0">_end_modified</font> <font color="4444FF">=</font> <font color="#2040a0">_end_dcterms_modified</font>
    <font color="#2040a0">_end_dc_date</font> <font color="4444FF">=</font> <font color="#2040a0">_end_dcterms_modified</font>
    <font color="#2040a0">_end_pubdate</font> <font color="4444FF">=</font> <font color="#2040a0">_end_dcterms_modified</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_expirationdate</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'expired'</font>, <font color="#FF0000">1</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _end_expirationdate</font><font color="2040a0">(self)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">_save</font><font color="4444FF">(</font><font color="#008000">'expired_parsed'</font>, <font color="#2040a0">_parse_date</font><font color="4444FF">(</font><font color="#2040a0">self</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="#008000">'expired'</font><font color="4444FF">)</font><font color="4444FF">)</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_cc_license</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'license'</font>, <font color="#FF0000">1</font><font color="4444FF">)</font>
        <font color="#2040a0">value</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">_getAttribute</font><font color="4444FF">(</font><font color="#2040a0">attrsD</font>, <font color="#008000">'rdf:resource'</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">value</font><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">elementstack</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#FF0000">2</font><font color="4444FF">]</font>.<font color="#2040a0">append</font><font color="4444FF">(</font><font color="#2040a0">value</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="#008000">'license'</font><font color="4444FF">)</font>
        
<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_creativecommons_license</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'license'</font>, <font color="#FF0000">1</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _end_creativecommons_license</font><font color="2040a0">(self)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="#008000">'license'</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_category</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'category'</font>, <font color="#FF0000">1</font><font color="4444FF">)</font>
        <font color="#2040a0">domain</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">_getAttribute</font><font color="4444FF">(</font><font color="#2040a0">attrsD</font>, <font color="#008000">'domain'</font><font color="4444FF">)</font>
        <font color="#2040a0">cats</font> <font color="4444FF">=</font> <font color="4444FF">[</font><font color="4444FF">]</font>
        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">inentry</font><font color="4444FF">:</font>
            <font color="#2040a0">cats</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">entries</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font>.<font color="#2040a0">setdefault</font><font color="4444FF">(</font><font color="#008000">'categories'</font>, <font color="4444FF">[</font><font color="4444FF">]</font><font color="4444FF">)</font>
        <strong>elif</strong> <font color="#2040a0">self</font>.<font color="#2040a0">infeed</font><font color="4444FF">:</font>
            <font color="#2040a0">cats</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">feeddata</font>.<font color="#2040a0">setdefault</font><font color="4444FF">(</font><font color="#008000">'categories'</font>, <font color="4444FF">[</font><font color="4444FF">]</font><font color="4444FF">)</font>
        <font color="#2040a0">cats</font>.<font color="#2040a0">append</font><font color="4444FF">(</font><font color="4444FF">(</font><font color="#2040a0">domain</font>, <font color="#2040a0">None</font><font color="4444FF">)</font><font color="4444FF">)</font>
    <font color="#2040a0">_start_dc_subject</font> <font color="4444FF">=</font> <font color="#2040a0">_start_category</font>
    <font color="#2040a0">_start_keywords</font> <font color="4444FF">=</font> <font color="#2040a0">_start_category</font>
        
<strong>   <font color="ff0000"> def</font><font color="ff0000"> _end_category</font><font color="2040a0">(self)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="#008000">'category'</font><font color="4444FF">)</font>
    <font color="#2040a0">_end_dc_subject</font> <font color="4444FF">=</font> <font color="#2040a0">_end_category</font>
    <font color="#2040a0">_end_keywords</font> <font color="4444FF">=</font> <font color="#2040a0">_end_category</font>
        
<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_cloud</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">feeddata</font><font color="4444FF">[</font><font color="#008000">'cloud'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">FeedParserDict</font><font color="4444FF">(</font><font color="#2040a0">attrsD</font><font color="4444FF">)</font>
        
<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_link</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">attrsD</font>.<font color="#2040a0">setdefault</font><font color="4444FF">(</font><font color="#008000">'rel'</font>, <font color="#008000">'alternate'</font><font color="4444FF">)</font>
        <font color="#2040a0">attrsD</font>.<font color="#2040a0">setdefault</font><font color="4444FF">(</font><font color="#008000">'type'</font>, <font color="#008000">'text/html'</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">attrsD</font>.<font color="#2040a0">has_key</font><font color="4444FF">(</font><font color="#008000">'href'</font><font color="4444FF">)</font><font color="4444FF">:</font>
            <font color="#2040a0">attrsD</font><font color="4444FF">[</font><font color="#008000">'href'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">resolveURI</font><font color="4444FF">(</font><font color="#2040a0">attrsD</font><font color="4444FF">[</font><font color="#008000">'href'</font><font color="4444FF">]</font><font color="4444FF">)</font>
        <font color="#2040a0">expectingText</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">infeed</font> <strong>or</strong> <font color="#2040a0">self</font>.<font color="#2040a0">inentry</font>
        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">inentry</font><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">entries</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font>.<font color="#2040a0">setdefault</font><font color="4444FF">(</font><font color="#008000">'links'</font>, <font color="4444FF">[</font><font color="4444FF">]</font><font color="4444FF">)</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">entries</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#008000">'links'</font><font color="4444FF">]</font>.<font color="#2040a0">append</font><font color="4444FF">(</font><font color="#2040a0">FeedParserDict</font><font color="4444FF">(</font><font color="#2040a0">attrsD</font><font color="4444FF">)</font><font color="4444FF">)</font>
        <strong>elif</strong> <font color="#2040a0">self</font>.<font color="#2040a0">infeed</font><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">feeddata</font>.<font color="#2040a0">setdefault</font><font color="4444FF">(</font><font color="#008000">'links'</font>, <font color="4444FF">[</font><font color="4444FF">]</font><font color="4444FF">)</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">feeddata</font><font color="4444FF">[</font><font color="#008000">'links'</font><font color="4444FF">]</font>.<font color="#2040a0">append</font><font color="4444FF">(</font><font color="#2040a0">FeedParserDict</font><font color="4444FF">(</font><font color="#2040a0">attrsD</font><font color="4444FF">)</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">attrsD</font>.<font color="#2040a0">has_key</font><font color="4444FF">(</font><font color="#008000">'href'</font><font color="4444FF">)</font><font color="4444FF">:</font>
            <font color="#2040a0">expectingText</font> <font color="4444FF">=</font> <font color="#FF0000">0</font>
            <strong>if</strong> <font color="#2040a0">attrsD</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'type'</font>, <font color="#008000">''</font><font color="4444FF">)</font> <strong>in</strong> <font color="#2040a0">self</font>.<font color="#2040a0">html_types</font><font color="4444FF">:</font>
                <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">inentry</font><font color="4444FF">:</font>
                    <font color="#2040a0">self</font>.<font color="#2040a0">entries</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#008000">'link'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">attrsD</font><font color="4444FF">[</font><font color="#008000">'href'</font><font color="4444FF">]</font>
                <strong>elif</strong> <font color="#2040a0">self</font>.<font color="#2040a0">infeed</font><font color="4444FF">:</font>
                    <font color="#2040a0">self</font>.<font color="#2040a0">feeddata</font><font color="4444FF">[</font><font color="#008000">'link'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">attrsD</font><font color="4444FF">[</font><font color="#008000">'href'</font><font color="4444FF">]</font>
        <strong>else</strong><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'link'</font>, <font color="#2040a0">expectingText</font><font color="4444FF">)</font>
    <font color="#2040a0">_start_producturl</font> <font color="4444FF">=</font> <font color="#2040a0">_start_link</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _end_link</font><font color="2040a0">(self)</font>:
</strong>        <font color="#2040a0">value</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="#008000">'link'</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">intextinput</font><font color="4444FF">:</font>
            <font color="#2040a0">context</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">_getContext</font><font color="4444FF">(</font><font color="4444FF">)</font>
            <font color="#2040a0">context</font><font color="4444FF">[</font><font color="#008000">'textinput'</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#008000">'link'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">value</font>
        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">inimage</font><font color="4444FF">:</font>
            <font color="#2040a0">context</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">_getContext</font><font color="4444FF">(</font><font color="4444FF">)</font>
            <font color="#2040a0">context</font><font color="4444FF">[</font><font color="#008000">'image'</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#008000">'link'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">value</font>
    <font color="#2040a0">_end_producturl</font> <font color="4444FF">=</font> <font color="#2040a0">_end_link</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_guid</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">guidislink</font> <font color="4444FF">=</font> <font color="4444FF">(</font><font color="#2040a0">attrsD</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'ispermalink'</font>, <font color="#008000">'true'</font><font color="4444FF">)</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">'true'</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'id'</font>, <font color="#FF0000">1</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _end_guid</font><font color="2040a0">(self)</font>:
</strong>        <font color="#2040a0">value</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="#008000">'id'</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">_save</font><font color="4444FF">(</font><font color="#008000">'guidislink'</font>, <font color="#2040a0">self</font>.<font color="#2040a0">guidislink</font> <strong>and</strong> <strong>not</strong> <font color="#2040a0">self</font>.<font color="#2040a0">_getContext</font><font color="4444FF">(</font><font color="4444FF">)</font>.<font color="#2040a0">has_key</font><font color="4444FF">(</font><font color="#008000">'link'</font><font color="4444FF">)</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">guidislink</font><font color="4444FF">:</font>
            <font color="#444444"># guid acts as link, but only if &quot;ispermalink&quot; is not present or is &quot;true&quot;,</font>
            <font color="#444444"># and only if the item doesn't already have a link element</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">_save</font><font color="4444FF">(</font><font color="#008000">'link'</font>, <font color="#2040a0">value</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_id</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'id'</font>, <font color="#FF0000">1</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _end_id</font><font color="2040a0">(self)</font>:
</strong>        <font color="#2040a0">value</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="#008000">'id'</font><font color="4444FF">)</font>
            
<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_title</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">incontent</font> <font color="4444FF">+</font><font color="4444FF">=</font> <font color="#FF0000">1</font>
        <strong>if</strong> <font color="#2040a0">_debug</font><font color="4444FF">:</font> <font color="#2040a0">sys</font>.<font color="#2040a0">stderr</font>.<font color="#2040a0">write</font><font color="4444FF">(</font><font color="#008000">'attrsD.xml:lang = %s\n'</font> <font color="4444FF">%</font> <font color="#2040a0">attrsD</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'xml:lang'</font><font color="4444FF">)</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">_debug</font><font color="4444FF">:</font> <font color="#2040a0">sys</font>.<font color="#2040a0">stderr</font>.<font color="#2040a0">write</font><font color="4444FF">(</font><font color="#008000">'self.lang = %s\n'</font> <font color="4444FF">%</font> <font color="#2040a0">self</font>.<font color="#2040a0">lang</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">contentparams</font> <font color="4444FF">=</font> <font color="#2040a0">FeedParserDict</font><font color="4444FF">(</font><font color="4444FF"><strong>{</strong></font><font color="#008000">'mode'</font><font color="4444FF">:</font> <font color="#2040a0">attrsD</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'mode'</font>, <font color="#008000">'escaped'</font><font color="4444FF">)</font>,
                              <font color="#008000">'type'</font><font color="4444FF">:</font> <font color="#2040a0">attrsD</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'type'</font>, <font color="#008000">'text/plain'</font><font color="4444FF">)</font>,
                              <font color="#008000">'language'</font><font color="4444FF">:</font> <font color="#2040a0">self</font>.<font color="#2040a0">lang</font>,
                              <font color="#008000">'base'</font><font color="4444FF">:</font> <font color="#2040a0">self</font>.<font color="#2040a0">baseuri</font><font color="4444FF"><strong>}</strong></font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'title'</font>, <font color="#2040a0">self</font>.<font color="#2040a0">infeed</font> <strong>or</strong> <font color="#2040a0">self</font>.<font color="#2040a0">inentry</font><font color="4444FF">)</font>
    <font color="#2040a0">_start_dc_title</font> <font color="4444FF">=</font> <font color="#2040a0">_start_title</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _end_title</font><font color="2040a0">(self)</font>:
</strong>        <font color="#2040a0">value</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="#008000">'title'</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">incontent</font> <font color="4444FF">-</font><font color="4444FF">=</font> <font color="#FF0000">1</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">contentparams</font>.<font color="#2040a0">clear</font><font color="4444FF">(</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">intextinput</font><font color="4444FF">:</font>
            <font color="#2040a0">context</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">_getContext</font><font color="4444FF">(</font><font color="4444FF">)</font>
            <font color="#2040a0">context</font><font color="4444FF">[</font><font color="#008000">'textinput'</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#008000">'title'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">value</font>
        <strong>elif</strong> <font color="#2040a0">self</font>.<font color="#2040a0">inimage</font><font color="4444FF">:</font>
            <font color="#2040a0">context</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">_getContext</font><font color="4444FF">(</font><font color="4444FF">)</font>
            <font color="#2040a0">context</font><font color="4444FF">[</font><font color="#008000">'image'</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#008000">'title'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">value</font>
    <font color="#2040a0">_end_dc_title</font> <font color="4444FF">=</font> <font color="#2040a0">_end_title</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_description</font><font color="2040a0">(self, attrsD, default_content_type='text/html')</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">incontent</font> <font color="4444FF">+</font><font color="4444FF">=</font> <font color="#FF0000">1</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">contentparams</font> <font color="4444FF">=</font> <font color="#2040a0">FeedParserDict</font><font color="4444FF">(</font><font color="4444FF"><strong>{</strong></font><font color="#008000">'mode'</font><font color="4444FF">:</font> <font color="#2040a0">attrsD</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'mode'</font>, <font color="#008000">'escaped'</font><font color="4444FF">)</font>,
                              <font color="#008000">'type'</font><font color="4444FF">:</font> <font color="#2040a0">attrsD</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'type'</font>, <font color="#2040a0">default_content_type</font><font color="4444FF">)</font>,
                              <font color="#008000">'language'</font><font color="4444FF">:</font> <font color="#2040a0">self</font>.<font color="#2040a0">lang</font>,
                              <font color="#008000">'base'</font><font color="4444FF">:</font> <font color="#2040a0">self</font>.<font color="#2040a0">baseuri</font><font color="4444FF"><strong>}</strong></font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'description'</font>, <font color="#2040a0">self</font>.<font color="#2040a0">infeed</font> <strong>or</strong> <font color="#2040a0">self</font>.<font color="#2040a0">inentry</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_abstract</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <strong>return</strong> <font color="#2040a0">self</font>.<font color="#2040a0">_start_description</font><font color="4444FF">(</font><font color="#2040a0">attrsD</font>, <font color="#008000">'text/plain'</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _end_description</font><font color="2040a0">(self)</font>:
</strong>        <font color="#2040a0">value</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="#008000">'description'</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">incontent</font> <font color="4444FF">-</font><font color="4444FF">=</font> <font color="#FF0000">1</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">contentparams</font>.<font color="#2040a0">clear</font><font color="4444FF">(</font><font color="4444FF">)</font>
        <font color="#2040a0">context</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">_getContext</font><font color="4444FF">(</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">intextinput</font><font color="4444FF">:</font>
            <font color="#2040a0">context</font><font color="4444FF">[</font><font color="#008000">'textinput'</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#008000">'description'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">value</font>
        <strong>elif</strong> <font color="#2040a0">self</font>.<font color="#2040a0">inimage</font><font color="4444FF">:</font>
            <font color="#2040a0">context</font><font color="4444FF">[</font><font color="#008000">'image'</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#008000">'description'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">value</font>
<font color="#444444">#        elif self.inentry:</font>
<font color="#444444">#            context['summary'] = value</font>
<font color="#444444">#        elif self.infeed:</font>
<font color="#444444">#            context['tagline'] = value</font>
    <font color="#2040a0">_end_abstract</font> <font color="4444FF">=</font> <font color="#2040a0">_end_description</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_info</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">incontent</font> <font color="4444FF">+</font><font color="4444FF">=</font> <font color="#FF0000">1</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">contentparams</font> <font color="4444FF">=</font> <font color="#2040a0">FeedParserDict</font><font color="4444FF">(</font><font color="4444FF"><strong>{</strong></font><font color="#008000">'mode'</font><font color="4444FF">:</font> <font color="#2040a0">attrsD</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'mode'</font>, <font color="#008000">'escaped'</font><font color="4444FF">)</font>,
                              <font color="#008000">'type'</font><font color="4444FF">:</font> <font color="#2040a0">attrsD</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'type'</font>, <font color="#008000">'text/plain'</font><font color="4444FF">)</font>,
                              <font color="#008000">'language'</font><font color="4444FF">:</font> <font color="#2040a0">self</font>.<font color="#2040a0">lang</font>,
                              <font color="#008000">'base'</font><font color="4444FF">:</font> <font color="#2040a0">self</font>.<font color="#2040a0">baseuri</font><font color="4444FF"><strong>}</strong></font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'info'</font>, <font color="#FF0000">1</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _end_info</font><font color="2040a0">(self)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="#008000">'info'</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">incontent</font> <font color="4444FF">-</font><font color="4444FF">=</font> <font color="#FF0000">1</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">contentparams</font>.<font color="#2040a0">clear</font><font color="4444FF">(</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_generator</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <strong>if</strong> <font color="#2040a0">attrsD</font><font color="4444FF">:</font>
            <strong>if</strong> <font color="#2040a0">attrsD</font>.<font color="#2040a0">has_key</font><font color="4444FF">(</font><font color="#008000">'url'</font><font color="4444FF">)</font><font color="4444FF">:</font>
                <font color="#2040a0">attrsD</font><font color="4444FF">[</font><font color="#008000">'url'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">resolveURI</font><font color="4444FF">(</font><font color="#2040a0">attrsD</font><font color="4444FF">[</font><font color="#008000">'url'</font><font color="4444FF">]</font><font color="4444FF">)</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">feeddata</font><font color="4444FF">[</font><font color="#008000">'generator_detail'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">FeedParserDict</font><font color="4444FF">(</font><font color="#2040a0">attrsD</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'generator'</font>, <font color="#FF0000">1</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _end_generator</font><font color="2040a0">(self)</font>:
</strong>        <font color="#2040a0">value</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="#008000">'generator'</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">feeddata</font>.<font color="#2040a0">has_key</font><font color="4444FF">(</font><font color="#008000">'generator_detail'</font><font color="4444FF">)</font><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">feeddata</font><font color="4444FF">[</font><font color="#008000">'generator_detail'</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#008000">'name'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">value</font>
            
<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_admin_generatoragent</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'generator'</font>, <font color="#FF0000">1</font><font color="4444FF">)</font>
        <font color="#2040a0">value</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">_getAttribute</font><font color="4444FF">(</font><font color="#2040a0">attrsD</font>, <font color="#008000">'rdf:resource'</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">value</font><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">elementstack</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#FF0000">2</font><font color="4444FF">]</font>.<font color="#2040a0">append</font><font color="4444FF">(</font><font color="#2040a0">value</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="#008000">'generator'</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">feeddata</font><font color="4444FF">[</font><font color="#008000">'generator_detail'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">FeedParserDict</font><font color="4444FF">(</font><font color="4444FF"><strong>{</strong></font><font color="#008000">&quot;url&quot;</font><font color="4444FF">:</font> <font color="#2040a0">value</font><font color="4444FF"><strong>}</strong></font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_admin_errorreportsto</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'errorreportsto'</font>, <font color="#FF0000">1</font><font color="4444FF">)</font>
        <font color="#2040a0">value</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">_getAttribute</font><font color="4444FF">(</font><font color="#2040a0">attrsD</font>, <font color="#008000">'rdf:resource'</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">value</font><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">elementstack</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#FF0000">2</font><font color="4444FF">]</font>.<font color="#2040a0">append</font><font color="4444FF">(</font><font color="#2040a0">value</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="#008000">'errorreportsto'</font><font color="4444FF">)</font>
        
<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_summary</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">incontent</font> <font color="4444FF">+</font><font color="4444FF">=</font> <font color="#FF0000">1</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">contentparams</font> <font color="4444FF">=</font> <font color="#2040a0">FeedParserDict</font><font color="4444FF">(</font><font color="4444FF"><strong>{</strong></font><font color="#008000">'mode'</font><font color="4444FF">:</font> <font color="#2040a0">attrsD</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'mode'</font>, <font color="#008000">'escaped'</font><font color="4444FF">)</font>,
                              <font color="#008000">'type'</font><font color="4444FF">:</font> <font color="#2040a0">attrsD</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'type'</font>, <font color="#008000">'text/plain'</font><font color="4444FF">)</font>,
                              <font color="#008000">'language'</font><font color="4444FF">:</font> <font color="#2040a0">self</font>.<font color="#2040a0">lang</font>,
                              <font color="#008000">'base'</font><font color="4444FF">:</font> <font color="#2040a0">self</font>.<font color="#2040a0">baseuri</font><font color="4444FF"><strong>}</strong></font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'summary'</font>, <font color="#FF0000">1</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _end_summary</font><font color="2040a0">(self)</font>:
</strong>        <font color="#2040a0">value</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="#008000">'summary'</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">entries</font><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">entries</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#008000">'description'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">value</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">incontent</font> <font color="4444FF">-</font><font color="4444FF">=</font> <font color="#FF0000">1</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">contentparams</font>.<font color="#2040a0">clear</font><font color="4444FF">(</font><font color="4444FF">)</font>
        
<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_enclosure</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">inentry</font><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">entries</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font>.<font color="#2040a0">setdefault</font><font color="4444FF">(</font><font color="#008000">'enclosures'</font>, <font color="4444FF">[</font><font color="4444FF">]</font><font color="4444FF">)</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">entries</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#008000">'enclosures'</font><font color="4444FF">]</font>.<font color="#2040a0">append</font><font color="4444FF">(</font><font color="#2040a0">FeedParserDict</font><font color="4444FF">(</font><font color="#2040a0">attrsD</font><font color="4444FF">)</font><font color="4444FF">)</font>
            
<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_source</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">inentry</font><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">entries</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font><font color="4444FF">[</font><font color="#008000">'source'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">FeedParserDict</font><font color="4444FF">(</font><font color="#2040a0">attrsD</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'source'</font>, <font color="#FF0000">1</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _end_source</font><font color="2040a0">(self)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="#008000">'source'</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_content</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">incontent</font> <font color="4444FF">+</font><font color="4444FF">=</font> <font color="#FF0000">1</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">contentparams</font> <font color="4444FF">=</font> <font color="#2040a0">FeedParserDict</font><font color="4444FF">(</font><font color="4444FF"><strong>{</strong></font><font color="#008000">'mode'</font><font color="4444FF">:</font> <font color="#2040a0">attrsD</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'mode'</font>, <font color="#008000">'xml'</font><font color="4444FF">)</font>,
                              <font color="#008000">'type'</font><font color="4444FF">:</font> <font color="#2040a0">attrsD</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'type'</font>, <font color="#008000">'text/plain'</font><font color="4444FF">)</font>,
                              <font color="#008000">'language'</font><font color="4444FF">:</font> <font color="#2040a0">self</font>.<font color="#2040a0">lang</font>,
                              <font color="#008000">'base'</font><font color="4444FF">:</font> <font color="#2040a0">self</font>.<font color="#2040a0">baseuri</font><font color="4444FF"><strong>}</strong></font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'content'</font>, <font color="#FF0000">1</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_prodlink</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">incontent</font> <font color="4444FF">+</font><font color="4444FF">=</font> <font color="#FF0000">1</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">contentparams</font> <font color="4444FF">=</font> <font color="#2040a0">FeedParserDict</font><font color="4444FF">(</font><font color="4444FF"><strong>{</strong></font><font color="#008000">'mode'</font><font color="4444FF">:</font> <font color="#2040a0">attrsD</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'mode'</font>, <font color="#008000">'xml'</font><font color="4444FF">)</font>,
                              <font color="#008000">'type'</font><font color="4444FF">:</font> <font color="#2040a0">attrsD</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'type'</font>, <font color="#008000">'text/html'</font><font color="4444FF">)</font>,
                              <font color="#008000">'language'</font><font color="4444FF">:</font> <font color="#2040a0">self</font>.<font color="#2040a0">lang</font>,
                              <font color="#008000">'base'</font><font color="4444FF">:</font> <font color="#2040a0">self</font>.<font color="#2040a0">baseuri</font><font color="4444FF"><strong>}</strong></font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'content'</font>, <font color="#FF0000">1</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_body</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">incontent</font> <font color="4444FF">+</font><font color="4444FF">=</font> <font color="#FF0000">1</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">contentparams</font> <font color="4444FF">=</font> <font color="#2040a0">FeedParserDict</font><font color="4444FF">(</font><font color="4444FF"><strong>{</strong></font><font color="#008000">'mode'</font><font color="4444FF">:</font> <font color="#008000">'xml'</font>,
                              <font color="#008000">'type'</font><font color="4444FF">:</font> <font color="#008000">'application/xhtml+xml'</font>,
                              <font color="#008000">'language'</font><font color="4444FF">:</font> <font color="#2040a0">self</font>.<font color="#2040a0">lang</font>,
                              <font color="#008000">'base'</font><font color="4444FF">:</font> <font color="#2040a0">self</font>.<font color="#2040a0">baseuri</font><font color="4444FF"><strong>}</strong></font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'content'</font>, <font color="#FF0000">1</font><font color="4444FF">)</font>
    <font color="#2040a0">_start_xhtml_body</font> <font color="4444FF">=</font> <font color="#2040a0">_start_body</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _start_content_encoded</font><font color="2040a0">(self, attrsD)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">incontent</font> <font color="4444FF">+</font><font color="4444FF">=</font> <font color="#FF0000">1</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">contentparams</font> <font color="4444FF">=</font> <font color="#2040a0">FeedParserDict</font><font color="4444FF">(</font><font color="4444FF"><strong>{</strong></font><font color="#008000">'mode'</font><font color="4444FF">:</font> <font color="#008000">'escaped'</font>,
                              <font color="#008000">'type'</font><font color="4444FF">:</font> <font color="#008000">'text/html'</font>,
                              <font color="#008000">'language'</font><font color="4444FF">:</font> <font color="#2040a0">self</font>.<font color="#2040a0">lang</font>,
                              <font color="#008000">'base'</font><font color="4444FF">:</font> <font color="#2040a0">self</font>.<font color="#2040a0">baseuri</font><font color="4444FF"><strong>}</strong></font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">push</font><font color="4444FF">(</font><font color="#008000">'content'</font>, <font color="#FF0000">1</font><font color="4444FF">)</font>
    <font color="#2040a0">_start_fullitem</font> <font color="4444FF">=</font> <font color="#2040a0">_start_content_encoded</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _end_content</font><font color="2040a0">(self)</font>:
</strong>        <font color="#2040a0">value</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">pop</font><font color="4444FF">(</font><font color="#008000">'content'</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">contentparams</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'type'</font><font color="4444FF">)</font> <strong>in</strong> <font color="4444FF">(</font><font color="4444FF">[</font><font color="#008000">'text/plain'</font><font color="4444FF">]</font> <font color="4444FF">+</font> <font color="#2040a0">self</font>.<font color="#2040a0">html_types</font><font color="4444FF">)</font><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">_save</font><font color="4444FF">(</font><font color="#008000">'description'</font>, <font color="#2040a0">value</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">incontent</font> <font color="4444FF">-</font><font color="4444FF">=</font> <font color="#FF0000">1</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">contentparams</font>.<font color="#2040a0">clear</font><font color="4444FF">(</font><font color="4444FF">)</font>
    <font color="#2040a0">_end_body</font> <font color="4444FF">=</font> <font color="#2040a0">_end_content</font>
    <font color="#2040a0">_end_xhtml_body</font> <font color="4444FF">=</font> <font color="#2040a0">_end_content</font>
    <font color="#2040a0">_end_content_encoded</font> <font color="4444FF">=</font> <font color="#2040a0">_end_content</font>
    <font color="#2040a0">_end_fullitem</font> <font color="4444FF">=</font> <font color="#2040a0">_end_content</font>
    <font color="#2040a0">_end_prodlink</font> <font color="4444FF">=</font> <font color="#2040a0">_end_content</font>

<strong>if</strong> <font color="#2040a0">_XML_AVAILABLE</font><font color="4444FF">:</font>
    <strong>class</strong> <font color="#2040a0">_StrictFeedParser</font><font color="4444FF">(</font><font color="#2040a0">_FeedParserMixin</font>, <font color="#2040a0">xml</font>.<font color="#2040a0">sax</font>.<font color="#2040a0">handler</font>.<font color="#2040a0">ContentHandler</font><font color="4444FF">)</font><font color="4444FF">:</font>
<strong>       <font color="ff0000"> def</font><font color="ff0000"> __init__</font><font color="2040a0">(self, baseuri, baselang, encoding)</font>:
</strong>            <strong>if</strong> <font color="#2040a0">_debug</font><font color="4444FF">:</font> <font color="#2040a0">sys</font>.<font color="#2040a0">stderr</font>.<font color="#2040a0">write</font><font color="4444FF">(</font><font color="#008000">'trying StrictFeedParser\n'</font><font color="4444FF">)</font>
            <font color="#2040a0">xml</font>.<font color="#2040a0">sax</font>.<font color="#2040a0">handler</font>.<font color="#2040a0">ContentHandler</font>.<font color="#2040a0">__init__</font><font color="4444FF">(</font><font color="#2040a0">self</font><font color="4444FF">)</font>
            <font color="#2040a0">_FeedParserMixin</font>.<font color="#2040a0">__init__</font><font color="4444FF">(</font><font color="#2040a0">self</font>, <font color="#2040a0">baseuri</font>, <font color="#2040a0">baselang</font>, <font color="#2040a0">encoding</font><font color="4444FF">)</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">bozo</font> <font color="4444FF">=</font> <font color="#FF0000">0</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">exc</font> <font color="4444FF">=</font> <font color="#2040a0">None</font>
        
<strong>       <font color="ff0000"> def</font><font color="ff0000"> startPrefixMapping</font><font color="2040a0">(self, prefix, uri)</font>:
</strong>            <font color="#2040a0">self</font>.<font color="#2040a0">trackNamespace</font><font color="4444FF">(</font><font color="#2040a0">prefix</font>, <font color="#2040a0">uri</font><font color="4444FF">)</font>
        
<strong>       <font color="ff0000"> def</font><font color="ff0000"> startElementNS</font><font color="2040a0">(self, name, qname, attrs)</font>:
</strong>            <font color="#2040a0">namespace</font>, <font color="#2040a0">localname</font> <font color="4444FF">=</font> <font color="#2040a0">name</font>
            <font color="#2040a0">namespace</font> <font color="4444FF">=</font> <font color="#2040a0">str</font><font color="4444FF">(</font><font color="#2040a0">namespace</font> <strong>or</strong> <font color="#008000">''</font><font color="4444FF">)</font>
            <strong>if</strong> <font color="#2040a0">namespace</font>.<font color="#2040a0">find</font><font color="4444FF">(</font><font color="#008000">'backend.userland.com/rss'</font><font color="4444FF">)</font> <font color="4444FF">&lt;</font><font color="4444FF">&gt;</font> <font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">:</font>
                <font color="#444444"># match any backend.userland.com namespace</font>
                <font color="#2040a0">namespace</font> <font color="4444FF">=</font> <font color="#008000">'http://backend.userland.com/rss'</font>
            <font color="#2040a0">prefix</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">namespaces</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#2040a0">namespace</font>, <font color="#008000">'unknown'</font><font color="4444FF">)</font>
            <strong>if</strong> <font color="#2040a0">prefix</font><font color="4444FF">:</font>
                <font color="#2040a0">localname</font> <font color="4444FF">=</font> <font color="#2040a0">prefix</font> <font color="4444FF">+</font> <font color="#008000">':'</font> <font color="4444FF">+</font> <font color="#2040a0">localname</font>
            <font color="#2040a0">localname</font> <font color="4444FF">=</font> <font color="#2040a0">str</font><font color="4444FF">(</font><font color="#2040a0">localname</font><font color="4444FF">)</font>.<font color="#2040a0">lower</font><font color="4444FF">(</font><font color="4444FF">)</font>

            <font color="#444444"># qname implementation is horribly broken in Python 2.1 (it</font>
            <font color="#444444"># doesn't report any), and slightly broken in Python 2.2 (it</font>
            <font color="#444444"># doesn't report the xml: namespace). So we match up namespaces</font>
            <font color="#444444"># with a known list first, and then possibly override them with</font>
            <font color="#444444"># the qnames the SAX parser gives us (if indeed it gives us any</font>
            <font color="#444444"># at all).  Thanks to MatejC for helping me test this and</font>
            <font color="#444444"># tirelessly telling me that it didn't work yet.</font>
            <font color="#2040a0">attrsD</font> <font color="4444FF">=</font> <font color="4444FF"><strong>{</strong></font><font color="4444FF"><strong>}</strong></font>
            <strong>for</strong> <font color="4444FF">(</font><font color="#2040a0">namespace</font>, <font color="#2040a0">attrlocalname</font><font color="4444FF">)</font>, <font color="#2040a0">attrvalue</font> <strong>in</strong> <font color="#2040a0">attrs</font>.<font color="#2040a0">_attrs</font>.<font color="#2040a0">items</font><font color="4444FF">(</font><font color="4444FF">)</font><font color="4444FF">:</font>
                <font color="#2040a0">prefix</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">namespaces</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#2040a0">namespace</font>, <font color="#008000">''</font><font color="4444FF">)</font>
                <strong>if</strong> <font color="#2040a0">prefix</font><font color="4444FF">:</font>
                    <font color="#2040a0">attrlocalname</font> <font color="4444FF">=</font> <font color="#2040a0">prefix</font> <font color="4444FF">+</font> <font color="#008000">&quot;:&quot;</font> <font color="4444FF">+</font> <font color="#2040a0">attrlocalname</font>
                <font color="#2040a0">attrsD</font><font color="4444FF">[</font><font color="#2040a0">str</font><font color="4444FF">(</font><font color="#2040a0">attrlocalname</font><font color="4444FF">)</font>.<font color="#2040a0">lower</font><font color="4444FF">(</font><font color="4444FF">)</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">attrvalue</font>
            <strong>for</strong> <font color="#2040a0">qname</font> <strong>in</strong> <font color="#2040a0">attrs</font>.<font color="#2040a0">getQNames</font><font color="4444FF">(</font><font color="4444FF">)</font><font color="4444FF">:</font>
                <font color="#2040a0">attrsD</font><font color="4444FF">[</font><font color="#2040a0">str</font><font color="4444FF">(</font><font color="#2040a0">qname</font><font color="4444FF">)</font>.<font color="#2040a0">lower</font><font color="4444FF">(</font><font color="4444FF">)</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">attrs</font>.<font color="#2040a0">getValueByQName</font><font color="4444FF">(</font><font color="#2040a0">qname</font><font color="4444FF">)</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">unknown_starttag</font><font color="4444FF">(</font><font color="#2040a0">localname</font>, <font color="#2040a0">attrsD</font>.<font color="#2040a0">items</font><font color="4444FF">(</font><font color="4444FF">)</font><font color="4444FF">)</font>

<font color="#444444">#        def resolveEntity(self, publicId, systemId):</font>
<font color="#444444">#            return _StringIO()</font>

<strong>       <font color="ff0000"> def</font><font color="ff0000"> characters</font><font color="2040a0">(self, text)</font>:
</strong>            <font color="#2040a0">self</font>.<font color="#2040a0">handle_data</font><font color="4444FF">(</font><font color="#2040a0">text</font><font color="4444FF">)</font>

<strong>       <font color="ff0000"> def</font><font color="ff0000"> endElementNS</font><font color="2040a0">(self, name, qname)</font>:
</strong>            <font color="#2040a0">namespace</font>, <font color="#2040a0">localname</font> <font color="4444FF">=</font> <font color="#2040a0">name</font>
            <font color="#2040a0">namespace</font> <font color="4444FF">=</font> <font color="#2040a0">str</font><font color="4444FF">(</font><font color="#2040a0">namespace</font><font color="4444FF">)</font>
            <font color="#2040a0">prefix</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">namespaces</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#2040a0">namespace</font>, <font color="#008000">''</font><font color="4444FF">)</font>
            <strong>if</strong> <font color="#2040a0">prefix</font><font color="4444FF">:</font>
                <font color="#2040a0">localname</font> <font color="4444FF">=</font> <font color="#2040a0">prefix</font> <font color="4444FF">+</font> <font color="#008000">':'</font> <font color="4444FF">+</font> <font color="#2040a0">localname</font>
            <font color="#2040a0">localname</font> <font color="4444FF">=</font> <font color="#2040a0">str</font><font color="4444FF">(</font><font color="#2040a0">localname</font><font color="4444FF">)</font>.<font color="#2040a0">lower</font><font color="4444FF">(</font><font color="4444FF">)</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">unknown_endtag</font><font color="4444FF">(</font><font color="#2040a0">localname</font><font color="4444FF">)</font>

<strong>       <font color="ff0000"> def</font><font color="ff0000"> error</font><font color="2040a0">(self, exc)</font>:
</strong>            <font color="#2040a0">self</font>.<font color="#2040a0">bozo</font> <font color="4444FF">=</font> <font color="#FF0000">1</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">exc</font> <font color="4444FF">=</font> <font color="#2040a0">exc</font>
            
<strong>       <font color="ff0000"> def</font><font color="ff0000"> fatalError</font><font color="2040a0">(self, exc)</font>:
</strong>            <font color="#2040a0">self</font>.<font color="#2040a0">error</font><font color="4444FF">(</font><font color="#2040a0">exc</font><font color="4444FF">)</font>
            <strong>raise</strong> <font color="#2040a0">exc</font>

<strong>class</strong> <font color="#2040a0">_BaseHTMLProcessor</font><font color="4444FF">(</font><font color="#2040a0">sgmllib</font>.<font color="#2040a0">SGMLParser</font><font color="4444FF">)</font><font color="4444FF">:</font>
    <font color="#2040a0">elements_no_end_tag</font> <font color="4444FF">=</font> <font color="4444FF">[</font><font color="#008000">'area'</font>, <font color="#008000">'base'</font>, <font color="#008000">'basefont'</font>, <font color="#008000">'br'</font>, <font color="#008000">'col'</font>, <font color="#008000">'frame'</font>, <font color="#008000">'hr'</font>,
      <font color="#008000">'img'</font>, <font color="#008000">'input'</font>, <font color="#008000">'isindex'</font>, <font color="#008000">'link'</font>, <font color="#008000">'meta'</font>, <font color="#008000">'param'</font><font color="4444FF">]</font>
    
<strong>   <font color="ff0000"> def</font><font color="ff0000"> __init__</font><font color="2040a0">(self, encoding)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">encoding</font> <font color="4444FF">=</font> <font color="#2040a0">encoding</font>
        <strong>if</strong> <font color="#2040a0">_debug</font><font color="4444FF">:</font> <font color="#2040a0">sys</font>.<font color="#2040a0">stderr</font>.<font color="#2040a0">write</font><font color="4444FF">(</font><font color="#008000">'entering BaseHTMLProcessor, encoding=%s\n'</font> <font color="4444FF">%</font> <font color="#2040a0">self</font>.<font color="#2040a0">encoding</font><font color="4444FF">)</font>
        <font color="#2040a0">sgmllib</font>.<font color="#2040a0">SGMLParser</font>.<font color="#2040a0">__init__</font><font color="4444FF">(</font><font color="#2040a0">self</font><font color="4444FF">)</font>
        
<strong>   <font color="ff0000"> def</font><font color="ff0000"> reset</font><font color="2040a0">(self)</font>:
</strong>        <font color="#2040a0">self</font>.<font color="#2040a0">pieces</font> <font color="4444FF">=</font> <font color="4444FF">[</font><font color="4444FF">]</font>
        <font color="#2040a0">sgmllib</font>.<font color="#2040a0">SGMLParser</font>.<font color="#2040a0">reset</font><font color="4444FF">(</font><font color="#2040a0">self</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> feed</font><font color="2040a0">(self, data)</font>:
</strong>        <font color="#2040a0">data</font> <font color="4444FF">=</font> <font color="#2040a0">re</font>.<font color="#2040a0">compile</font><font color="4444FF">(</font><font color="#2040a0">r</font><font color="#008000">'&lt;!((?!DOCTYPE|--|\[))'</font>, <font color="#2040a0">re</font>.<font color="#2040a0">IGNORECASE</font><font color="4444FF">)</font>.<font color="#2040a0">sub</font><font color="4444FF">(</font><font color="#2040a0">r</font><font color="#008000">'&amp;lt;!\1'</font>, <font color="#2040a0">data</font><font color="4444FF">)</font>
        <font color="#2040a0">data</font> <font color="4444FF">=</font> <font color="#2040a0">re</font>.<font color="#2040a0">sub</font><font color="4444FF">(</font><font color="#2040a0">r</font><font color="#008000">'&lt;(\S+)/&gt;'</font>, <font color="#2040a0">r</font><font color="#008000">'&lt;\1&gt;&lt;/\1&gt;'</font>, <font color="#2040a0">data</font><font color="4444FF">)</font>
        <font color="#2040a0">data</font> <font color="4444FF">=</font> <font color="#2040a0">data</font>.<font color="#2040a0">replace</font><font color="4444FF">(</font><font color="#008000">'&amp;#39;'</font>, <font color="#008000">&quot;'&quot;</font><font color="4444FF">)</font>
        <font color="#2040a0">data</font> <font color="4444FF">=</font> <font color="#2040a0">data</font>.<font color="#2040a0">replace</font><font color="4444FF">(</font><font color="#008000">'&amp;#34;'</font>, <font color="#008000">'&quot;'</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">encoding</font> <strong>and</strong> <font color="4444FF">(</font><font color="#2040a0">type</font><font color="4444FF">(</font><font color="#2040a0">data</font><font color="4444FF">)</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#2040a0">types</font>.<font color="#2040a0">UnicodeType</font><font color="4444FF">)</font><font color="4444FF">:</font>
            <font color="#2040a0">data</font> <font color="4444FF">=</font> <font color="#2040a0">data</font>.<font color="#2040a0">encode</font><font color="4444FF">(</font><font color="#2040a0">self</font>.<font color="#2040a0">encoding</font><font color="4444FF">)</font>
        <font color="#2040a0">sgmllib</font>.<font color="#2040a0">SGMLParser</font>.<font color="#2040a0">feed</font><font color="4444FF">(</font><font color="#2040a0">self</font>, <font color="#2040a0">data</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> normalize_attrs</font><font color="2040a0">(self, attrs)</font>:
</strong>        <font color="#444444"># utility method to be called by descendants</font>
        <font color="#2040a0">attrs</font> <font color="4444FF">=</font> <font color="4444FF">[</font><font color="4444FF">(</font><font color="#2040a0">k</font>.<font color="#2040a0">lower</font><font color="4444FF">(</font><font color="4444FF">)</font>, <font color="#2040a0">v</font><font color="4444FF">)</font> <strong>for</strong> <font color="#2040a0">k</font>, <font color="#2040a0">v</font> <strong>in</strong> <font color="#2040a0">attrs</font><font color="4444FF">]</font>
<font color="#444444">#        if self.encoding:</font>
<font color="#444444">#            if _debug: sys.stderr.write('normalize_attrs, encoding=%s\n' % self.encoding)</font>
<font color="#444444">#            attrs = [(k, v.encode(self.encoding)) for k, v in attrs]</font>
        <font color="#2040a0">attrs</font> <font color="4444FF">=</font> <font color="4444FF">[</font><font color="4444FF">(</font><font color="#2040a0">k</font>, <font color="#2040a0">k</font> <strong>in</strong> <font color="4444FF">(</font><font color="#008000">'rel'</font>, <font color="#008000">'type'</font><font color="4444FF">)</font> <strong>and</strong> <font color="#2040a0">v</font>.<font color="#2040a0">lower</font><font color="4444FF">(</font><font color="4444FF">)</font> <strong>or</strong> <font color="#2040a0">v</font><font color="4444FF">)</font> <strong>for</strong> <font color="#2040a0">k</font>, <font color="#2040a0">v</font> <strong>in</strong> <font color="#2040a0">attrs</font><font color="4444FF">]</font>
        <strong>return</strong> <font color="#2040a0">attrs</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> unknown_starttag</font><font color="2040a0">(self, tag, attrs)</font>:
</strong>        <font color="#444444"># called for each start tag</font>
        <font color="#444444"># attrs is a list of (attr, value) tuples</font>
        <font color="#444444"># e.g. for &lt;pre class=&quot;screen&quot;&gt;, tag=&quot;pre&quot;, attrs=[(&quot;class&quot;, &quot;screen&quot;)]</font>
        <strong>if</strong> <font color="#2040a0">_debug</font><font color="4444FF">:</font> <font color="#2040a0">sys</font>.<font color="#2040a0">stderr</font>.<font color="#2040a0">write</font><font color="4444FF">(</font><font color="#008000">'_BaseHTMLProcessor, unknown_starttag, tag=%s\n'</font> <font color="4444FF">%</font> <font color="#2040a0">tag</font><font color="4444FF">)</font>
        <font color="#2040a0">strattrs</font> <font color="4444FF">=</font> <font color="#008000">&quot;&quot;</font>.<font color="#2040a0">join</font><font color="4444FF">(</font><font color="4444FF">[</font><font color="#008000">' %s=&quot;%s&quot;'</font> <font color="4444FF">%</font> <font color="4444FF">(</font><font color="#2040a0">key</font>, <font color="#2040a0">value</font><font color="4444FF">)</font> <strong>for</strong> <font color="#2040a0">key</font>, <font color="#2040a0">value</font> <strong>in</strong> <font color="#2040a0">attrs</font><font color="4444FF">]</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">tag</font> <strong>in</strong> <font color="#2040a0">self</font>.<font color="#2040a0">elements_no_end_tag</font><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">pieces</font>.<font color="#2040a0">append</font><font color="4444FF">(</font><font color="#008000">&quot;&lt;%(tag)s%(strattrs)s /&gt;&quot;</font> <font color="4444FF">%</font> <font color="#2040a0">locals</font><font color="4444FF">(</font><font color="4444FF">)</font><font color="4444FF">)</font>
        <strong>else</strong><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">pieces</font>.<font color="#2040a0">append</font><font color="4444FF">(</font><font color="#008000">&quot;&lt;%(tag)s%(strattrs)s&gt;&quot;</font> <font color="4444FF">%</font> <font color="#2040a0">locals</font><font color="4444FF">(</font><font color="4444FF">)</font><font color="4444FF">)</font>
        
<strong>   <font color="ff0000"> def</font><font color="ff0000"> unknown_endtag</font><font color="2040a0">(self, tag)</font>:
</strong>        <font color="#444444"># called for each end tag, e.g. for &lt;/pre&gt;, tag will be &quot;pre&quot;</font>
        <font color="#444444"># Reconstruct the original end tag.</font>
        <strong>if</strong> <font color="#2040a0">tag</font> <strong>not</strong> <strong>in</strong> <font color="#2040a0">self</font>.<font color="#2040a0">elements_no_end_tag</font><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">pieces</font>.<font color="#2040a0">append</font><font color="4444FF">(</font><font color="#008000">&quot;&lt;/%(tag)s&gt;&quot;</font> <font color="4444FF">%</font> <font color="#2040a0">locals</font><font color="4444FF">(</font><font color="4444FF">)</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> handle_charref</font><font color="2040a0">(self, ref)</font>:
</strong>        <font color="#444444"># called for each character reference, e.g. for &quot;&amp;#160;&quot;, ref will be &quot;160&quot;</font>
        <font color="#444444"># Reconstruct the original character reference.</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">pieces</font>.<font color="#2040a0">append</font><font color="4444FF">(</font><font color="#008000">&quot;&amp;#%(ref)s;&quot;</font> <font color="4444FF">%</font> <font color="#2040a0">locals</font><font color="4444FF">(</font><font color="4444FF">)</font><font color="4444FF">)</font>
        
<strong>   <font color="ff0000"> def</font><font color="ff0000"> handle_entityref</font><font color="2040a0">(self, ref)</font>:
</strong>        <font color="#444444"># called for each entity reference, e.g. for &quot;&amp;copy;&quot;, ref will be &quot;copy&quot;</font>
        <font color="#444444"># Reconstruct the original entity reference.</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">pieces</font>.<font color="#2040a0">append</font><font color="4444FF">(</font><font color="#008000">&quot;&amp;%(ref)s;&quot;</font> <font color="4444FF">%</font> <font color="#2040a0">locals</font><font color="4444FF">(</font><font color="4444FF">)</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> handle_data</font><font color="2040a0">(self, text)</font>:
</strong>        <font color="#444444"># called for each block of plain text, i.e. outside of any tag and</font>
        <font color="#444444"># not containing any character or entity references</font>
        <font color="#444444"># Store the original text verbatim.</font>
        <strong>if</strong> <font color="#2040a0">_debug</font><font color="4444FF">:</font> <font color="#2040a0">sys</font>.<font color="#2040a0">stderr</font>.<font color="#2040a0">write</font><font color="4444FF">(</font><font color="#008000">'_BaseHTMLProcessor, handle_text, text=%s\n'</font> <font color="4444FF">%</font> <font color="#2040a0">text</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">pieces</font>.<font color="#2040a0">append</font><font color="4444FF">(</font><font color="#2040a0">text</font><font color="4444FF">)</font>
        
<strong>   <font color="ff0000"> def</font><font color="ff0000"> handle_comment</font><font color="2040a0">(self, text)</font>:
</strong>        <font color="#444444"># called for each HTML comment, e.g. &lt;!-- insert Javascript code here --&gt;</font>
        <font color="#444444"># Reconstruct the original comment.</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">pieces</font>.<font color="#2040a0">append</font><font color="4444FF">(</font><font color="#008000">&quot;&lt;!--%(text)s--&gt;&quot;</font> <font color="4444FF">%</font> <font color="#2040a0">locals</font><font color="4444FF">(</font><font color="4444FF">)</font><font color="4444FF">)</font>
        
<strong>   <font color="ff0000"> def</font><font color="ff0000"> handle_pi</font><font color="2040a0">(self, text)</font>:
</strong>        <font color="#444444"># called for each processing instruction, e.g. &lt;?instruction&gt;</font>
        <font color="#444444"># Reconstruct original processing instruction.</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">pieces</font>.<font color="#2040a0">append</font><font color="4444FF">(</font><font color="#008000">&quot;&lt;?%(text)s&gt;&quot;</font> <font color="4444FF">%</font> <font color="#2040a0">locals</font><font color="4444FF">(</font><font color="4444FF">)</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> handle_decl</font><font color="2040a0">(self, text)</font>:
</strong>        <font color="#444444"># called for the DOCTYPE, if present, e.g.</font>
        <font color="#444444"># &lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</font>
        <font color="#444444">#     &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;</font>
        <font color="#444444"># Reconstruct original DOCTYPE</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">pieces</font>.<font color="#2040a0">append</font><font color="4444FF">(</font><font color="#008000">&quot;&lt;!%(text)s&gt;&quot;</font> <font color="4444FF">%</font> <font color="#2040a0">locals</font><font color="4444FF">(</font><font color="4444FF">)</font><font color="4444FF">)</font>
        
    <font color="#2040a0">_new_declname_match</font> <font color="4444FF">=</font> <font color="#2040a0">re</font>.<font color="#2040a0">compile</font><font color="4444FF">(</font><font color="#2040a0">r</font><font color="#008000">'[a-zA-Z][-_.a-zA-Z0-9:]*\s*'</font><font color="4444FF">)</font>.<font color="#2040a0">match</font>
<strong>   <font color="ff0000"> def</font><font color="ff0000"> _scan_name</font><font color="2040a0">(self, i, declstartpos)</font>:
</strong>        <font color="#2040a0">rawdata</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">rawdata</font>
        <font color="#2040a0">n</font> <font color="4444FF">=</font> <font color="#2040a0">len</font><font color="4444FF">(</font><font color="#2040a0">rawdata</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">i</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#2040a0">n</font><font color="4444FF">:</font>
            <strong>return</strong> <font color="#2040a0">None</font>, <font color="4444FF">-</font><font color="#FF0000">1</font>
        <font color="#2040a0">m</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">_new_declname_match</font><font color="4444FF">(</font><font color="#2040a0">rawdata</font>, <font color="#2040a0">i</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">m</font><font color="4444FF">:</font>
            <font color="#2040a0">s</font> <font color="4444FF">=</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="4444FF">)</font>
            <font color="#2040a0">name</font> <font color="4444FF">=</font> <font color="#2040a0">s</font>.<font color="#2040a0">strip</font><font color="4444FF">(</font><font color="4444FF">)</font>
            <strong>if</strong> <font color="4444FF">(</font><font color="#2040a0">i</font> <font color="4444FF">+</font> <font color="#2040a0">len</font><font color="4444FF">(</font><font color="#2040a0">s</font><font color="4444FF">)</font><font color="4444FF">)</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#2040a0">n</font><font color="4444FF">:</font>
                <strong>return</strong> <font color="#2040a0">None</font>, <font color="4444FF">-</font><font color="#FF0000">1</font>  <font color="#444444"># end of buffer</font>
            <strong>return</strong> <font color="#2040a0">name</font>.<font color="#2040a0">lower</font><font color="4444FF">(</font><font color="4444FF">)</font>, <font color="#2040a0">m</font>.<font color="#2040a0">end</font><font color="4444FF">(</font><font color="4444FF">)</font>
        <strong>else</strong><font color="4444FF">:</font>
            <font color="#2040a0">self</font>.<font color="#2040a0">handle_data</font><font color="4444FF">(</font><font color="#2040a0">rawdata</font><font color="4444FF">)</font>
<font color="#444444">#            self.updatepos(declstartpos, i)</font>
            <strong>return</strong> <font color="#2040a0">None</font>, <font color="4444FF">-</font><font color="#FF0000">1</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> output</font><font color="2040a0">(self)</font>:
</strong>        <font color="#008000">&quot;&quot;</font><font color="#008000">&quot;Return processed HTML as a single string&quot;</font><font color="#008000">&quot;&quot;</font>
        <strong>return</strong> <font color="#008000">&quot;&quot;</font>.<font color="#2040a0">join</font><font color="4444FF">(</font><font color="4444FF">[</font><font color="#2040a0">str</font><font color="4444FF">(</font><font color="#2040a0">p</font><font color="4444FF">)</font> <strong>for</strong> <font color="#2040a0">p</font> <strong>in</strong> <font color="#2040a0">self</font>.<font color="#2040a0">pieces</font><font color="4444FF">]</font><font color="4444FF">)</font>

<strong>class</strong> <font color="#2040a0">_LooseFeedParser</font><font color="4444FF">(</font><font color="#2040a0">_FeedParserMixin</font>, <font color="#2040a0">_BaseHTMLProcessor</font><font color="4444FF">)</font><font color="4444FF">:</font>
<strong>   <font color="ff0000"> def</font><font color="ff0000"> __init__</font><font color="2040a0">(self, baseuri, baselang, encoding)</font>:
</strong>        <font color="#2040a0">sgmllib</font>.<font color="#2040a0">SGMLParser</font>.<font color="#2040a0">__init__</font><font color="4444FF">(</font><font color="#2040a0">self</font><font color="4444FF">)</font>
        <font color="#2040a0">_FeedParserMixin</font>.<font color="#2040a0">__init__</font><font color="4444FF">(</font><font color="#2040a0">self</font>, <font color="#2040a0">baseuri</font>, <font color="#2040a0">baselang</font>, <font color="#2040a0">encoding</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> decodeEntities</font><font color="2040a0">(self, element, data)</font>:
</strong>        <font color="#2040a0">data</font> <font color="4444FF">=</font> <font color="#2040a0">data</font>.<font color="#2040a0">replace</font><font color="4444FF">(</font><font color="#008000">'&amp;#60;'</font>, <font color="#008000">'&amp;lt;'</font><font color="4444FF">)</font>
        <font color="#2040a0">data</font> <font color="4444FF">=</font> <font color="#2040a0">data</font>.<font color="#2040a0">replace</font><font color="4444FF">(</font><font color="#008000">'&amp;#x3c;'</font>, <font color="#008000">'&amp;lt;'</font><font color="4444FF">)</font>
        <font color="#2040a0">data</font> <font color="4444FF">=</font> <font color="#2040a0">data</font>.<font color="#2040a0">replace</font><font color="4444FF">(</font><font color="#008000">'&amp;#62;'</font>, <font color="#008000">'&amp;gt;'</font><font color="4444FF">)</font>
        <font color="#2040a0">data</font> <font color="4444FF">=</font> <font color="#2040a0">data</font>.<font color="#2040a0">replace</font><font color="4444FF">(</font><font color="#008000">'&amp;#x3e;'</font>, <font color="#008000">'&amp;gt;'</font><font color="4444FF">)</font>
        <font color="#2040a0">data</font> <font color="4444FF">=</font> <font color="#2040a0">data</font>.<font color="#2040a0">replace</font><font color="4444FF">(</font><font color="#008000">'&amp;#38;'</font>, <font color="#008000">'&amp;amp;'</font><font color="4444FF">)</font>
        <font color="#2040a0">data</font> <font color="4444FF">=</font> <font color="#2040a0">data</font>.<font color="#2040a0">replace</font><font color="4444FF">(</font><font color="#008000">'&amp;#x26;'</font>, <font color="#008000">'&amp;amp;'</font><font color="4444FF">)</font>
        <font color="#2040a0">data</font> <font color="4444FF">=</font> <font color="#2040a0">data</font>.<font color="#2040a0">replace</font><font color="4444FF">(</font><font color="#008000">'&amp;#34;'</font>, <font color="#008000">'&amp;quot;'</font><font color="4444FF">)</font>
        <font color="#2040a0">data</font> <font color="4444FF">=</font> <font color="#2040a0">data</font>.<font color="#2040a0">replace</font><font color="4444FF">(</font><font color="#008000">'&amp;#x22;'</font>, <font color="#008000">'&amp;quot;'</font><font color="4444FF">)</font>
        <font color="#2040a0">data</font> <font color="4444FF">=</font> <font color="#2040a0">data</font>.<font color="#2040a0">replace</font><font color="4444FF">(</font><font color="#008000">'&amp;#39;'</font>, <font color="#008000">'&amp;apos;'</font><font color="4444FF">)</font>
        <font color="#2040a0">data</font> <font color="4444FF">=</font> <font color="#2040a0">data</font>.<font color="#2040a0">replace</font><font color="4444FF">(</font><font color="#008000">'&amp;#x27;'</font>, <font color="#008000">'&amp;apos;'</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">self</font>.<font color="#2040a0">contentparams</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'mode'</font><font color="4444FF">)</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">'escaped'</font><font color="4444FF">:</font>
            <font color="#2040a0">data</font> <font color="4444FF">=</font> <font color="#2040a0">data</font>.<font color="#2040a0">replace</font><font color="4444FF">(</font><font color="#008000">'&amp;lt;'</font>, <font color="#008000">'&lt;'</font><font color="4444FF">)</font>
            <font color="#2040a0">data</font> <font color="4444FF">=</font> <font color="#2040a0">data</font>.<font color="#2040a0">replace</font><font color="4444FF">(</font><font color="#008000">'&amp;gt;'</font>, <font color="#008000">'&gt;'</font><font color="4444FF">)</font>
            <font color="#2040a0">data</font> <font color="4444FF">=</font> <font color="#2040a0">data</font>.<font color="#2040a0">replace</font><font color="4444FF">(</font><font color="#008000">'&amp;amp;'</font>, <font color="#008000">'&amp;'</font><font color="4444FF">)</font>
            <font color="#2040a0">data</font> <font color="4444FF">=</font> <font color="#2040a0">data</font>.<font color="#2040a0">replace</font><font color="4444FF">(</font><font color="#008000">'&amp;quot;'</font>, <font color="#008000">'&quot;'</font><font color="4444FF">)</font>
            <font color="#2040a0">data</font> <font color="4444FF">=</font> <font color="#2040a0">data</font>.<font color="#2040a0">replace</font><font color="4444FF">(</font><font color="#008000">'&amp;apos;'</font>, <font color="#008000">&quot;'&quot;</font><font color="4444FF">)</font>
        <strong>return</strong> <font color="#2040a0">data</font>
        
<strong>class</strong> <font color="#2040a0">_RelativeURIResolver</font><font color="4444FF">(</font><font color="#2040a0">_BaseHTMLProcessor</font><font color="4444FF">)</font><font color="4444FF">:</font>
    <font color="#2040a0">relative_uris</font> <font color="4444FF">=</font> <font color="4444FF">[</font><font color="4444FF">(</font><font color="#008000">'a'</font>, <font color="#008000">'href'</font><font color="4444FF">)</font>,
                     <font color="4444FF">(</font><font color="#008000">'applet'</font>, <font color="#008000">'codebase'</font><font color="4444FF">)</font>,
                     <font color="4444FF">(</font><font color="#008000">'area'</font>, <font color="#008000">'href'</font><font color="4444FF">)</font>,
                     <font color="4444FF">(</font><font color="#008000">'blockquote'</font>, <font color="#008000">'cite'</font><font color="4444FF">)</font>,
                     <font color="4444FF">(</font><font color="#008000">'body'</font>, <font color="#008000">'background'</font><font color="4444FF">)</font>,
                     <font color="4444FF">(</font><font color="#008000">'del'</font>, <font color="#008000">'cite'</font><font color="4444FF">)</font>,
                     <font color="4444FF">(</font><font color="#008000">'form'</font>, <font color="#008000">'action'</font><font color="4444FF">)</font>,
                     <font color="4444FF">(</font><font color="#008000">'frame'</font>, <font color="#008000">'longdesc'</font><font color="4444FF">)</font>,
                     <font color="4444FF">(</font><font color="#008000">'frame'</font>, <font color="#008000">'src'</font><font color="4444FF">)</font>,
                     <font color="4444FF">(</font><font color="#008000">'iframe'</font>, <font color="#008000">'longdesc'</font><font color="4444FF">)</font>,
                     <font color="4444FF">(</font><font color="#008000">'iframe'</font>, <font color="#008000">'src'</font><font color="4444FF">)</font>,
                     <font color="4444FF">(</font><font color="#008000">'head'</font>, <font color="#008000">'profile'</font><font color="4444FF">)</font>,
                     <font color="4444FF">(</font><font color="#008000">'img'</font>, <font color="#008000">'longdesc'</font><font color="4444FF">)</font>,
                     <font color="4444FF">(</font><font color="#008000">'img'</font>, <font color="#008000">'src'</font><font color="4444FF">)</font>,
                     <font color="4444FF">(</font><font color="#008000">'img'</font>, <font color="#008000">'usemap'</font><font color="4444FF">)</font>,
                     <font color="4444FF">(</font><font color="#008000">'input'</font>, <font color="#008000">'src'</font><font color="4444FF">)</font>,
                     <font color="4444FF">(</font><font color="#008000">'input'</font>, <font color="#008000">'usemap'</font><font color="4444FF">)</font>,
                     <font color="4444FF">(</font><font color="#008000">'ins'</font>, <font color="#008000">'cite'</font><font color="4444FF">)</font>,
                     <font color="4444FF">(</font><font color="#008000">'link'</font>, <font color="#008000">'href'</font><font color="4444FF">)</font>,
                     <font color="4444FF">(</font><font color="#008000">'object'</font>, <font color="#008000">'classid'</font><font color="4444FF">)</font>,
                     <font color="4444FF">(</font><font color="#008000">'object'</font>, <font color="#008000">'codebase'</font><font color="4444FF">)</font>,
                     <font color="4444FF">(</font><font color="#008000">'object'</font>, <font color="#008000">'data'</font><font color="4444FF">)</font>,
                     <font color="4444FF">(</font><font color="#008000">'object'</font>, <font color="#008000">'usemap'</font><font color="4444FF">)</font>,
                     <font color="4444FF">(</font><font color="#008000">'q'</font>, <font color="#008000">'cite'</font><font color="4444FF">)</font>,
                     <font color="4444FF">(</font><font color="#008000">'script'</font>, <font color="#008000">'src'</font><font color="4444FF">)</font><font color="4444FF">]</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> __init__</font><font color="2040a0">(self, baseuri, encoding)</font>:
</strong>        <font color="#2040a0">_BaseHTMLProcessor</font>.<font color="#2040a0">__init__</font><font color="4444FF">(</font><font color="#2040a0">self</font>, <font color="#2040a0">encoding</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">baseuri</font> <font color="4444FF">=</font> <font color="#2040a0">baseuri</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> resolveURI</font><font color="2040a0">(self, uri)</font>:
</strong>        <strong>return</strong> <font color="#2040a0">urlparse</font>.<font color="#2040a0">urljoin</font><font color="4444FF">(</font><font color="#2040a0">self</font>.<font color="#2040a0">baseuri</font>, <font color="#2040a0">uri</font><font color="4444FF">)</font>
    
<strong>   <font color="ff0000"> def</font><font color="ff0000"> unknown_starttag</font><font color="2040a0">(self, tag, attrs)</font>:
</strong>        <font color="#2040a0">attrs</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">normalize_attrs</font><font color="4444FF">(</font><font color="#2040a0">attrs</font><font color="4444FF">)</font>
        <font color="#2040a0">attrs</font> <font color="4444FF">=</font> <font color="4444FF">[</font><font color="4444FF">(</font><font color="#2040a0">key</font>, <font color="4444FF">(</font><font color="4444FF">(</font><font color="#2040a0">tag</font>, <font color="#2040a0">key</font><font color="4444FF">)</font> <strong>in</strong> <font color="#2040a0">self</font>.<font color="#2040a0">relative_uris</font><font color="4444FF">)</font> <strong>and</strong> <font color="#2040a0">self</font>.<font color="#2040a0">resolveURI</font><font color="4444FF">(</font><font color="#2040a0">value</font><font color="4444FF">)</font> <strong>or</strong> <font color="#2040a0">value</font><font color="4444FF">)</font> <strong>for</strong> <font color="#2040a0">key</font>, <font color="#2040a0">value</font> <strong>in</strong> <font color="#2040a0">attrs</font><font color="4444FF">]</font>
        <font color="#2040a0">_BaseHTMLProcessor</font>.<font color="#2040a0">unknown_starttag</font><font color="4444FF">(</font><font color="#2040a0">self</font>, <font color="#2040a0">tag</font>, <font color="#2040a0">attrs</font><font color="4444FF">)</font>
        
<font color="#2040a0">def</font> <font color="#2040a0">_resolveRelativeURIs</font><font color="4444FF">(</font><font color="#2040a0">htmlSource</font>, <font color="#2040a0">baseURI</font>, <font color="#2040a0">encoding</font><font color="4444FF">)</font><font color="4444FF">:</font>
    <strong>if</strong> <font color="#2040a0">_debug</font><font color="4444FF">:</font> <font color="#2040a0">sys</font>.<font color="#2040a0">stderr</font>.<font color="#2040a0">write</font><font color="4444FF">(</font><font color="#008000">&quot;entering _resolveRelativeURIs<font color="#77dd77">\n</font>&quot;</font><font color="4444FF">)</font>
    <font color="#2040a0">p</font> <font color="4444FF">=</font> <font color="#2040a0">_RelativeURIResolver</font><font color="4444FF">(</font><font color="#2040a0">baseURI</font>, <font color="#2040a0">encoding</font><font color="4444FF">)</font>
    <font color="#2040a0">p</font>.<font color="#2040a0">feed</font><font color="4444FF">(</font><font color="#2040a0">htmlSource</font><font color="4444FF">)</font>
    <strong>return</strong> <font color="#2040a0">p</font>.<font color="#2040a0">output</font><font color="4444FF">(</font><font color="4444FF">)</font>

<strong>class</strong> <font color="#2040a0">_HTMLSanitizer</font><font color="4444FF">(</font><font color="#2040a0">_BaseHTMLProcessor</font><font color="4444FF">)</font><font color="4444FF">:</font>
    <font color="#2040a0">acceptable_elements</font> <font color="4444FF">=</font> <font color="4444FF">[</font><font color="#008000">'a'</font>, <font color="#008000">'abbr'</font>, <font color="#008000">'acronym'</font>, <font color="#008000">'address'</font>, <font color="#008000">'area'</font>, <font color="#008000">'b'</font>, <font color="#008000">'big'</font>,
      <font color="#008000">'blockquote'</font>, <font color="#008000">'br'</font>, <font color="#008000">'button'</font>, <font color="#008000">'caption'</font>, <font color="#008000">'center'</font>, <font color="#008000">'cite'</font>, <font color="#008000">'code'</font>, <font color="#008000">'col'</font>,
      <font color="#008000">'colgroup'</font>, <font color="#008000">'dd'</font>, <font color="#008000">'del'</font>, <font color="#008000">'dfn'</font>, <font color="#008000">'dir'</font>, <font color="#008000">'div'</font>, <font color="#008000">'dl'</font>, <font color="#008000">'dt'</font>, <font color="#008000">'em'</font>, <font color="#008000">'fieldset'</font>,
      <font color="#008000">'font'</font>, <font color="#008000">'form'</font>, <font color="#008000">'h1'</font>, <font color="#008000">'h2'</font>, <font color="#008000">'h3'</font>, <font color="#008000">'h4'</font>, <font color="#008000">'h5'</font>, <font color="#008000">'h6'</font>, <font color="#008000">'hr'</font>, <font color="#008000">'i'</font>, <font color="#008000">'img'</font>, <font color="#008000">'input'</font>,
      <font color="#008000">'ins'</font>, <font color="#008000">'kbd'</font>, <font color="#008000">'label'</font>, <font color="#008000">'legend'</font>, <font color="#008000">'li'</font>, <font color="#008000">'map'</font>, <font color="#008000">'menu'</font>, <font color="#008000">'ol'</font>, <font color="#008000">'optgroup'</font>,
      <font color="#008000">'option'</font>, <font color="#008000">'p'</font>, <font color="#008000">'pre'</font>, <font color="#008000">'q'</font>, <font color="#008000">'s'</font>, <font color="#008000">'samp'</font>, <font color="#008000">'select'</font>, <font color="#008000">'small'</font>, <font color="#008000">'span'</font>, <font color="#008000">'strike'</font>,
      <font color="#008000">'strong'</font>, <font color="#008000">'sub'</font>, <font color="#008000">'sup'</font>, <font color="#008000">'table'</font>, <font color="#008000">'tbody'</font>, <font color="#008000">'td'</font>, <font color="#008000">'textarea'</font>, <font color="#008000">'tfoot'</font>, <font color="#008000">'th'</font>,
      <font color="#008000">'thead'</font>, <font color="#008000">'tr'</font>, <font color="#008000">'tt'</font>, <font color="#008000">'u'</font>, <font color="#008000">'ul'</font>, <font color="#008000">'var'</font><font color="4444FF">]</font>

    <font color="#2040a0">acceptable_attributes</font> <font color="4444FF">=</font> <font color="4444FF">[</font><font color="#008000">'abbr'</font>, <font color="#008000">'accept'</font>, <font color="#008000">'accept-charset'</font>, <font color="#008000">'accesskey'</font>,
      <font color="#008000">'action'</font>, <font color="#008000">'align'</font>, <font color="#008000">'alt'</font>, <font color="#008000">'axis'</font>, <font color="#008000">'border'</font>, <font color="#008000">'cellpadding'</font>, <font color="#008000">'cellspacing'</font>,
      <font color="#008000">'char'</font>, <font color="#008000">'charoff'</font>, <font color="#008000">'charset'</font>, <font color="#008000">'checked'</font>, <font color="#008000">'cite'</font>, <font color="#008000">'class'</font>, <font color="#008000">'clear'</font>, <font color="#008000">'cols'</font>,
      <font color="#008000">'colspan'</font>, <font color="#008000">'color'</font>, <font color="#008000">'compact'</font>, <font color="#008000">'coords'</font>, <font color="#008000">'datetime'</font>, <font color="#008000">'dir'</font>, <font color="#008000">'disabled'</font>,
      <font color="#008000">'enctype'</font>, <font color="#008000">'for'</font>, <font color="#008000">'frame'</font>, <font color="#008000">'headers'</font>, <font color="#008000">'height'</font>, <font color="#008000">'href'</font>, <font color="#008000">'hreflang'</font>, <font color="#008000">'hspace'</font>,
      <font color="#008000">'id'</font>, <font color="#008000">'ismap'</font>, <font color="#008000">'label'</font>, <font color="#008000">'lang'</font>, <font color="#008000">'longdesc'</font>, <font color="#008000">'maxlength'</font>, <font color="#008000">'media'</font>, <font color="#008000">'method'</font>,
      <font color="#008000">'multiple'</font>, <font color="#008000">'name'</font>, <font color="#008000">'nohref'</font>, <font color="#008000">'noshade'</font>, <font color="#008000">'nowrap'</font>, <font color="#008000">'prompt'</font>, <font color="#008000">'readonly'</font>,
      <font color="#008000">'rel'</font>, <font color="#008000">'rev'</font>, <font color="#008000">'rows'</font>, <font color="#008000">'rowspan'</font>, <font color="#008000">'rules'</font>, <font color="#008000">'scope'</font>, <font color="#008000">'selected'</font>, <font color="#008000">'shape'</font>, <font color="#008000">'size'</font>,
      <font color="#008000">'span'</font>, <font color="#008000">'src'</font>, <font color="#008000">'start'</font>, <font color="#008000">'summary'</font>, <font color="#008000">'tabindex'</font>, <font color="#008000">'target'</font>, <font color="#008000">'title'</font>, <font color="#008000">'type'</font>,
      <font color="#008000">'usemap'</font>, <font color="#008000">'valign'</font>, <font color="#008000">'value'</font>, <font color="#008000">'vspace'</font>, <font color="#008000">'width'</font><font color="4444FF">]</font>

    <font color="#2040a0">unacceptable_elements_with_end_tag</font> <font color="4444FF">=</font> <font color="4444FF">[</font><font color="#008000">'script'</font>, <font color="#008000">'applet'</font><font color="4444FF">]</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> reset</font><font color="2040a0">(self)</font>:
</strong>        <font color="#2040a0">_BaseHTMLProcessor</font>.<font color="#2040a0">reset</font><font color="4444FF">(</font><font color="#2040a0">self</font><font color="4444FF">)</font>
        <font color="#2040a0">self</font>.<font color="#2040a0">unacceptablestack</font> <font color="4444FF">=</font> <font color="#FF0000">0</font>
        
<strong>   <font color="ff0000"> def</font><font color="ff0000"> unknown_starttag</font><font color="2040a0">(self, tag, attrs)</font>:
</strong>        <strong>if</strong> <strong>not</strong> <font color="#2040a0">tag</font> <strong>in</strong> <font color="#2040a0">self</font>.<font color="#2040a0">acceptable_elements</font><font color="4444FF">:</font>
            <strong>if</strong> <font color="#2040a0">tag</font> <strong>in</strong> <font color="#2040a0">self</font>.<font color="#2040a0">unacceptable_elements_with_end_tag</font><font color="4444FF">:</font>
                <font color="#2040a0">self</font>.<font color="#2040a0">unacceptablestack</font> <font color="4444FF">+</font><font color="4444FF">=</font> <font color="#FF0000">1</font>
            <strong>return</strong>
        <font color="#2040a0">attrs</font> <font color="4444FF">=</font> <font color="#2040a0">self</font>.<font color="#2040a0">normalize_attrs</font><font color="4444FF">(</font><font color="#2040a0">attrs</font><font color="4444FF">)</font>
        <font color="#2040a0">attrs</font> <font color="4444FF">=</font> <font color="4444FF">[</font><font color="4444FF">(</font><font color="#2040a0">key</font>, <font color="#2040a0">value</font><font color="4444FF">)</font> <strong>for</strong> <font color="#2040a0">key</font>, <font color="#2040a0">value</font> <strong>in</strong> <font color="#2040a0">attrs</font> <strong>if</strong> <font color="#2040a0">key</font> <strong>in</strong> <font color="#2040a0">self</font>.<font color="#2040a0">acceptable_attributes</font><font color="4444FF">]</font>
        <font color="#2040a0">_BaseHTMLProcessor</font>.<font color="#2040a0">unknown_starttag</font><font color="4444FF">(</font><font color="#2040a0">self</font>, <font color="#2040a0">tag</font>, <font color="#2040a0">attrs</font><font color="4444FF">)</font>
        
<strong>   <font color="ff0000"> def</font><font color="ff0000"> unknown_endtag</font><font color="2040a0">(self, tag)</font>:
</strong>        <strong>if</strong> <strong>not</strong> <font color="#2040a0">tag</font> <strong>in</strong> <font color="#2040a0">self</font>.<font color="#2040a0">acceptable_elements</font><font color="4444FF">:</font>
            <strong>if</strong> <font color="#2040a0">tag</font> <strong>in</strong> <font color="#2040a0">self</font>.<font color="#2040a0">unacceptable_elements_with_end_tag</font><font color="4444FF">:</font>
                <font color="#2040a0">self</font>.<font color="#2040a0">unacceptablestack</font> <font color="4444FF">-</font><font color="4444FF">=</font> <font color="#FF0000">1</font>
            <strong>return</strong>
        <font color="#2040a0">_BaseHTMLProcessor</font>.<font color="#2040a0">unknown_endtag</font><font color="4444FF">(</font><font color="#2040a0">self</font>, <font color="#2040a0">tag</font><font color="4444FF">)</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> handle_pi</font><font color="2040a0">(self, text)</font>:
</strong>        <strong>pass</strong>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> handle_decl</font><font color="2040a0">(self, text)</font>:
</strong>        <strong>pass</strong>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> handle_data</font><font color="2040a0">(self, text)</font>:
</strong>        <strong>if</strong> <strong>not</strong> <font color="#2040a0">self</font>.<font color="#2040a0">unacceptablestack</font><font color="4444FF">:</font>
            <font color="#2040a0">_BaseHTMLProcessor</font>.<font color="#2040a0">handle_data</font><font color="4444FF">(</font><font color="#2040a0">self</font>, <font color="#2040a0">text</font><font color="4444FF">)</font>

<font color="#2040a0">def</font> <font color="#2040a0">_sanitizeHTML</font><font color="4444FF">(</font><font color="#2040a0">htmlSource</font>, <font color="#2040a0">encoding</font><font color="4444FF">)</font><font color="4444FF">:</font>
    <font color="#2040a0">p</font> <font color="4444FF">=</font> <font color="#2040a0">_HTMLSanitizer</font><font color="4444FF">(</font><font color="#2040a0">encoding</font><font color="4444FF">)</font>
    <font color="#2040a0">p</font>.<font color="#2040a0">feed</font><font color="4444FF">(</font><font color="#2040a0">htmlSource</font><font color="4444FF">)</font>
    <font color="#2040a0">data</font> <font color="4444FF">=</font> <font color="#2040a0">p</font>.<font color="#2040a0">output</font><font color="4444FF">(</font><font color="4444FF">)</font>
    <strong>if</strong> <font color="#2040a0">_mxtidy</font> <strong>and</strong> <font color="#2040a0">TIDY_MARKUP</font><font color="4444FF">:</font>
        <font color="#2040a0">nerrors</font>, <font color="#2040a0">nwarnings</font>, <font color="#2040a0">data</font>, <font color="#2040a0">errordata</font> <font color="4444FF">=</font> <font color="#2040a0">_mxtidy</font>.<font color="#2040a0">tidy</font><font color="4444FF">(</font><font color="#2040a0">data</font>, <font color="#2040a0">output_xhtml</font><font color="4444FF">=</font><font color="#FF0000">1</font>, <font color="#2040a0">numeric_entities</font><font color="4444FF">=</font><font color="#FF0000">1</font>, <font color="#2040a0">wrap</font><font color="4444FF">=</font><font color="#FF0000">0</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">data</font>.<font color="#2040a0">count</font><font color="4444FF">(</font><font color="#008000">'&lt;body'</font><font color="4444FF">)</font><font color="4444FF">:</font>
            <font color="#2040a0">data</font> <font color="4444FF">=</font> <font color="#2040a0">data</font>.<font color="#2040a0">split</font><font color="4444FF">(</font><font color="#008000">'&lt;body'</font>, <font color="#FF0000">1</font><font color="4444FF">)</font><font color="4444FF">[</font><font color="#FF0000">1</font><font color="4444FF">]</font>
            <strong>if</strong> <font color="#2040a0">data</font>.<font color="#2040a0">count</font><font color="4444FF">(</font><font color="#008000">'&gt;'</font><font color="4444FF">)</font><font color="4444FF">:</font>
                <font color="#2040a0">data</font> <font color="4444FF">=</font> <font color="#2040a0">data</font>.<font color="#2040a0">split</font><font color="4444FF">(</font><font color="#008000">'&gt;'</font>, <font color="#FF0000">1</font><font color="4444FF">)</font><font color="4444FF">[</font><font color="#FF0000">1</font><font color="4444FF">]</font>
        <strong>if</strong> <font color="#2040a0">data</font>.<font color="#2040a0">count</font><font color="4444FF">(</font><font color="#008000">'&lt;/body'</font><font color="4444FF">)</font><font color="4444FF">:</font>
            <font color="#2040a0">data</font> <font color="4444FF">=</font> <font color="#2040a0">data</font>.<font color="#2040a0">split</font><font color="4444FF">(</font><font color="#008000">'&lt;/body'</font>, <font color="#FF0000">1</font><font color="4444FF">)</font><font color="4444FF">[</font><font color="#FF0000">0</font><font color="4444FF">]</font>
    <font color="#2040a0">data</font> <font color="4444FF">=</font> <font color="#2040a0">data</font>.<font color="#2040a0">strip</font><font color="4444FF">(</font><font color="4444FF">)</font>.<font color="#2040a0">replace</font><font color="4444FF">(</font><font color="#008000">'\r\n'</font>, <font color="#008000">'\n'</font><font color="4444FF">)</font>
    <strong>return</strong> <font color="#2040a0">data</font>

<strong>class</strong> <font color="#2040a0">_FeedURLHandler</font><font color="4444FF">(</font><font color="#2040a0">urllib2</font>.<font color="#2040a0">HTTPRedirectHandler</font>, <font color="#2040a0">urllib2</font>.<font color="#2040a0">HTTPDefaultErrorHandler</font><font color="4444FF">)</font><font color="4444FF">:</font>
<strong>   <font color="ff0000"> def</font><font color="ff0000"> http_error_default</font><font color="2040a0">(self, req, fp, code, msg, headers)</font>:
</strong>        <strong>if</strong> <font color="4444FF">(</font><font color="4444FF">(</font><font color="#2040a0">code</font> / <font color="#FF0000">100</font><font color="4444FF">)</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#FF0000">3</font><font color="4444FF">)</font> <strong>and</strong> <font color="4444FF">(</font><font color="#2040a0">code</font> <font color="4444FF">!</font><font color="4444FF">=</font> <font color="#FF0000">304</font><font color="4444FF">)</font><font color="4444FF">:</font>
            <strong>return</strong> <font color="#2040a0">self</font>.<font color="#2040a0">http_error_302</font><font color="4444FF">(</font><font color="#2040a0">req</font>, <font color="#2040a0">fp</font>, <font color="#2040a0">code</font>, <font color="#2040a0">msg</font>, <font color="#2040a0">headers</font><font color="4444FF">)</font>
        <font color="#2040a0">infourl</font> <font color="4444FF">=</font> <font color="#2040a0">urllib</font>.<font color="#2040a0">addinfourl</font><font color="4444FF">(</font><font color="#2040a0">fp</font>, <font color="#2040a0">headers</font>, <font color="#2040a0">req</font>.<font color="#2040a0">get_full_url</font><font color="4444FF">(</font><font color="4444FF">)</font><font color="4444FF">)</font>
        <font color="#2040a0">infourl</font>.<font color="#2040a0">status</font> <font color="4444FF">=</font> <font color="#2040a0">code</font>
        <strong>return</strong> <font color="#2040a0">infourl</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> http_error_302</font><font color="2040a0">(self, req, fp, code, msg, headers)</font>:
</strong>        <strong>if</strong> <font color="#2040a0">headers</font>.<font color="#2040a0">dict</font>.<font color="#2040a0">has_key</font><font color="4444FF">(</font><font color="#008000">'location'</font><font color="4444FF">)</font><font color="4444FF">:</font>
            <font color="#2040a0">infourl</font> <font color="4444FF">=</font> <font color="#2040a0">urllib2</font>.<font color="#2040a0">HTTPRedirectHandler</font>.<font color="#2040a0">http_error_302</font><font color="4444FF">(</font><font color="#2040a0">self</font>, <font color="#2040a0">req</font>, <font color="#2040a0">fp</font>, <font color="#2040a0">code</font>, <font color="#2040a0">msg</font>, <font color="#2040a0">headers</font><font color="4444FF">)</font>
        <strong>else</strong><font color="4444FF">:</font>
            <font color="#2040a0">infourl</font> <font color="4444FF">=</font> <font color="#2040a0">urllib</font>.<font color="#2040a0">addinfourl</font><font color="4444FF">(</font><font color="#2040a0">fp</font>, <font color="#2040a0">headers</font>, <font color="#2040a0">req</font>.<font color="#2040a0">get_full_url</font><font color="4444FF">(</font><font color="4444FF">)</font><font color="4444FF">)</font>
        <strong>if</strong> <strong>not</strong> <font color="#2040a0">hasattr</font><font color="4444FF">(</font><font color="#2040a0">infourl</font>, <font color="#008000">'status'</font><font color="4444FF">)</font><font color="4444FF">:</font>
            <font color="#2040a0">infourl</font>.<font color="#2040a0">status</font> <font color="4444FF">=</font> <font color="#2040a0">code</font>
        <strong>return</strong> <font color="#2040a0">infourl</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> http_error_301</font><font color="2040a0">(self, req, fp, code, msg, headers)</font>:
</strong>        <strong>if</strong> <font color="#2040a0">headers</font>.<font color="#2040a0">dict</font>.<font color="#2040a0">has_key</font><font color="4444FF">(</font><font color="#008000">'location'</font><font color="4444FF">)</font><font color="4444FF">:</font>
            <font color="#2040a0">infourl</font> <font color="4444FF">=</font> <font color="#2040a0">urllib2</font>.<font color="#2040a0">HTTPRedirectHandler</font>.<font color="#2040a0">http_error_301</font><font color="4444FF">(</font><font color="#2040a0">self</font>, <font color="#2040a0">req</font>, <font color="#2040a0">fp</font>, <font color="#2040a0">code</font>, <font color="#2040a0">msg</font>, <font color="#2040a0">headers</font><font color="4444FF">)</font>
        <strong>else</strong><font color="4444FF">:</font>
            <font color="#2040a0">infourl</font> <font color="4444FF">=</font> <font color="#2040a0">urllib</font>.<font color="#2040a0">addinfourl</font><font color="4444FF">(</font><font color="#2040a0">fp</font>, <font color="#2040a0">headers</font>, <font color="#2040a0">req</font>.<font color="#2040a0">get_full_url</font><font color="4444FF">(</font><font color="4444FF">)</font><font color="4444FF">)</font>
        <strong>if</strong> <strong>not</strong> <font color="#2040a0">hasattr</font><font color="4444FF">(</font><font color="#2040a0">infourl</font>, <font color="#008000">'status'</font><font color="4444FF">)</font><font color="4444FF">:</font>
            <font color="#2040a0">infourl</font>.<font color="#2040a0">status</font> <font color="4444FF">=</font> <font color="#2040a0">code</font>
        <strong>return</strong> <font color="#2040a0">infourl</font>

    <font color="#2040a0">http_error_300</font> <font color="4444FF">=</font> <font color="#2040a0">http_error_302</font>
    <font color="#2040a0">http_error_303</font> <font color="4444FF">=</font> <font color="#2040a0">http_error_302</font>
    <font color="#2040a0">http_error_307</font> <font color="4444FF">=</font> <font color="#2040a0">http_error_302</font>
        
<font color="#2040a0">def</font> <font color="#2040a0">_open_resource</font><font color="4444FF">(</font><font color="#2040a0">url_file_stream_or_string</font>, <font color="#2040a0">etag</font>, <font color="#2040a0">modified</font>, <font color="#2040a0">agent</font>, <font color="#2040a0">referrer</font>, <font color="#2040a0">handlers</font><font color="4444FF">)</font><font color="4444FF">:</font>
    <font color="#008000">&quot;&quot;</font><font color="#008000">&quot;URL, filename, or string --&gt; stream

    This function lets you define parsers that take any input source
    (URL, pathname to local or network file, or actual data as a string)
    and deal with it in a uniform manner.  Returned object is guaranteed
    to have all the basic stdio read methods (read, readline, readlines).
    Just .close() the object when you're done with it.

    If the etag argument is supplied, it will be used as the value of an
    If-None-Match request header.

    If the modified argument is supplied, it must be a tuple of 9 integers
    as returned by gmtime() in the standard Python time module. This MUST
    be in GMT (Greenwich Mean Time). The formatted date/time will be used
    as the value of an If-Modified-Since request header.

    If the agent argument is supplied, it will be used as the value of a
    User-Agent request header.

    If the referrer argument is supplied, it will be used as the value of a
    Referer[sic] request header.

    If handlers is supplied, it is a list of handlers used to build a
    urllib2 opener.
    &quot;</font><font color="#008000">&quot;&quot;</font>

    <strong>if</strong> <font color="#2040a0">hasattr</font><font color="4444FF">(</font><font color="#2040a0">url_file_stream_or_string</font>, <font color="#008000">&quot;read&quot;</font><font color="4444FF">)</font><font color="4444FF">:</font>
        <strong>return</strong> <font color="#2040a0">url_file_stream_or_string</font>

    <strong>if</strong> <font color="#2040a0">url_file_stream_or_string</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">&quot;-&quot;</font><font color="4444FF">:</font>
        <strong>return</strong> <font color="#2040a0">sys</font>.<font color="#2040a0">stdin</font>

    <strong>if</strong> <font color="#2040a0">urlparse</font>.<font color="#2040a0">urlparse</font><font color="4444FF">(</font><font color="#2040a0">url_file_stream_or_string</font><font color="4444FF">)</font><font color="4444FF">[</font><font color="#FF0000">0</font><font color="4444FF">]</font> <strong>in</strong> <font color="4444FF">(</font><font color="#008000">'http'</font>, <font color="#008000">'https'</font>, <font color="#008000">'ftp'</font><font color="4444FF">)</font><font color="4444FF">:</font>
        <strong>if</strong> <strong>not</strong> <font color="#2040a0">agent</font><font color="4444FF">:</font>
            <font color="#2040a0">agent</font> <font color="4444FF">=</font> <font color="#2040a0">USER_AGENT</font>
        <font color="#444444"># test for inline user:password for basic auth</font>
        <font color="#2040a0">auth</font> <font color="4444FF">=</font> <font color="#2040a0">None</font>
        <strong>if</strong> <font color="#2040a0">base64</font><font color="4444FF">:</font>
            <font color="#2040a0">urltype</font>, <font color="#2040a0">rest</font> <font color="4444FF">=</font> <font color="#2040a0">urllib</font>.<font color="#2040a0">splittype</font><font color="4444FF">(</font><font color="#2040a0">url_file_stream_or_string</font><font color="4444FF">)</font>
            <font color="#2040a0">realhost</font>, <font color="#2040a0">rest</font> <font color="4444FF">=</font> <font color="#2040a0">urllib</font>.<font color="#2040a0">splithost</font><font color="4444FF">(</font><font color="#2040a0">rest</font><font color="4444FF">)</font>
            <strong>if</strong> <font color="#2040a0">realhost</font><font color="4444FF">:</font>
                <font color="#2040a0">user_passwd</font>, <font color="#2040a0">realhost</font> <font color="4444FF">=</font> <font color="#2040a0">urllib</font>.<font color="#2040a0">splituser</font><font color="4444FF">(</font><font color="#2040a0">realhost</font><font color="4444FF">)</font>
                <strong>if</strong> <font color="#2040a0">user_passwd</font><font color="4444FF">:</font>
                    <font color="#2040a0">url_file_stream_or_string</font> <font color="4444FF">=</font> <font color="#008000">&quot;%s://%s%s&quot;</font> <font color="4444FF">%</font> <font color="4444FF">(</font><font color="#2040a0">urltype</font>, <font color="#2040a0">realhost</font>, <font color="#2040a0">rest</font><font color="4444FF">)</font>
                    <font color="#2040a0">auth</font> <font color="4444FF">=</font> <font color="#2040a0">base64</font>.<font color="#2040a0">encodestring</font><font color="4444FF">(</font><font color="#2040a0">user_passwd</font><font color="4444FF">)</font>.<font color="#2040a0">strip</font><font color="4444FF">(</font><font color="4444FF">)</font>
        <font color="#444444"># try to open with urllib2 (to use optional headers)</font>
        <font color="#2040a0">request</font> <font color="4444FF">=</font> <font color="#2040a0">urllib2</font>.<font color="#2040a0">Request</font><font color="4444FF">(</font><font color="#2040a0">url_file_stream_or_string</font><font color="4444FF">)</font>
        <font color="#2040a0">request</font>.<font color="#2040a0">add_header</font><font color="4444FF">(</font><font color="#008000">&quot;User-Agent&quot;</font>, <font color="#2040a0">agent</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">etag</font><font color="4444FF">:</font>
            <font color="#2040a0">request</font>.<font color="#2040a0">add_header</font><font color="4444FF">(</font><font color="#008000">&quot;If-None-Match&quot;</font>, <font color="#2040a0">etag</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">modified</font><font color="4444FF">:</font>
            <font color="#444444"># format into an RFC 1123-compliant timestamp. We can't use</font>
            <font color="#444444"># time.strftime() since the %a and %b directives can be affected</font>
            <font color="#444444"># by the current locale, but RFC 2616 states that dates must be</font>
            <font color="#444444"># in English.</font>
            <font color="#2040a0">short_weekdays</font> <font color="4444FF">=</font> <font color="4444FF">[</font><font color="#008000">&quot;Mon&quot;</font>, <font color="#008000">&quot;Tue&quot;</font>, <font color="#008000">&quot;Wed&quot;</font>, <font color="#008000">&quot;Thu&quot;</font>, <font color="#008000">&quot;Fri&quot;</font>, <font color="#008000">&quot;Sat&quot;</font>, <font color="#008000">&quot;Sun&quot;</font><font color="4444FF">]</font>
            <font color="#2040a0">months</font> <font color="4444FF">=</font> <font color="4444FF">[</font><font color="#008000">&quot;Jan&quot;</font>, <font color="#008000">&quot;Feb&quot;</font>, <font color="#008000">&quot;Mar&quot;</font>, <font color="#008000">&quot;Apr&quot;</font>, <font color="#008000">&quot;May&quot;</font>, <font color="#008000">&quot;Jun&quot;</font>, <font color="#008000">&quot;Jul&quot;</font>, <font color="#008000">&quot;Aug&quot;</font>, <font color="#008000">&quot;Sep&quot;</font>, <font color="#008000">&quot;Oct&quot;</font>, <font color="#008000">&quot;Nov&quot;</font>, <font color="#008000">&quot;Dec&quot;</font><font color="4444FF">]</font>
            <font color="#2040a0">request</font>.<font color="#2040a0">add_header</font><font color="4444FF">(</font><font color="#008000">&quot;If-Modified-Since&quot;</font>, <font color="#008000">&quot;%s, %02d %s %04d %02d:%02d:%02d GMT&quot;</font> <font color="4444FF">%</font> <font color="4444FF">(</font><font color="#2040a0">short_weekdays</font><font color="4444FF">[</font><font color="#2040a0">modified</font><font color="4444FF">[</font><font color="#FF0000">6</font><font color="4444FF">]</font><font color="4444FF">]</font>, <font color="#2040a0">modified</font><font color="4444FF">[</font><font color="#FF0000">2</font><font color="4444FF">]</font>, <font color="#2040a0">months</font><font color="4444FF">[</font><font color="#2040a0">modified</font><font color="4444FF">[</font><font color="#FF0000">1</font><font color="4444FF">]</font> <font color="4444FF">-</font> <font color="#FF0000">1</font><font color="4444FF">]</font>, <font color="#2040a0">modified</font><font color="4444FF">[</font><font color="#FF0000">0</font><font color="4444FF">]</font>, <font color="#2040a0">modified</font><font color="4444FF">[</font><font color="#FF0000">3</font><font color="4444FF">]</font>, <font color="#2040a0">modified</font><font color="4444FF">[</font><font color="#FF0000">4</font><font color="4444FF">]</font>, <font color="#2040a0">modified</font><font color="4444FF">[</font><font color="#FF0000">5</font><font color="4444FF">]</font><font color="4444FF">)</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">referrer</font><font color="4444FF">:</font>
            <font color="#2040a0">request</font>.<font color="#2040a0">add_header</font><font color="4444FF">(</font><font color="#008000">&quot;Referer&quot;</font>, <font color="#2040a0">referrer</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">gzip</font> <strong>and</strong> <font color="#2040a0">zlib</font><font color="4444FF">:</font>
            <font color="#2040a0">request</font>.<font color="#2040a0">add_header</font><font color="4444FF">(</font><font color="#008000">&quot;Accept-encoding&quot;</font>, <font color="#008000">&quot;gzip, deflate&quot;</font><font color="4444FF">)</font>
        <strong>elif</strong> <font color="#2040a0">gzip</font><font color="4444FF">:</font>
            <font color="#2040a0">request</font>.<font color="#2040a0">add_header</font><font color="4444FF">(</font><font color="#008000">&quot;Accept-encoding&quot;</font>, <font color="#008000">&quot;gzip&quot;</font><font color="4444FF">)</font>
        <strong>elif</strong> <font color="#2040a0">zlib</font><font color="4444FF">:</font>
            <font color="#2040a0">request</font>.<font color="#2040a0">add_header</font><font color="4444FF">(</font><font color="#008000">&quot;Accept-encoding&quot;</font>, <font color="#008000">&quot;deflate&quot;</font><font color="4444FF">)</font>
        <strong>else</strong><font color="4444FF">:</font>
            <font color="#2040a0">request</font>.<font color="#2040a0">add_header</font><font color="4444FF">(</font><font color="#008000">&quot;Accept-encoding&quot;</font>, <font color="#008000">&quot;&quot;</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">auth</font><font color="4444FF">:</font>
            <font color="#2040a0">request</font>.<font color="#2040a0">add_header</font><font color="4444FF">(</font><font color="#008000">&quot;Authorization&quot;</font>, <font color="#008000">&quot;Basic %s&quot;</font> <font color="4444FF">%</font> <font color="#2040a0">auth</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">ACCEPT_HEADER</font><font color="4444FF">:</font>
            <font color="#2040a0">request</font>.<font color="#2040a0">add_header</font><font color="4444FF">(</font><font color="#008000">&quot;Accept&quot;</font>, <font color="#2040a0">ACCEPT_HEADER</font><font color="4444FF">)</font>
        <font color="#2040a0">opener</font> <font color="4444FF">=</font> <font color="#2040a0">apply</font><font color="4444FF">(</font><font color="#2040a0">urllib2</font>.<font color="#2040a0">build_opener</font>, <font color="#2040a0">tuple</font><font color="4444FF">(</font><font color="4444FF">[</font><font color="#2040a0">_FeedURLHandler</font><font color="4444FF">(</font><font color="4444FF">)</font><font color="4444FF">]</font> <font color="4444FF">+</font> <font color="#2040a0">handlers</font><font color="4444FF">)</font><font color="4444FF">)</font>
        <font color="#2040a0">opener</font>.<font color="#2040a0">addheaders</font> <font color="4444FF">=</font> <font color="4444FF">[</font><font color="4444FF">]</font> <font color="#444444"># RMK - must clear so we only send our custom User-Agent</font>
        <strong>try</strong><font color="4444FF">:</font>
            <strong>return</strong> <font color="#2040a0">opener</font>.<font color="#2040a0">open</font><font color="4444FF">(</font><font color="#2040a0">request</font><font color="4444FF">)</font>
        <strong>finally</strong><font color="4444FF">:</font>
            <font color="#2040a0">opener</font>.<font color="#2040a0">close</font><font color="4444FF">(</font><font color="4444FF">)</font> <font color="#444444"># JohnD</font>
    
    <font color="#444444"># try to open with native open function (if url_file_stream_or_string is a filename)</font>
    <strong>try</strong><font color="4444FF">:</font>
        <strong>return</strong> <font color="#2040a0">open</font><font color="4444FF">(</font><font color="#2040a0">url_file_stream_or_string</font><font color="4444FF">)</font>
    <strong>except</strong><font color="4444FF">:</font>
        <strong>pass</strong>

    <font color="#444444"># treat url_file_stream_or_string as string</font>
    <strong>return</strong> <font color="#2040a0">_StringIO</font><font color="4444FF">(</font><font color="#2040a0">str</font><font color="4444FF">(</font><font color="#2040a0">url_file_stream_or_string</font><font color="4444FF">)</font><font color="4444FF">)</font>

<font color="#2040a0">_date_handlers</font> <font color="4444FF">=</font> <font color="4444FF">[</font><font color="4444FF">]</font>
<font color="#2040a0">def</font> <font color="#2040a0">registerDateHandler</font><font color="4444FF">(</font><font color="#2040a0">func</font><font color="4444FF">)</font><font color="4444FF">:</font>
    <font color="#008000">&quot;&quot;</font><font color="#008000">&quot;Register a date handler function (takes string, returns 9-tuple date in GMT)&quot;</font><font color="#008000">&quot;&quot;</font>
    <font color="#2040a0">_date_handlers</font>.<font color="#2040a0">insert</font><font color="4444FF">(</font><font color="#FF0000">0</font>, <font color="#2040a0">func</font><font color="4444FF">)</font>
    
<font color="#444444"># ISO-8601 date parsing routines written by Fazal Majid.</font>
<font color="#444444"># The ISO 8601 standard is very convoluted and irregular - a full ISO 8601</font>
<font color="#444444"># parser is beyond the scope of feedparser and would be a worthwhile addition</font>
<font color="#444444"># to the Python library.</font>
<font color="#444444"># A single regular expression cannot parse ISO 8601 date formats into groups</font>
<font color="#444444"># as the standard is highly irregular (for instance is 030104 2003-01-04 or</font>
<font color="#444444"># 0301-04-01), so we use templates instead.</font>
<font color="#444444"># Please note the order in templates is significant because we need a</font>
<font color="#444444"># greedy match.</font>
<font color="#2040a0">_iso8601_tmpl</font> <font color="4444FF">=</font> <font color="4444FF">[</font><font color="#008000">'YYYY-?MM-?DD'</font>, <font color="#008000">'YYYY-MM'</font>, <font color="#008000">'YYYY-?OOO'</font>,
                <font color="#008000">'YY-?MM-?DD'</font>, <font color="#008000">'YY-?OOO'</font>, <font color="#008000">'YYYY'</font>, 
                <font color="#008000">'-YY-?MM'</font>, <font color="#008000">'-OOO'</font>, <font color="#008000">'-YY'</font>,
                <font color="#008000">'--MM-?DD'</font>, <font color="#008000">'--MM'</font>,
                <font color="#008000">'---DD'</font>,
                <font color="#008000">'CC'</font>, <font color="#008000">''</font><font color="4444FF">]</font>
<font color="#2040a0">_iso8601_re</font> <font color="4444FF">=</font> <font color="4444FF">[</font>
    <font color="#2040a0">tmpl</font>.<font color="#2040a0">replace</font><font color="4444FF">(</font>
    <font color="#008000">'YYYY'</font>, <font color="#2040a0">r</font><font color="#008000">'(?P&lt;year&gt;\d{4})'</font><font color="4444FF">)</font>.<font color="#2040a0">replace</font><font color="4444FF">(</font>
    <font color="#008000">'YY'</font>, <font color="#2040a0">r</font><font color="#008000">'(?P&lt;year&gt;\d\d)'</font><font color="4444FF">)</font>.<font color="#2040a0">replace</font><font color="4444FF">(</font>
    <font color="#008000">'MM'</font>, <font color="#2040a0">r</font><font color="#008000">'(?P&lt;month&gt;[01]\d)'</font><font color="4444FF">)</font>.<font color="#2040a0">replace</font><font color="4444FF">(</font>
    <font color="#008000">'DD'</font>, <font color="#2040a0">r</font><font color="#008000">'(?P&lt;day&gt;[0123]\d)'</font><font color="4444FF">)</font>.<font color="#2040a0">replace</font><font color="4444FF">(</font>
    <font color="#008000">'OOO'</font>, <font color="#2040a0">r</font><font color="#008000">'(?P&lt;ordinal&gt;[0123]\d\d)'</font><font color="4444FF">)</font>.<font color="#2040a0">replace</font><font color="4444FF">(</font>
    <font color="#008000">'CC'</font>, <font color="#2040a0">r</font><font color="#008000">'(?P&lt;century&gt;\d\d$)'</font><font color="4444FF">)</font>
    <font color="4444FF">+</font> <font color="#2040a0">r</font><font color="#008000">'(T?(?P&lt;hour&gt;\d{2}):(?P&lt;minute&gt;\d{2})'</font>
    <font color="4444FF">+</font> <font color="#2040a0">r</font><font color="#008000">'(:(?P&lt;second&gt;\d{2}))?'</font>
    <font color="4444FF">+</font> <font color="#2040a0">r</font><font color="#008000">'(?P&lt;tz&gt;[+-](?P&lt;tzhour&gt;\d{2})(:(?P&lt;tzmin&gt;\d{2}))?|Z)?)?'</font>
    <strong>for</strong> <font color="#2040a0">tmpl</font> <strong>in</strong> <font color="#2040a0">_iso8601_tmpl</font><font color="4444FF">]</font>
<strong>del</strong> <font color="#2040a0">tmpl</font>
<font color="#2040a0">_iso8601_matches</font> <font color="4444FF">=</font> <font color="4444FF">[</font><font color="#2040a0">re</font>.<font color="#2040a0">compile</font><font color="4444FF">(</font><font color="#2040a0">regex</font><font color="4444FF">)</font>.<font color="#2040a0">match</font> <strong>for</strong> <font color="#2040a0">regex</font> <strong>in</strong> <font color="#2040a0">_iso8601_re</font><font color="4444FF">]</font>
<strong>del</strong> <font color="#2040a0">regex</font>
<font color="#2040a0">def</font> <font color="#2040a0">_parse_date_iso8601</font><font color="4444FF">(</font><font color="#2040a0">dateString</font><font color="4444FF">)</font><font color="4444FF">:</font>
    <font color="#008000">&quot;&quot;</font><font color="#008000">&quot;Parse a variety of ISO-8601-compatible formats like 20040105&quot;</font><font color="#008000">&quot;&quot;</font>
    <font color="#2040a0">m</font> <font color="4444FF">=</font> <font color="#2040a0">None</font>
    <strong>for</strong> <font color="#2040a0">_iso8601_match</font> <strong>in</strong> <font color="#2040a0">_iso8601_matches</font><font color="4444FF">:</font>
        <font color="#2040a0">m</font> <font color="4444FF">=</font> <font color="#2040a0">_iso8601_match</font><font color="4444FF">(</font><font color="#2040a0">dateString</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">m</font><font color="4444FF">:</font> <strong>break</strong>
    <strong>if</strong> <strong>not</strong> <font color="#2040a0">m</font><font color="4444FF">:</font> <strong>return</strong>
    <strong>if</strong> <font color="#2040a0">m</font>.<font color="#2040a0">span</font><font color="4444FF">(</font><font color="4444FF">)</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="4444FF">(</font><font color="#FF0000">0</font>, <font color="#FF0000">0</font><font color="4444FF">)</font><font color="4444FF">:</font> <strong>return</strong>
    <font color="#2040a0">params</font> <font color="4444FF">=</font> <font color="#2040a0">m</font>.<font color="#2040a0">groupdict</font><font color="4444FF">(</font><font color="4444FF">)</font>
    <font color="#2040a0">ordinal</font> <font color="4444FF">=</font> <font color="#2040a0">params</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">&quot;ordinal&quot;</font>, <font color="#FF0000">0</font><font color="4444FF">)</font>
    <strong>if</strong> <font color="#2040a0">ordinal</font><font color="4444FF">:</font>
        <font color="#2040a0">ordinal</font> <font color="4444FF">=</font> <font color="#2040a0">int</font><font color="4444FF">(</font><font color="#2040a0">ordinal</font><font color="4444FF">)</font>
    <strong>else</strong><font color="4444FF">:</font>
        <font color="#2040a0">ordinal</font> <font color="4444FF">=</font> <font color="#FF0000">0</font>
    <font color="#2040a0">year</font> <font color="4444FF">=</font> <font color="#2040a0">params</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">&quot;year&quot;</font>, <font color="#008000">&quot;--&quot;</font><font color="4444FF">)</font>
    <strong>if</strong> <strong>not</strong> <font color="#2040a0">year</font> <strong>or</strong> <font color="#2040a0">year</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">&quot;--&quot;</font><font color="4444FF">:</font>
        <font color="#2040a0">year</font> <font color="4444FF">=</font> <font color="#2040a0">time</font>.<font color="#2040a0">gmtime</font><font color="4444FF">(</font><font color="4444FF">)</font><font color="4444FF">[</font><font color="#FF0000">0</font><font color="4444FF">]</font>
    <strong>elif</strong> <font color="#2040a0">len</font><font color="4444FF">(</font><font color="#2040a0">year</font><font color="4444FF">)</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#FF0000">2</font><font color="4444FF">:</font>
        <font color="#444444"># ISO 8601 assumes current century, i.e. 93 -&gt; 2093, NOT 1993</font>
        <font color="#2040a0">year</font> <font color="4444FF">=</font> <font color="#FF0000">100</font> <font color="4444FF">*</font> <font color="#2040a0">int</font><font color="4444FF">(</font><font color="#2040a0">time</font>.<font color="#2040a0">gmtime</font><font color="4444FF">(</font><font color="4444FF">)</font><font color="4444FF">[</font><font color="#FF0000">0</font><font color="4444FF">]</font> / <font color="#FF0000">100</font><font color="4444FF">)</font> <font color="4444FF">+</font> <font color="#2040a0">int</font><font color="4444FF">(</font><font color="#2040a0">year</font><font color="4444FF">)</font>
    <strong>else</strong><font color="4444FF">:</font>
        <font color="#2040a0">year</font> <font color="4444FF">=</font> <font color="#2040a0">int</font><font color="4444FF">(</font><font color="#2040a0">year</font><font color="4444FF">)</font>
    <font color="#2040a0">month</font> <font color="4444FF">=</font> <font color="#2040a0">params</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">&quot;month&quot;</font>, <font color="#008000">&quot;-&quot;</font><font color="4444FF">)</font>
    <strong>if</strong> <strong>not</strong> <font color="#2040a0">month</font> <strong>or</strong> <font color="#2040a0">month</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">&quot;-&quot;</font><font color="4444FF">:</font>
        <font color="#444444"># ordinals are NOT normalized by mktime, we simulate them</font>
        <font color="#444444"># by setting month=1, day=ordinal</font>
        <strong>if</strong> <font color="#2040a0">ordinal</font><font color="4444FF">:</font>
            <font color="#2040a0">month</font> <font color="4444FF">=</font> <font color="#FF0000">1</font>
        <strong>else</strong><font color="4444FF">:</font>
            <font color="#2040a0">month</font> <font color="4444FF">=</font> <font color="#2040a0">time</font>.<font color="#2040a0">gmtime</font><font color="4444FF">(</font><font color="4444FF">)</font><font color="4444FF">[</font><font color="#FF0000">1</font><font color="4444FF">]</font>
    <font color="#2040a0">month</font> <font color="4444FF">=</font> <font color="#2040a0">int</font><font color="4444FF">(</font><font color="#2040a0">month</font><font color="4444FF">)</font>
    <font color="#2040a0">day</font> <font color="4444FF">=</font> <font color="#2040a0">params</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">&quot;day&quot;</font>, <font color="#FF0000">0</font><font color="4444FF">)</font>
    <strong>if</strong> <strong>not</strong> <font color="#2040a0">day</font><font color="4444FF">:</font>
        <font color="#444444"># see above</font>
        <strong>if</strong> <font color="#2040a0">ordinal</font><font color="4444FF">:</font>
            <font color="#2040a0">day</font> <font color="4444FF">=</font> <font color="#2040a0">ordinal</font>
        <strong>elif</strong> <font color="#2040a0">params</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">&quot;century&quot;</font>, <font color="#FF0000">0</font><font color="4444FF">)</font> <strong>or</strong> \
                 <font color="#2040a0">params</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">&quot;year&quot;</font>, <font color="#FF0000">0</font><font color="4444FF">)</font> <strong>or</strong> <font color="#2040a0">params</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">&quot;month&quot;</font>, <font color="#FF0000">0</font><font color="4444FF">)</font><font color="4444FF">:</font>
            <font color="#2040a0">day</font> <font color="4444FF">=</font> <font color="#FF0000">1</font>
        <strong>else</strong><font color="4444FF">:</font>
            <font color="#2040a0">day</font> <font color="4444FF">=</font> <font color="#2040a0">time</font>.<font color="#2040a0">gmtime</font><font color="4444FF">(</font><font color="4444FF">)</font><font color="4444FF">[</font><font color="#FF0000">2</font><font color="4444FF">]</font>
    <strong>else</strong><font color="4444FF">:</font>
        <font color="#2040a0">day</font> <font color="4444FF">=</font> <font color="#2040a0">int</font><font color="4444FF">(</font><font color="#2040a0">day</font><font color="4444FF">)</font>
    <font color="#444444"># special case of the century - is the first year of the 21st century</font>
    <font color="#444444"># 2000 or 2001 ? The debate goes on...</font>
    <strong>if</strong> <font color="#008000">&quot;century&quot;</font> <strong>in</strong> <font color="#2040a0">params</font>.<font color="#2040a0">keys</font><font color="4444FF">(</font><font color="4444FF">)</font><font color="4444FF">:</font>
        <font color="#2040a0">year</font> <font color="4444FF">=</font> <font color="4444FF">(</font><font color="#2040a0">int</font><font color="4444FF">(</font><font color="#2040a0">params</font><font color="4444FF">[</font><font color="#008000">&quot;century&quot;</font><font color="4444FF">]</font><font color="4444FF">)</font> <font color="4444FF">-</font> <font color="#FF0000">1</font><font color="4444FF">)</font> <font color="4444FF">*</font> <font color="#FF0000">100</font> <font color="4444FF">+</font> <font color="#FF0000">1</font>
    <font color="#444444"># in ISO 8601 most fields are optional</font>
    <strong>for</strong> <font color="#2040a0">field</font> <strong>in</strong> <font color="4444FF">[</font><font color="#008000">&quot;hour&quot;</font>, <font color="#008000">&quot;minute&quot;</font>, <font color="#008000">&quot;second&quot;</font>, <font color="#008000">&quot;tzhour&quot;</font>, <font color="#008000">&quot;tzmin&quot;</font><font color="4444FF">]</font><font color="4444FF">:</font>
        <strong>if</strong> <strong>not</strong> <font color="#2040a0">params</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#2040a0">field</font>, <font color="#2040a0">None</font><font color="4444FF">)</font><font color="4444FF">:</font>
            <font color="#2040a0">params</font><font color="4444FF">[</font><font color="#2040a0">field</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#FF0000">0</font>
    <font color="#2040a0">hour</font> <font color="4444FF">=</font> <font color="#2040a0">int</font><font color="4444FF">(</font><font color="#2040a0">params</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">&quot;hour&quot;</font>, <font color="#FF0000">0</font><font color="4444FF">)</font><font color="4444FF">)</font>
    <font color="#2040a0">minute</font> <font color="4444FF">=</font> <font color="#2040a0">int</font><font color="4444FF">(</font><font color="#2040a0">params</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">&quot;minute&quot;</font>, <font color="#FF0000">0</font><font color="4444FF">)</font><font color="4444FF">)</font>
    <font color="#2040a0">second</font> <font color="4444FF">=</font> <font color="#2040a0">int</font><font color="4444FF">(</font><font color="#2040a0">params</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">&quot;second&quot;</font>, <font color="#FF0000">0</font><font color="4444FF">)</font><font color="4444FF">)</font>
    <font color="#444444"># weekday is normalized by mktime(), we can ignore it</font>
    <font color="#2040a0">weekday</font> <font color="4444FF">=</font> <font color="#FF0000">0</font>
    <font color="#444444"># daylight savings is complex, but not needed for feedparser's purposes</font>
    <font color="#444444"># as time zones, if specified, include mention of whether it is active</font>
    <font color="#444444"># (e.g. PST vs. PDT, CET). Using -1 is implementation-dependent and</font>
    <font color="#444444"># and most implementations have DST bugs</font>
    <font color="#2040a0">daylight_savings_flag</font> <font color="4444FF">=</font> <font color="#FF0000">0</font>
    <font color="#2040a0">tm</font> <font color="4444FF">=</font> <font color="4444FF">[</font><font color="#2040a0">year</font>, <font color="#2040a0">month</font>, <font color="#2040a0">day</font>, <font color="#2040a0">hour</font>, <font color="#2040a0">minute</font>, <font color="#2040a0">second</font>, <font color="#2040a0">weekday</font>,
          <font color="#2040a0">ordinal</font>, <font color="#2040a0">daylight_savings_flag</font><font color="4444FF">]</font>
    <font color="#444444"># ISO 8601 time zone adjustments</font>
    <font color="#2040a0">tz</font> <font color="4444FF">=</font> <font color="#2040a0">params</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">&quot;tz&quot;</font><font color="4444FF">)</font>
    <strong>if</strong> <font color="#2040a0">tz</font> <strong>and</strong> <font color="#2040a0">tz</font> <font color="4444FF">!</font><font color="4444FF">=</font> <font color="#008000">&quot;Z&quot;</font><font color="4444FF">:</font>
        <strong>if</strong> <font color="#2040a0">tz</font><font color="4444FF">[</font><font color="#FF0000">0</font><font color="4444FF">]</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">&quot;-&quot;</font><font color="4444FF">:</font>
            <font color="#2040a0">tm</font><font color="4444FF">[</font><font color="#FF0000">3</font><font color="4444FF">]</font> <font color="4444FF">+</font><font color="4444FF">=</font> <font color="#2040a0">int</font><font color="4444FF">(</font><font color="#2040a0">params</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">&quot;tzhour&quot;</font>, <font color="#FF0000">0</font><font color="4444FF">)</font><font color="4444FF">)</font>
            <font color="#2040a0">tm</font><font color="4444FF">[</font><font color="#FF0000">4</font><font color="4444FF">]</font> <font color="4444FF">+</font><font color="4444FF">=</font> <font color="#2040a0">int</font><font color="4444FF">(</font><font color="#2040a0">params</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">&quot;tzmin&quot;</font>, <font color="#FF0000">0</font><font color="4444FF">)</font><font color="4444FF">)</font>
        <strong>elif</strong> <font color="#2040a0">tz</font><font color="4444FF">[</font><font color="#FF0000">0</font><font color="4444FF">]</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">&quot;+&quot;</font><font color="4444FF">:</font>
            <font color="#2040a0">tm</font><font color="4444FF">[</font><font color="#FF0000">3</font><font color="4444FF">]</font> <font color="4444FF">-</font><font color="4444FF">=</font> <font color="#2040a0">int</font><font color="4444FF">(</font><font color="#2040a0">params</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">&quot;tzhour&quot;</font>, <font color="#FF0000">0</font><font color="4444FF">)</font><font color="4444FF">)</font>
            <font color="#2040a0">tm</font><font color="4444FF">[</font><font color="#FF0000">4</font><font color="4444FF">]</font> <font color="4444FF">-</font><font color="4444FF">=</font> <font color="#2040a0">int</font><font color="4444FF">(</font><font color="#2040a0">params</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">&quot;tzmin&quot;</font>, <font color="#FF0000">0</font><font color="4444FF">)</font><font color="4444FF">)</font>
        <strong>else</strong><font color="4444FF">:</font>
            <strong>return</strong> <font color="#2040a0">None</font>
    <font color="#444444"># Python's time.mktime() is a wrapper around the ANSI C mktime(3c)</font>
    <font color="#444444"># which is guaranteed to normalize d/m/y/h/m/s.</font>
    <font color="#444444"># Many implementations have bugs, but we'll pretend they don't.</font>
    <strong>return</strong> <font color="#2040a0">time</font>.<font color="#2040a0">localtime</font><font color="4444FF">(</font><font color="#2040a0">time</font>.<font color="#2040a0">mktime</font><font color="4444FF">(</font><font color="#2040a0">tm</font><font color="4444FF">)</font><font color="4444FF">)</font>
<font color="#2040a0">registerDateHandler</font><font color="4444FF">(</font><font color="#2040a0">_parse_date_iso8601</font><font color="4444FF">)</font>
    
<font color="#444444"># 8-bit date handling routines written by ytrewq1.</font>
<font color="#2040a0">_korean_year</font>  <font color="4444FF">=</font> <font color="#2040a0">u</font><font color="#008000">'\ub144'</font> <font color="#444444"># b3e2 in euc-kr</font>
<font color="#2040a0">_korean_month</font> <font color="4444FF">=</font> <font color="#2040a0">u</font><font color="#008000">'\uc6d4'</font> <font color="#444444"># bff9 in euc-kr</font>
<font color="#2040a0">_korean_day</font>   <font color="4444FF">=</font> <font color="#2040a0">u</font><font color="#008000">'\uc77c'</font> <font color="#444444"># c0cf in euc-kr</font>
<font color="#2040a0">_korean_am</font>    <font color="4444FF">=</font> <font color="#2040a0">u</font><font color="#008000">'\uc624\uc804'</font> <font color="#444444"># bfc0 c0fc in euc-kr</font>
<font color="#2040a0">_korean_pm</font>    <font color="4444FF">=</font> <font color="#2040a0">u</font><font color="#008000">'\uc624\ud6c4'</font> <font color="#444444"># bfc0 c8c4 in euc-kr</font>

<font color="#2040a0">_korean_onblog_date_re</font> <font color="4444FF">=</font> \
    <font color="#2040a0">re</font>.<font color="#2040a0">compile</font><font color="4444FF">(</font><font color="#008000">'(\d{4})%s\s+(\d{2})%s\s+(\d{2})%s\s+(\d{2}):(\d{2}):(\d{2})'</font> <font color="4444FF">%</font> \
               <font color="4444FF">(</font><font color="#2040a0">_korean_year</font>, <font color="#2040a0">_korean_month</font>, <font color="#2040a0">_korean_day</font><font color="4444FF">)</font><font color="4444FF">)</font>
<font color="#2040a0">_korean_nate_date_re</font> <font color="4444FF">=</font> \
    <font color="#2040a0">re</font>.<font color="#2040a0">compile</font><font color="4444FF">(</font><font color="#2040a0">u</font><font color="#008000">'(\d{4})-(\d{2})-(\d{2})\s+(%s|%s)\s+(\d{,2}):(\d{,2}):(\d{,2})'</font> <font color="4444FF">%</font> \
               <font color="4444FF">(</font><font color="#2040a0">_korean_am</font>, <font color="#2040a0">_korean_pm</font><font color="4444FF">)</font><font color="4444FF">)</font>
<font color="#2040a0">def</font> <font color="#2040a0">_parse_date_onblog</font><font color="4444FF">(</font><font color="#2040a0">dateString</font><font color="4444FF">)</font><font color="4444FF">:</font>
    <font color="#008000">&quot;&quot;</font><font color="#008000">&quot;Parse a string according to the OnBlog 8-bit date format&quot;</font><font color="#008000">&quot;&quot;</font>
    <font color="#2040a0">m</font> <font color="4444FF">=</font> <font color="#2040a0">_korean_onblog_date_re</font>.<font color="#2040a0">match</font><font color="4444FF">(</font><font color="#2040a0">dateString</font><font color="4444FF">)</font>
    <strong>if</strong> <strong>not</strong> <font color="#2040a0">m</font><font color="4444FF">:</font> <strong>return</strong>
    <font color="#2040a0">w3dtfdate</font> <font color="4444FF">=</font> <font color="#008000">&quot;%(year)s-%(month)s-%(day)sT%(hour)s:%(minute)s:%(second)s%(zonediff)s&quot;</font> <font color="4444FF">%</font> \
                <font color="4444FF"><strong>{</strong></font><font color="#008000">'year'</font><font color="4444FF">:</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#FF0000">1</font><font color="4444FF">)</font>, <font color="#008000">'month'</font><font color="4444FF">:</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#FF0000">2</font><font color="4444FF">)</font>, <font color="#008000">'day'</font><font color="4444FF">:</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#FF0000">3</font><font color="4444FF">)</font>,\
                 <font color="#008000">'hour'</font><font color="4444FF">:</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#FF0000">4</font><font color="4444FF">)</font>, <font color="#008000">'minute'</font><font color="4444FF">:</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#FF0000">5</font><font color="4444FF">)</font>, <font color="#008000">'second'</font><font color="4444FF">:</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#FF0000">6</font><font color="4444FF">)</font>,\
                 <font color="#008000">'zonediff'</font><font color="4444FF">:</font> <font color="#008000">'+09:00'</font><font color="4444FF"><strong>}</strong></font>
    <strong>if</strong> <font color="#2040a0">_debug</font><font color="4444FF">:</font> <font color="#2040a0">sys</font>.<font color="#2040a0">stderr</font>.<font color="#2040a0">write</font><font color="4444FF">(</font><font color="#008000">&quot;OnBlog date parsed as: %s<font color="#77dd77">\n</font>&quot;</font> <font color="4444FF">%</font> <font color="#2040a0">w3dtfdate</font><font color="4444FF">)</font>
    <strong>return</strong> <font color="#2040a0">_parse_date_w3dtf</font><font color="4444FF">(</font><font color="#2040a0">w3dtfdate</font><font color="4444FF">)</font>
<font color="#2040a0">registerDateHandler</font><font color="4444FF">(</font><font color="#2040a0">_parse_date_onblog</font><font color="4444FF">)</font>

<font color="#2040a0">def</font> <font color="#2040a0">_parse_date_nate</font><font color="4444FF">(</font><font color="#2040a0">dateString</font><font color="4444FF">)</font><font color="4444FF">:</font>
    <font color="#008000">&quot;&quot;</font><font color="#008000">&quot;Parse a string according to the Nate 8-bit date format&quot;</font><font color="#008000">&quot;&quot;</font>
    <font color="#2040a0">m</font> <font color="4444FF">=</font> <font color="#2040a0">_korean_nate_date_re</font>.<font color="#2040a0">match</font><font color="4444FF">(</font><font color="#2040a0">dateString</font><font color="4444FF">)</font>
    <strong>if</strong> <strong>not</strong> <font color="#2040a0">m</font><font color="4444FF">:</font> <strong>return</strong>
    <font color="#2040a0">hour</font> <font color="4444FF">=</font> <font color="#2040a0">int</font><font color="4444FF">(</font><font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#FF0000">5</font><font color="4444FF">)</font><font color="4444FF">)</font>
    <font color="#2040a0">ampm</font> <font color="4444FF">=</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#FF0000">4</font><font color="4444FF">)</font>
    <strong>if</strong> <font color="4444FF">(</font><font color="#2040a0">ampm</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#2040a0">_korean_pm</font><font color="4444FF">)</font><font color="4444FF">:</font>
        <font color="#2040a0">hour</font> <font color="4444FF">+</font><font color="4444FF">=</font> <font color="#FF0000">12</font>
    <font color="#2040a0">hour</font> <font color="4444FF">=</font> <font color="#2040a0">str</font><font color="4444FF">(</font><font color="#2040a0">hour</font><font color="4444FF">)</font>
    <strong>if</strong> <font color="#2040a0">len</font><font color="4444FF">(</font><font color="#2040a0">hour</font><font color="4444FF">)</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#FF0000">1</font><font color="4444FF">:</font>
        <font color="#2040a0">hour</font> <font color="4444FF">=</font> <font color="#008000">'0'</font> <font color="4444FF">+</font> <font color="#2040a0">hour</font>
    <font color="#2040a0">w3dtfdate</font> <font color="4444FF">=</font> <font color="#008000">&quot;%(year)s-%(month)s-%(day)sT%(hour)s:%(minute)s:%(second)s%(zonediff)s&quot;</font> <font color="4444FF">%</font> \
                <font color="4444FF"><strong>{</strong></font><font color="#008000">'year'</font><font color="4444FF">:</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#FF0000">1</font><font color="4444FF">)</font>, <font color="#008000">'month'</font><font color="4444FF">:</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#FF0000">2</font><font color="4444FF">)</font>, <font color="#008000">'day'</font><font color="4444FF">:</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#FF0000">3</font><font color="4444FF">)</font>,\
                 <font color="#008000">'hour'</font><font color="4444FF">:</font> <font color="#2040a0">hour</font>, <font color="#008000">'minute'</font><font color="4444FF">:</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#FF0000">6</font><font color="4444FF">)</font>, <font color="#008000">'second'</font><font color="4444FF">:</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#FF0000">7</font><font color="4444FF">)</font>,\
                 <font color="#008000">'zonediff'</font><font color="4444FF">:</font> <font color="#008000">'+09:00'</font><font color="4444FF"><strong>}</strong></font>
    <strong>if</strong> <font color="#2040a0">_debug</font><font color="4444FF">:</font> <font color="#2040a0">sys</font>.<font color="#2040a0">stderr</font>.<font color="#2040a0">write</font><font color="4444FF">(</font><font color="#008000">&quot;Nate date parsed as: %s<font color="#77dd77">\n</font>&quot;</font> <font color="4444FF">%</font> <font color="#2040a0">w3dtfdate</font><font color="4444FF">)</font>
    <strong>return</strong> <font color="#2040a0">_parse_date_w3dtf</font><font color="4444FF">(</font><font color="#2040a0">w3dtfdate</font><font color="4444FF">)</font>
<font color="#2040a0">registerDateHandler</font><font color="4444FF">(</font><font color="#2040a0">_parse_date_nate</font><font color="4444FF">)</font>

<font color="#2040a0">_mssql_date_re</font> <font color="4444FF">=</font> \
    <font color="#2040a0">re</font>.<font color="#2040a0">compile</font><font color="4444FF">(</font><font color="#008000">'(\d{4})-(\d{2})-(\d{2})\s+(\d{2}):(\d{2}):(\d{2})\.\d+'</font><font color="4444FF">)</font>
<font color="#2040a0">def</font> <font color="#2040a0">_parse_date_mssql</font><font color="4444FF">(</font><font color="#2040a0">dateString</font><font color="4444FF">)</font><font color="4444FF">:</font>
    <font color="#008000">&quot;&quot;</font><font color="#008000">&quot;Parse a string according to the MS SQL date format&quot;</font><font color="#008000">&quot;&quot;</font>
    <font color="#2040a0">m</font> <font color="4444FF">=</font> <font color="#2040a0">_mssql_date_re</font>.<font color="#2040a0">match</font><font color="4444FF">(</font><font color="#2040a0">dateString</font><font color="4444FF">)</font>
    <strong>if</strong> <strong>not</strong> <font color="#2040a0">m</font><font color="4444FF">:</font> <strong>return</strong>
    <font color="#2040a0">w3dtfdate</font> <font color="4444FF">=</font> <font color="#008000">&quot;%(year)s-%(month)s-%(day)sT%(hour)s:%(minute)s:%(second)s%(zonediff)s&quot;</font> <font color="4444FF">%</font> \
                <font color="4444FF"><strong>{</strong></font><font color="#008000">'year'</font><font color="4444FF">:</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#FF0000">1</font><font color="4444FF">)</font>, <font color="#008000">'month'</font><font color="4444FF">:</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#FF0000">2</font><font color="4444FF">)</font>, <font color="#008000">'day'</font><font color="4444FF">:</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#FF0000">3</font><font color="4444FF">)</font>,\
                 <font color="#008000">'hour'</font><font color="4444FF">:</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#FF0000">4</font><font color="4444FF">)</font>, <font color="#008000">'minute'</font><font color="4444FF">:</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#FF0000">5</font><font color="4444FF">)</font>, <font color="#008000">'second'</font><font color="4444FF">:</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#FF0000">6</font><font color="4444FF">)</font>,\
                 <font color="#008000">'zonediff'</font><font color="4444FF">:</font> <font color="#008000">'+09:00'</font><font color="4444FF"><strong>}</strong></font>
    <strong>if</strong> <font color="#2040a0">_debug</font><font color="4444FF">:</font> <font color="#2040a0">sys</font>.<font color="#2040a0">stderr</font>.<font color="#2040a0">write</font><font color="4444FF">(</font><font color="#008000">&quot;MS SQL date parsed as: %s<font color="#77dd77">\n</font>&quot;</font> <font color="4444FF">%</font> <font color="#2040a0">w3dtfdate</font><font color="4444FF">)</font>
    <strong>return</strong> <font color="#2040a0">_parse_date_w3dtf</font><font color="4444FF">(</font><font color="#2040a0">w3dtfdate</font><font color="4444FF">)</font>
<font color="#2040a0">registerDateHandler</font><font color="4444FF">(</font><font color="#2040a0">_parse_date_mssql</font><font color="4444FF">)</font>

<font color="#444444"># Unicode strings for Greek date strings</font>
<font color="#2040a0">_greek_months</font> <font color="4444FF">=</font> \
  <font color="4444FF"><strong>{</strong></font> \
   <font color="#2040a0">u</font><font color="#008000">'\u0399\u03b1\u03bd'</font><font color="4444FF">:</font> <font color="#2040a0">u</font><font color="#008000">'Jan'</font>,       <font color="#444444"># c9e1ed in iso-8859-7</font>
   <font color="#2040a0">u</font><font color="#008000">'\u03a6\u03b5\u03b2'</font><font color="4444FF">:</font> <font color="#2040a0">u</font><font color="#008000">'Feb'</font>,       <font color="#444444"># d6e5e2 in iso-8859-7</font>
   <font color="#2040a0">u</font><font color="#008000">'\u039c\u03ac\u03ce'</font><font color="4444FF">:</font> <font color="#2040a0">u</font><font color="#008000">'Mar'</font>,       <font color="#444444"># ccdcfe in iso-8859-7</font>
   <font color="#2040a0">u</font><font color="#008000">'\u039c\u03b1\u03ce'</font><font color="4444FF">:</font> <font color="#2040a0">u</font><font color="#008000">'Mar'</font>,       <font color="#444444"># cce1fe in iso-8859-7</font>
   <font color="#2040a0">u</font><font color="#008000">'\u0391\u03c0\u03c1'</font><font color="4444FF">:</font> <font color="#2040a0">u</font><font color="#008000">'Apr'</font>,       <font color="#444444"># c1f0f1 in iso-8859-7</font>
   <font color="#2040a0">u</font><font color="#008000">'\u039c\u03ac\u03b9'</font><font color="4444FF">:</font> <font color="#2040a0">u</font><font color="#008000">'May'</font>,       <font color="#444444"># ccdce9 in iso-8859-7</font>
   <font color="#2040a0">u</font><font color="#008000">'\u039c\u03b1\u03ca'</font><font color="4444FF">:</font> <font color="#2040a0">u</font><font color="#008000">'May'</font>,       <font color="#444444"># cce1fa in iso-8859-7</font>
   <font color="#2040a0">u</font><font color="#008000">'\u039c\u03b1\u03b9'</font><font color="4444FF">:</font> <font color="#2040a0">u</font><font color="#008000">'May'</font>,       <font color="#444444"># cce1e9 in iso-8859-7</font>
   <font color="#2040a0">u</font><font color="#008000">'\u0399\u03bf\u03cd\u03bd'</font><font color="4444FF">:</font> <font color="#2040a0">u</font><font color="#008000">'Jun'</font>, <font color="#444444"># c9effded in iso-8859-7</font>
   <font color="#2040a0">u</font><font color="#008000">'\u0399\u03bf\u03bd'</font><font color="4444FF">:</font> <font color="#2040a0">u</font><font color="#008000">'Jun'</font>,       <font color="#444444"># c9efed in iso-8859-7</font>
   <font color="#2040a0">u</font><font color="#008000">'\u0399\u03bf\u03cd\u03bb'</font><font color="4444FF">:</font> <font color="#2040a0">u</font><font color="#008000">'Jul'</font>, <font color="#444444"># c9effdeb in iso-8859-7</font>
   <font color="#2040a0">u</font><font color="#008000">'\u0399\u03bf\u03bb'</font><font color="4444FF">:</font> <font color="#2040a0">u</font><font color="#008000">'Jul'</font>,       <font color="#444444"># c9f9eb in iso-8859-7</font>
   <font color="#2040a0">u</font><font color="#008000">'\u0391\u03cd\u03b3'</font><font color="4444FF">:</font> <font color="#2040a0">u</font><font color="#008000">'Aug'</font>,       <font color="#444444"># c1fde3 in iso-8859-7</font>
   <font color="#2040a0">u</font><font color="#008000">'\u0391\u03c5\u03b3'</font><font color="4444FF">:</font> <font color="#2040a0">u</font><font color="#008000">'Aug'</font>,       <font color="#444444"># c1f5e3 in iso-8859-7</font>
   <font color="#2040a0">u</font><font color="#008000">'\u03a3\u03b5\u03c0'</font><font color="4444FF">:</font> <font color="#2040a0">u</font><font color="#008000">'Sep'</font>,       <font color="#444444"># d3e5f0 in iso-8859-7</font>
   <font color="#2040a0">u</font><font color="#008000">'\u039f\u03ba\u03c4'</font><font color="4444FF">:</font> <font color="#2040a0">u</font><font color="#008000">'Oct'</font>,       <font color="#444444"># cfeaf4 in iso-8859-7</font>
   <font color="#2040a0">u</font><font color="#008000">'\u039d\u03bf\u03ad'</font><font color="4444FF">:</font> <font color="#2040a0">u</font><font color="#008000">'Nov'</font>,       <font color="#444444"># cdefdd in iso-8859-7</font>
   <font color="#2040a0">u</font><font color="#008000">'\u039d\u03bf\u03b5'</font><font color="4444FF">:</font> <font color="#2040a0">u</font><font color="#008000">'Nov'</font>,       <font color="#444444"># cdefe5 in iso-8859-7</font>
   <font color="#2040a0">u</font><font color="#008000">'\u0394\u03b5\u03ba'</font><font color="4444FF">:</font> <font color="#2040a0">u</font><font color="#008000">'Dec'</font>,       <font color="#444444"># c4e5ea in iso-8859-7</font>
  <font color="4444FF"><strong>}</strong></font>

<font color="#2040a0">_greek_wdays</font> <font color="4444FF">=</font> \
  <font color="4444FF"><strong>{</strong></font> \
   <font color="#2040a0">u</font><font color="#008000">'\u039a\u03c5\u03c1'</font><font color="4444FF">:</font> <font color="#2040a0">u</font><font color="#008000">'Sun'</font>, <font color="#444444"># caf5f1 in iso-8859-7</font>
   <font color="#2040a0">u</font><font color="#008000">'\u0394\u03b5\u03c5'</font><font color="4444FF">:</font> <font color="#2040a0">u</font><font color="#008000">'Mon'</font>, <font color="#444444"># c4e5f5 in iso-8859-7</font>
   <font color="#2040a0">u</font><font color="#008000">'\u03a4\u03c1\u03b9'</font><font color="4444FF">:</font> <font color="#2040a0">u</font><font color="#008000">'Tue'</font>, <font color="#444444"># d4f1e9 in iso-8859-7</font>
   <font color="#2040a0">u</font><font color="#008000">'\u03a4\u03b5\u03c4'</font><font color="4444FF">:</font> <font color="#2040a0">u</font><font color="#008000">'Wed'</font>, <font color="#444444"># d4e5f4 in iso-8859-7</font>
   <font color="#2040a0">u</font><font color="#008000">'\u03a0\u03b5\u03bc'</font><font color="4444FF">:</font> <font color="#2040a0">u</font><font color="#008000">'Thu'</font>, <font color="#444444"># d0e5ec in iso-8859-7</font>
   <font color="#2040a0">u</font><font color="#008000">'\u03a0\u03b1\u03c1'</font><font color="4444FF">:</font> <font color="#2040a0">u</font><font color="#008000">'Fri'</font>, <font color="#444444"># d0e1f1 in iso-8859-7</font>
   <font color="#2040a0">u</font><font color="#008000">'\u03a3\u03b1\u03b2'</font><font color="4444FF">:</font> <font color="#2040a0">u</font><font color="#008000">'Sat'</font>, <font color="#444444"># d3e1e2 in iso-8859-7   </font>
  <font color="4444FF"><strong>}</strong></font>

<font color="#2040a0">_greek_date_format_re</font> <font color="4444FF">=</font> \
    <font color="#2040a0">re</font>.<font color="#2040a0">compile</font><font color="4444FF">(</font><font color="#2040a0">u</font><font color="#008000">'([^,]+),\s+(\d{2})\s+([^\s]+)\s+(\d{4})\s+(\d{2}):(\d{2}):(\d{2})\s+([^\s]+)'</font><font color="4444FF">)</font>

<font color="#2040a0">def</font> <font color="#2040a0">_parse_date_greek</font><font color="4444FF">(</font><font color="#2040a0">dateString</font><font color="4444FF">)</font><font color="4444FF">:</font>
    <font color="#008000">&quot;&quot;</font><font color="#008000">&quot;Parse a string according to a Greek 8-bit date format.&quot;</font><font color="#008000">&quot;&quot;</font>
    <font color="#2040a0">m</font> <font color="4444FF">=</font> <font color="#2040a0">_greek_date_format_re</font>.<font color="#2040a0">match</font><font color="4444FF">(</font><font color="#2040a0">dateString</font><font color="4444FF">)</font>
    <strong>if</strong> <strong>not</strong> <font color="#2040a0">m</font><font color="4444FF">:</font> <strong>return</strong>
    <strong>try</strong><font color="4444FF">:</font>
        <font color="#2040a0">wday</font> <font color="4444FF">=</font> <font color="#2040a0">_greek_wdays</font><font color="4444FF">[</font><font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#FF0000">1</font><font color="4444FF">)</font><font color="4444FF">]</font>
        <font color="#2040a0">month</font> <font color="4444FF">=</font> <font color="#2040a0">_greek_months</font><font color="4444FF">[</font><font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#FF0000">3</font><font color="4444FF">)</font><font color="4444FF">]</font>
    <strong>except</strong><font color="4444FF">:</font>
        <strong>return</strong>
    <font color="#2040a0">rfc822date</font> <font color="4444FF">=</font> <font color="#008000">&quot;%(wday)s, %(day)s %(month)s %(year)s %(hour)s:%(minute)s:%(second)s %(zonediff)s&quot;</font> <font color="4444FF">%</font> \
                 <font color="4444FF"><strong>{</strong></font><font color="#008000">'wday'</font><font color="4444FF">:</font> <font color="#2040a0">wday</font>, <font color="#008000">'day'</font><font color="4444FF">:</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#FF0000">2</font><font color="4444FF">)</font>, <font color="#008000">'month'</font><font color="4444FF">:</font> <font color="#2040a0">month</font>, <font color="#008000">'year'</font><font color="4444FF">:</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#FF0000">4</font><font color="4444FF">)</font>,\
                  <font color="#008000">'hour'</font><font color="4444FF">:</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#FF0000">5</font><font color="4444FF">)</font>, <font color="#008000">'minute'</font><font color="4444FF">:</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#FF0000">6</font><font color="4444FF">)</font>, <font color="#008000">'second'</font><font color="4444FF">:</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#FF0000">7</font><font color="4444FF">)</font>,\
                  <font color="#008000">'zonediff'</font><font color="4444FF">:</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#FF0000">8</font><font color="4444FF">)</font><font color="4444FF"><strong>}</strong></font>
    <strong>if</strong> <font color="#2040a0">_debug</font><font color="4444FF">:</font> <font color="#2040a0">sys</font>.<font color="#2040a0">stderr</font>.<font color="#2040a0">write</font><font color="4444FF">(</font><font color="#008000">&quot;Greek date parsed as: %s<font color="#77dd77">\n</font>&quot;</font> <font color="4444FF">%</font> <font color="#2040a0">rfc822date</font><font color="4444FF">)</font>
    <strong>return</strong> <font color="#2040a0">_parse_date_rfc822</font><font color="4444FF">(</font><font color="#2040a0">rfc822date</font><font color="4444FF">)</font>
<font color="#2040a0">registerDateHandler</font><font color="4444FF">(</font><font color="#2040a0">_parse_date_greek</font><font color="4444FF">)</font>

<font color="#444444"># Unicode strings for Hungarian date strings</font>
<font color="#2040a0">_hungarian_months</font> <font color="4444FF">=</font> \
  <font color="4444FF"><strong>{</strong></font> \
    <font color="#2040a0">u</font><font color="#008000">'janu\u00e1r'</font><font color="4444FF">:</font>   <font color="#2040a0">u</font><font color="#008000">'01'</font>,  <font color="#444444"># e1 in iso-8859-2</font>
    <font color="#2040a0">u</font><font color="#008000">'febru\u00e1ri'</font><font color="4444FF">:</font> <font color="#2040a0">u</font><font color="#008000">'02'</font>,  <font color="#444444"># e1 in iso-8859-2</font>
    <font color="#2040a0">u</font><font color="#008000">'m\u00e1rcius'</font><font color="4444FF">:</font>  <font color="#2040a0">u</font><font color="#008000">'03'</font>,  <font color="#444444"># e1 in iso-8859-2</font>
    <font color="#2040a0">u</font><font color="#008000">'\u00e1prilis'</font><font color="4444FF">:</font>  <font color="#2040a0">u</font><font color="#008000">'04'</font>,  <font color="#444444"># e1 in iso-8859-2</font>
    <font color="#2040a0">u</font><font color="#008000">'m\u00e1ujus'</font><font color="4444FF">:</font>   <font color="#2040a0">u</font><font color="#008000">'05'</font>,  <font color="#444444"># e1 in iso-8859-2</font>
    <font color="#2040a0">u</font><font color="#008000">'j\u00fanius'</font><font color="4444FF">:</font>   <font color="#2040a0">u</font><font color="#008000">'06'</font>,  <font color="#444444"># fa in iso-8859-2</font>
    <font color="#2040a0">u</font><font color="#008000">'j\u00falius'</font><font color="4444FF">:</font>   <font color="#2040a0">u</font><font color="#008000">'07'</font>,  <font color="#444444"># fa in iso-8859-2</font>
    <font color="#2040a0">u</font><font color="#008000">'augusztus'</font><font color="4444FF">:</font>     <font color="#2040a0">u</font><font color="#008000">'08'</font>,
    <font color="#2040a0">u</font><font color="#008000">'szeptember'</font><font color="4444FF">:</font>    <font color="#2040a0">u</font><font color="#008000">'09'</font>,
    <font color="#2040a0">u</font><font color="#008000">'okt\u00f3ber'</font><font color="4444FF">:</font>  <font color="#2040a0">u</font><font color="#008000">'10'</font>,  <font color="#444444"># f3 in iso-8859-2</font>
    <font color="#2040a0">u</font><font color="#008000">'november'</font><font color="4444FF">:</font>      <font color="#2040a0">u</font><font color="#008000">'11'</font>,
    <font color="#2040a0">u</font><font color="#008000">'december'</font><font color="4444FF">:</font>      <font color="#2040a0">u</font><font color="#008000">'12'</font>,
  <font color="4444FF"><strong>}</strong></font>

<font color="#2040a0">_hungarian_date_format_re</font> <font color="4444FF">=</font> \
  <font color="#2040a0">re</font>.<font color="#2040a0">compile</font><font color="4444FF">(</font><font color="#2040a0">u</font><font color="#008000">'(\d{4})-([^-]+)-(\d{,2})T(\d{,2}):(\d{2})((\+|-)(\d{,2}:\d{2}))'</font><font color="4444FF">)</font>

<font color="#2040a0">def</font> <font color="#2040a0">_parse_date_hungarian</font><font color="4444FF">(</font><font color="#2040a0">dateString</font><font color="4444FF">)</font><font color="4444FF">:</font>
    <font color="#008000">&quot;&quot;</font><font color="#008000">&quot;Parse a string according to a Hungarian 8-bit date format.&quot;</font><font color="#008000">&quot;&quot;</font>
    <font color="#2040a0">m</font> <font color="4444FF">=</font> <font color="#2040a0">_hungarian_date_format_re</font>.<font color="#2040a0">match</font><font color="4444FF">(</font><font color="#2040a0">dateString</font><font color="4444FF">)</font>
    <strong>if</strong> <strong>not</strong> <font color="#2040a0">m</font><font color="4444FF">:</font> <strong>return</strong>
    <strong>try</strong><font color="4444FF">:</font>
        <font color="#2040a0">month</font> <font color="4444FF">=</font> <font color="#2040a0">_hungarian_months</font><font color="4444FF">[</font><font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#FF0000">2</font><font color="4444FF">)</font><font color="4444FF">]</font>
        <font color="#2040a0">day</font> <font color="4444FF">=</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#FF0000">3</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">len</font><font color="4444FF">(</font><font color="#2040a0">day</font><font color="4444FF">)</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#FF0000">1</font><font color="4444FF">:</font>
            <font color="#2040a0">day</font> <font color="4444FF">=</font> <font color="#008000">'0'</font> <font color="4444FF">+</font> <font color="#2040a0">day</font>
        <font color="#2040a0">hour</font> <font color="4444FF">=</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#FF0000">4</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">len</font><font color="4444FF">(</font><font color="#2040a0">hour</font><font color="4444FF">)</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#FF0000">1</font><font color="4444FF">:</font>
            <font color="#2040a0">hour</font> <font color="4444FF">=</font> <font color="#008000">'0'</font> <font color="4444FF">+</font> <font color="#2040a0">hour</font>
    <strong>except</strong><font color="4444FF">:</font>
        <strong>return</strong>
    <font color="#2040a0">w3dtfdate</font> <font color="4444FF">=</font> <font color="#008000">&quot;%(year)s-%(month)s-%(day)sT%(hour)s:%(minute)s%(zonediff)s&quot;</font> <font color="4444FF">%</font> \
                <font color="4444FF"><strong>{</strong></font><font color="#008000">'year'</font><font color="4444FF">:</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#FF0000">1</font><font color="4444FF">)</font>, <font color="#008000">'month'</font><font color="4444FF">:</font> <font color="#2040a0">month</font>, <font color="#008000">'day'</font><font color="4444FF">:</font> <font color="#2040a0">day</font>,\
                 <font color="#008000">'hour'</font><font color="4444FF">:</font> <font color="#2040a0">hour</font>, <font color="#008000">'minute'</font><font color="4444FF">:</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#FF0000">5</font><font color="4444FF">)</font>,\
                 <font color="#008000">'zonediff'</font><font color="4444FF">:</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#FF0000">6</font><font color="4444FF">)</font><font color="4444FF"><strong>}</strong></font>
    <strong>if</strong> <font color="#2040a0">_debug</font><font color="4444FF">:</font> <font color="#2040a0">sys</font>.<font color="#2040a0">stderr</font>.<font color="#2040a0">write</font><font color="4444FF">(</font><font color="#008000">&quot;Hungarian date parsed as: %s<font color="#77dd77">\n</font>&quot;</font> <font color="4444FF">%</font> <font color="#2040a0">w3dtfdate</font><font color="4444FF">)</font>
    <strong>return</strong> <font color="#2040a0">_parse_date_w3dtf</font><font color="4444FF">(</font><font color="#2040a0">w3dtfdate</font><font color="4444FF">)</font>
<font color="#2040a0">registerDateHandler</font><font color="4444FF">(</font><font color="#2040a0">_parse_date_hungarian</font><font color="4444FF">)</font>

<font color="#444444"># W3DTF-style date parsing adapted from PyXML xml.utils.iso8601, written by</font>
<font color="#444444"># Drake and licensed under the Python license.  Removed all range checking</font>
<font color="#444444"># for month, day, hour, minute, and second, since mktime will normalize</font>
<font color="#444444"># these later</font>
<font color="#2040a0">def</font> <font color="#2040a0">_parse_date_w3dtf</font><font color="4444FF">(</font><font color="#2040a0">dateString</font><font color="4444FF">)</font><font color="4444FF">:</font>
<strong>   <font color="ff0000"> def</font><font color="ff0000"> __extract_date</font><font color="2040a0">(m)</font>:
</strong>        <font color="#2040a0">year</font> <font color="4444FF">=</font> <font color="#2040a0">int</font><font color="4444FF">(</font><font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#008000">&quot;year&quot;</font><font color="4444FF">)</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">year</font> <font color="4444FF">&lt;</font> <font color="#FF0000">100</font><font color="4444FF">:</font>
            <font color="#2040a0">year</font> <font color="4444FF">=</font> <font color="#FF0000">100</font> <font color="4444FF">*</font> <font color="#2040a0">int</font><font color="4444FF">(</font><font color="#2040a0">time</font>.<font color="#2040a0">gmtime</font><font color="4444FF">(</font><font color="4444FF">)</font><font color="4444FF">[</font><font color="#FF0000">0</font><font color="4444FF">]</font> / <font color="#FF0000">100</font><font color="4444FF">)</font> <font color="4444FF">+</font> <font color="#2040a0">int</font><font color="4444FF">(</font><font color="#2040a0">year</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">year</font> <font color="4444FF">&lt;</font> <font color="#FF0000">1000</font><font color="4444FF">:</font>
            <strong>return</strong> <font color="#FF0000">0</font>, <font color="#FF0000">0</font>, <font color="#FF0000">0</font>
        <font color="#2040a0">julian</font> <font color="4444FF">=</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#008000">&quot;julian&quot;</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">julian</font><font color="4444FF">:</font>
            <font color="#2040a0">julian</font> <font color="4444FF">=</font> <font color="#2040a0">int</font><font color="4444FF">(</font><font color="#2040a0">julian</font><font color="4444FF">)</font>
            <font color="#2040a0">month</font> <font color="4444FF">=</font> <font color="#2040a0">julian</font> / <font color="#FF0000">30</font> <font color="4444FF">+</font> <font color="#FF0000">1</font>
            <font color="#2040a0">day</font> <font color="4444FF">=</font> <font color="#2040a0">julian</font> <font color="4444FF">%</font> <font color="#FF0000">30</font> <font color="4444FF">+</font> <font color="#FF0000">1</font>
            <font color="#2040a0">jday</font> <font color="4444FF">=</font> <font color="#2040a0">None</font>
            <strong>while</strong> <font color="#2040a0">jday</font> <font color="4444FF">!</font><font color="4444FF">=</font> <font color="#2040a0">julian</font><font color="4444FF">:</font>
                <font color="#2040a0">t</font> <font color="4444FF">=</font> <font color="#2040a0">time</font>.<font color="#2040a0">mktime</font><font color="4444FF">(</font><font color="4444FF">(</font><font color="#2040a0">year</font>, <font color="#2040a0">month</font>, <font color="#2040a0">day</font>, <font color="#FF0000">0</font>, <font color="#FF0000">0</font>, <font color="#FF0000">0</font>, <font color="#FF0000">0</font>, <font color="#FF0000">0</font>, <font color="#FF0000">0</font><font color="4444FF">)</font><font color="4444FF">)</font>
                <font color="#2040a0">jday</font> <font color="4444FF">=</font> <font color="#2040a0">time</font>.<font color="#2040a0">gmtime</font><font color="4444FF">(</font><font color="#2040a0">t</font><font color="4444FF">)</font><font color="4444FF">[</font><font color="4444FF">-</font><font color="#FF0000">2</font><font color="4444FF">]</font>
                <font color="#2040a0">diff</font> <font color="4444FF">=</font> <font color="#2040a0">abs</font><font color="4444FF">(</font><font color="#2040a0">jday</font> <font color="4444FF">-</font> <font color="#2040a0">julian</font><font color="4444FF">)</font>
                <strong>if</strong> <font color="#2040a0">jday</font> <font color="4444FF">&gt;</font> <font color="#2040a0">julian</font><font color="4444FF">:</font>
                    <strong>if</strong> <font color="#2040a0">diff</font> <font color="4444FF">&lt;</font> <font color="#2040a0">day</font><font color="4444FF">:</font>
                        <font color="#2040a0">day</font> <font color="4444FF">=</font> <font color="#2040a0">day</font> <font color="4444FF">-</font> <font color="#2040a0">diff</font>
                    <strong>else</strong><font color="4444FF">:</font>
                        <font color="#2040a0">month</font> <font color="4444FF">=</font> <font color="#2040a0">month</font> <font color="4444FF">-</font> <font color="#FF0000">1</font>
                        <font color="#2040a0">day</font> <font color="4444FF">=</font> <font color="#FF0000">31</font>
                <strong>elif</strong> <font color="#2040a0">jday</font> <font color="4444FF">&lt;</font> <font color="#2040a0">julian</font><font color="4444FF">:</font>
                    <strong>if</strong> <font color="#2040a0">day</font> <font color="4444FF">+</font> <font color="#2040a0">diff</font> <font color="4444FF">&lt;</font> <font color="#FF0000">28</font><font color="4444FF">:</font>
                       <font color="#2040a0">day</font> <font color="4444FF">=</font> <font color="#2040a0">day</font> <font color="4444FF">+</font> <font color="#2040a0">diff</font>
                    <strong>else</strong><font color="4444FF">:</font>
                        <font color="#2040a0">month</font> <font color="4444FF">=</font> <font color="#2040a0">month</font> <font color="4444FF">+</font> <font color="#FF0000">1</font>
            <strong>return</strong> <font color="#2040a0">year</font>, <font color="#2040a0">month</font>, <font color="#2040a0">day</font>
        <font color="#2040a0">month</font> <font color="4444FF">=</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#008000">&quot;month&quot;</font><font color="4444FF">)</font>
        <font color="#2040a0">day</font> <font color="4444FF">=</font> <font color="#FF0000">1</font>
        <strong>if</strong> <font color="#2040a0">month</font> <strong>is</strong> <font color="#2040a0">None</font><font color="4444FF">:</font>
            <font color="#2040a0">month</font> <font color="4444FF">=</font> <font color="#FF0000">1</font>
        <strong>else</strong><font color="4444FF">:</font>
            <font color="#2040a0">month</font> <font color="4444FF">=</font> <font color="#2040a0">int</font><font color="4444FF">(</font><font color="#2040a0">month</font><font color="4444FF">)</font>
            <font color="#2040a0">day</font> <font color="4444FF">=</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#008000">&quot;day&quot;</font><font color="4444FF">)</font>
            <strong>if</strong> <font color="#2040a0">day</font><font color="4444FF">:</font>
                <font color="#2040a0">day</font> <font color="4444FF">=</font> <font color="#2040a0">int</font><font color="4444FF">(</font><font color="#2040a0">day</font><font color="4444FF">)</font>
            <strong>else</strong><font color="4444FF">:</font>
                <font color="#2040a0">day</font> <font color="4444FF">=</font> <font color="#FF0000">1</font>
        <strong>return</strong> <font color="#2040a0">year</font>, <font color="#2040a0">month</font>, <font color="#2040a0">day</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> __extract_time</font><font color="2040a0">(m)</font>:
</strong>        <strong>if</strong> <strong>not</strong> <font color="#2040a0">m</font><font color="4444FF">:</font>
            <strong>return</strong> <font color="#FF0000">0</font>, <font color="#FF0000">0</font>, <font color="#FF0000">0</font>
        <font color="#2040a0">hours</font> <font color="4444FF">=</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#008000">&quot;hours&quot;</font><font color="4444FF">)</font>
        <strong>if</strong> <strong>not</strong> <font color="#2040a0">hours</font><font color="4444FF">:</font>
            <strong>return</strong> <font color="#FF0000">0</font>, <font color="#FF0000">0</font>, <font color="#FF0000">0</font>
        <font color="#2040a0">hours</font> <font color="4444FF">=</font> <font color="#2040a0">int</font><font color="4444FF">(</font><font color="#2040a0">hours</font><font color="4444FF">)</font>
        <font color="#2040a0">minutes</font> <font color="4444FF">=</font> <font color="#2040a0">int</font><font color="4444FF">(</font><font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#008000">&quot;minutes&quot;</font><font color="4444FF">)</font><font color="4444FF">)</font>
        <font color="#2040a0">seconds</font> <font color="4444FF">=</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#008000">&quot;seconds&quot;</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">seconds</font><font color="4444FF">:</font>
            <font color="#2040a0">seconds</font> <font color="4444FF">=</font> <font color="#2040a0">int</font><font color="4444FF">(</font><font color="#2040a0">seconds</font><font color="4444FF">)</font>
        <strong>else</strong><font color="4444FF">:</font>
            <font color="#2040a0">seconds</font> <font color="4444FF">=</font> <font color="#FF0000">0</font>
        <strong>return</strong> <font color="#2040a0">hours</font>, <font color="#2040a0">minutes</font>, <font color="#2040a0">seconds</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> __extract_tzd</font><font color="2040a0">(m)</font>:
</strong>        <font color="#008000">&quot;&quot;</font><font color="#008000">&quot;Return the Time Zone Designator as an offset in seconds from UTC.&quot;</font><font color="#008000">&quot;&quot;</font>
        <strong>if</strong> <strong>not</strong> <font color="#2040a0">m</font><font color="4444FF">:</font>
            <strong>return</strong> <font color="#FF0000">0</font>
        <font color="#2040a0">tzd</font> <font color="4444FF">=</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#008000">&quot;tzd&quot;</font><font color="4444FF">)</font>
        <strong>if</strong> <strong>not</strong> <font color="#2040a0">tzd</font><font color="4444FF">:</font>
            <strong>return</strong> <font color="#FF0000">0</font>
        <strong>if</strong> <font color="#2040a0">tzd</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">&quot;Z&quot;</font><font color="4444FF">:</font>
            <strong>return</strong> <font color="#FF0000">0</font>
        <font color="#2040a0">hours</font> <font color="4444FF">=</font> <font color="#2040a0">int</font><font color="4444FF">(</font><font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#008000">&quot;tzdhours&quot;</font><font color="4444FF">)</font><font color="4444FF">)</font>
        <font color="#2040a0">minutes</font> <font color="4444FF">=</font> <font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="#008000">&quot;tzdminutes&quot;</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">minutes</font><font color="4444FF">:</font>
            <font color="#2040a0">minutes</font> <font color="4444FF">=</font> <font color="#2040a0">int</font><font color="4444FF">(</font><font color="#2040a0">minutes</font><font color="4444FF">)</font>
        <strong>else</strong><font color="4444FF">:</font>
            <font color="#2040a0">minutes</font> <font color="4444FF">=</font> <font color="#FF0000">0</font>
        <font color="#2040a0">offset</font> <font color="4444FF">=</font> <font color="4444FF">(</font><font color="#2040a0">hours</font><font color="4444FF">*</font><font color="#FF0000">60</font> <font color="4444FF">+</font> <font color="#2040a0">minutes</font><font color="4444FF">)</font> <font color="4444FF">*</font> <font color="#FF0000">60</font>
        <strong>if</strong> <font color="#2040a0">tzd</font><font color="4444FF">[</font><font color="#FF0000">0</font><font color="4444FF">]</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">&quot;+&quot;</font><font color="4444FF">:</font>
            <strong>return</strong> <font color="4444FF">-</font><font color="#2040a0">offset</font>
        <strong>return</strong> <font color="#2040a0">offset</font>

    <font color="#2040a0">__date_re</font> <font color="4444FF">=</font> <font color="4444FF">(</font><font color="#008000">&quot;(?P&lt;year&gt;<font color="#77dd77">\d</font><font color="#77dd77">\d</font><font color="#77dd77">\d</font><font color="#77dd77">\d</font>)&quot;</font>
                 <font color="#008000">&quot;(?:(?P&lt;dsep&gt;-|)&quot;</font>
                 <font color="#008000">&quot;(?:(?P&lt;julian&gt;<font color="#77dd77">\d</font><font color="#77dd77">\d</font><font color="#77dd77">\d</font>)&quot;</font>
                 <font color="#008000">&quot;|(?P&lt;month&gt;<font color="#77dd77">\d</font><font color="#77dd77">\d</font>)(?:(?P=dsep)(?P&lt;day&gt;<font color="#77dd77">\d</font><font color="#77dd77">\d</font>))?))?&quot;</font><font color="4444FF">)</font>
    <font color="#2040a0">__tzd_re</font> <font color="4444FF">=</font> <font color="#008000">&quot;(?P&lt;tzd&gt;[-+](?P&lt;tzdhours&gt;<font color="#77dd77">\d</font><font color="#77dd77">\d</font>)(?::?(?P&lt;tzdminutes&gt;<font color="#77dd77">\d</font><font color="#77dd77">\d</font>))|Z)&quot;</font>
    <font color="#2040a0">__tzd_rx</font> <font color="4444FF">=</font> <font color="#2040a0">re</font>.<font color="#2040a0">compile</font><font color="4444FF">(</font><font color="#2040a0">__tzd_re</font><font color="4444FF">)</font>
    <font color="#2040a0">__time_re</font> <font color="4444FF">=</font> <font color="4444FF">(</font><font color="#008000">&quot;(?P&lt;hours&gt;<font color="#77dd77">\d</font><font color="#77dd77">\d</font>)(?P&lt;tsep&gt;:|)(?P&lt;minutes&gt;<font color="#77dd77">\d</font><font color="#77dd77">\d</font>)&quot;</font>
                 <font color="#008000">&quot;(?:(?P=tsep)(?P&lt;seconds&gt;<font color="#77dd77">\d</font><font color="#77dd77">\d</font>(?:[.,]<font color="#77dd77">\d</font>+)?))?&quot;</font>
                 <font color="4444FF">+</font> <font color="#2040a0">__tzd_re</font><font color="4444FF">)</font>
    <font color="#2040a0">__datetime_re</font> <font color="4444FF">=</font> <font color="#008000">&quot;%s(?:T%s)?&quot;</font> <font color="4444FF">%</font> <font color="4444FF">(</font><font color="#2040a0">__date_re</font>, <font color="#2040a0">__time_re</font><font color="4444FF">)</font>
    <font color="#2040a0">__datetime_rx</font> <font color="4444FF">=</font> <font color="#2040a0">re</font>.<font color="#2040a0">compile</font><font color="4444FF">(</font><font color="#2040a0">__datetime_re</font><font color="4444FF">)</font>
    <font color="#2040a0">m</font> <font color="4444FF">=</font> <font color="#2040a0">__datetime_rx</font>.<font color="#2040a0">match</font><font color="4444FF">(</font><font color="#2040a0">dateString</font><font color="4444FF">)</font>
    <strong>if</strong> <font color="4444FF">(</font><font color="#2040a0">m</font> <strong>is</strong> <font color="#2040a0">None</font><font color="4444FF">)</font> <strong>or</strong> <font color="4444FF">(</font><font color="#2040a0">m</font>.<font color="#2040a0">group</font><font color="4444FF">(</font><font color="4444FF">)</font> <font color="4444FF">!</font><font color="4444FF">=</font> <font color="#2040a0">dateString</font><font color="4444FF">)</font><font color="4444FF">:</font> <strong>return</strong>
    <font color="#2040a0">gmt</font> <font color="4444FF">=</font> <font color="#2040a0">__extract_date</font><font color="4444FF">(</font><font color="#2040a0">m</font><font color="4444FF">)</font> <font color="4444FF">+</font> <font color="#2040a0">__extract_time</font><font color="4444FF">(</font><font color="#2040a0">m</font><font color="4444FF">)</font> <font color="4444FF">+</font> <font color="4444FF">(</font><font color="#FF0000">0</font>, <font color="#FF0000">0</font>, <font color="#FF0000">0</font><font color="4444FF">)</font>
    <strong>if</strong> <font color="#2040a0">gmt</font><font color="4444FF">[</font><font color="#FF0000">0</font><font color="4444FF">]</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#FF0000">0</font><font color="4444FF">:</font> <strong>return</strong>
    <strong>return</strong> <font color="#2040a0">time</font>.<font color="#2040a0">gmtime</font><font color="4444FF">(</font><font color="#2040a0">time</font>.<font color="#2040a0">mktime</font><font color="4444FF">(</font><font color="#2040a0">gmt</font><font color="4444FF">)</font> <font color="4444FF">+</font> <font color="#2040a0">__extract_tzd</font><font color="4444FF">(</font><font color="#2040a0">m</font><font color="4444FF">)</font> <font color="4444FF">-</font> <font color="#2040a0">time</font>.<font color="#2040a0">timezone</font><font color="4444FF">)</font>
<font color="#2040a0">registerDateHandler</font><font color="4444FF">(</font><font color="#2040a0">_parse_date_w3dtf</font><font color="4444FF">)</font>

<font color="#2040a0">def</font> <font color="#2040a0">_parse_date_rfc822</font><font color="4444FF">(</font><font color="#2040a0">dateString</font><font color="4444FF">)</font><font color="4444FF">:</font>
    <font color="#008000">&quot;&quot;</font><font color="#008000">&quot;Parse an RFC822, RFC1123, RFC2822, or asctime-style date&quot;</font><font color="#008000">&quot;&quot;</font>
    <font color="#2040a0">tm</font> <font color="4444FF">=</font> <font color="#2040a0">rfc822</font>.<font color="#2040a0">parsedate_tz</font><font color="4444FF">(</font><font color="#2040a0">dateString</font><font color="4444FF">)</font>
    <strong>if</strong> <font color="#2040a0">tm</font><font color="4444FF">:</font>
        <strong>return</strong> <font color="#2040a0">time</font>.<font color="#2040a0">gmtime</font><font color="4444FF">(</font><font color="#2040a0">rfc822</font>.<font color="#2040a0">mktime_tz</font><font color="4444FF">(</font><font color="#2040a0">tm</font><font color="4444FF">)</font><font color="4444FF">)</font>
<font color="#444444"># rfc822.py defines several time zones, but we define some extra ones.</font>
<font color="#444444"># &quot;ET&quot; is equivalent to &quot;EST&quot;, etc.</font>
<font color="#2040a0">_additional_timezones</font> <font color="4444FF">=</font> <font color="4444FF"><strong>{</strong></font><font color="#008000">'AT'</font><font color="4444FF">:</font> <font color="4444FF">-</font><font color="#FF0000">400</font>, <font color="#008000">'ET'</font><font color="4444FF">:</font> <font color="4444FF">-</font><font color="#FF0000">500</font>, <font color="#008000">'CT'</font><font color="4444FF">:</font> <font color="4444FF">-</font><font color="#FF0000">600</font>, <font color="#008000">'MT'</font><font color="4444FF">:</font> <font color="4444FF">-</font><font color="#FF0000">700</font>, <font color="#008000">'PT'</font><font color="4444FF">:</font> <font color="4444FF">-</font><font color="#FF0000">800</font><font color="4444FF"><strong>}</strong></font>
<font color="#2040a0">rfc822</font>.<font color="#2040a0">_timezones</font>.<font color="#2040a0">update</font><font color="4444FF">(</font><font color="#2040a0">_additional_timezones</font><font color="4444FF">)</font>
<font color="#2040a0">registerDateHandler</font><font color="4444FF">(</font><font color="#2040a0">_parse_date_rfc822</font><font color="4444FF">)</font>    

<font color="#2040a0">def</font> <font color="#2040a0">_parse_date</font><font color="4444FF">(</font><font color="#2040a0">dateString</font><font color="4444FF">)</font><font color="4444FF">:</font>
    <font color="#008000">&quot;&quot;</font><font color="#008000">&quot;Parses a variety of date formats into a 9-tuple in GMT&quot;</font><font color="#008000">&quot;&quot;</font>
    <strong>for</strong> <font color="#2040a0">handler</font> <strong>in</strong> <font color="#2040a0">_date_handlers</font><font color="4444FF">:</font>
        <strong>try</strong><font color="4444FF">:</font>
            <font color="#2040a0">date9tuple</font> <font color="4444FF">=</font> <font color="#2040a0">handler</font><font color="4444FF">(</font><font color="#2040a0">dateString</font><font color="4444FF">)</font>
            <strong>if</strong> <strong>not</strong> <font color="#2040a0">date9tuple</font><font color="4444FF">:</font> <strong>continue</strong>
            <strong>if</strong> <font color="#2040a0">len</font><font color="4444FF">(</font><font color="#2040a0">date9tuple</font><font color="4444FF">)</font> <font color="4444FF">!</font><font color="4444FF">=</font> <font color="#FF0000">9</font><font color="4444FF">:</font>
                <strong>if</strong> <font color="#2040a0">_debug</font><font color="4444FF">:</font> <font color="#2040a0">sys</font>.<font color="#2040a0">stderr</font>.<font color="#2040a0">write</font><font color="4444FF">(</font><font color="#008000">&quot;date handler function must return 9-tuple<font color="#77dd77">\n</font>&quot;</font><font color="4444FF">)</font>
                <strong>raise</strong> <font color="#2040a0">ValueError</font>
            <font color="#2040a0">map</font><font color="4444FF">(</font><font color="#2040a0">int</font>, <font color="#2040a0">date9tuple</font><font color="4444FF">)</font>
            <strong>return</strong> <font color="#2040a0">date9tuple</font>
        <strong>except</strong> <font color="#2040a0">Exception</font>, <font color="#2040a0">e</font><font color="4444FF">:</font>
            <strong>if</strong> <font color="#2040a0">_debug</font><font color="4444FF">:</font> <font color="#2040a0">sys</font>.<font color="#2040a0">stderr</font>.<font color="#2040a0">write</font><font color="4444FF">(</font><font color="#008000">&quot;%s raised %s<font color="#77dd77">\n</font>&quot;</font> <font color="4444FF">%</font> <font color="4444FF">(</font><font color="#2040a0">handler</font>.<font color="#2040a0">__name__</font>, <font color="#2040a0">repr</font><font color="4444FF">(</font><font color="#2040a0">e</font><font color="4444FF">)</font><font color="4444FF">)</font><font color="4444FF">)</font>
            <strong>pass</strong>
    <strong>return</strong> <font color="#2040a0">None</font>

<font color="#2040a0">def</font> <font color="#2040a0">_getCharacterEncoding</font><font color="4444FF">(</font><font color="#2040a0">http_headers</font>, <font color="#2040a0">xml_data</font><font color="4444FF">)</font><font color="4444FF">:</font>
    <font color="#008000">&quot;&quot;</font><font color="#008000">&quot;Get the character encoding of the XML document

    http_headers is a dictionary
    xml_data is a raw string (not Unicode)
    
    This is so much trickier than it sounds, it's not even funny.
    According to RFC 3023 (&quot;</font><font color="#2040a0">XML</font> <font color="#2040a0">Media</font> <font color="#2040a0">Types</font><font color="#008000">&quot;), if the HTTP Content-Type
    is application/xml, application/*+xml,
    application/xml-external-parsed-entity, or application/xml-dtd,
    the encoding given in the charset parameter of the HTTP Content-Type
    takes precedence over the encoding given in the XML prefix within the
    document, and defaults to &quot;</font><font color="#2040a0">utf</font><font color="4444FF">-</font><font color="#FF0000">8</font><font color="#008000">&quot; if neither are specified.  But, if
    the HTTP Content-Type is text/xml, text/*+xml, or
    text/xml-external-parsed-entity, the encoding given in the XML prefix
    within the document is ALWAYS IGNORED and only the encoding given in
    the charset parameter of the HTTP Content-Type header should be
    respected, and it defaults to &quot;</font><font color="#2040a0">us</font><font color="4444FF">-</font><font color="#2040a0">ascii</font><font color="#008000">&quot; if not specified.

    Furthermore, discussion on the atom-syntax mailing list with the
    author of RFC 3023 leads me to the conclusion that any document
    served with a Content-Type of text/* and no charset parameter
    must be treated as us-ascii.  (We now do this.)  And also that it
    must always be flagged as non-well-formed.  (We now do this too.)
    
    If Content-Type is unspecified (input was local file or non-HTTP source)
    or unrecognized (server just got it totally wrong), then go by the
    encoding given in the XML prefix of the document and default to
    &quot;</font><font color="#2040a0">iso</font><font color="4444FF">-</font><font color="#FF0000">8859</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="#008000">&quot; as per the HTTP specification (RFC 2616).
    
    Then, assuming we didn't find a character encoding in the HTTP headers
    (and the HTTP Content-type allowed us to look in the body), we need
    to sniff the first few bytes of the XML data and try to determine
    whether the encoding is ASCII-compatible.  Section F of the XML
    specification shows the way here:
    http://www.w3.org/TR/REC-xml/#sec-guessing-no-ext-info

    If the sniffed encoding is not ASCII-compatible, we need to make it
    ASCII compatible so that we can sniff further into the XML declaration
    to find the encoding attribute, which will tell us the true encoding.

    Of course, none of this guarantees that we will be able to parse the
    feed in the declared character encoding (assuming it was declared
    correctly, which many are not).  CJKCodecs and iconv_codec help a lot;
    you should definitely install them if you can.
    http://cjkpython.i18n.org/
    &quot;</font><font color="#008000">&quot;&quot;</font>

<strong>   <font color="ff0000"> def</font><font color="ff0000"> _parseHTTPContentType</font><font color="2040a0">(content_type)</font>:
</strong>        <font color="#008000">&quot;&quot;</font><font color="#008000">&quot;takes HTTP Content-Type header and returns (content type, charset)

        If no charset is specified, returns (content type, '')
        If no content type is specified, returns ('', '')
        Both return parameters are guaranteed to be lowercase strings
        &quot;</font><font color="#008000">&quot;&quot;</font>
        <font color="#2040a0">content_type</font> <font color="4444FF">=</font> <font color="#2040a0">content_type</font> <strong>or</strong> <font color="#008000">''</font>
        <font color="#2040a0">content_type</font>, <font color="#2040a0">params</font> <font color="4444FF">=</font> <font color="#2040a0">cgi</font>.<font color="#2040a0">parse_header</font><font color="4444FF">(</font><font color="#2040a0">content_type</font><font color="4444FF">)</font>
        <strong>return</strong> <font color="#2040a0">content_type</font>, <font color="#2040a0">params</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'charset'</font>, <font color="#008000">''</font><font color="4444FF">)</font>.<font color="#2040a0">replace</font><font color="4444FF">(</font><font color="#008000">&quot;'&quot;</font>, <font color="#008000">&quot;&quot;</font><font color="4444FF">)</font>

    <font color="#2040a0">sniffed_xml_encoding</font> <font color="4444FF">=</font> <font color="#008000">''</font>
    <font color="#2040a0">xml_encoding</font> <font color="4444FF">=</font> <font color="#008000">''</font>
    <font color="#2040a0">true_encoding</font> <font color="4444FF">=</font> <font color="#008000">''</font>
    <font color="#2040a0">http_content_type</font>, <font color="#2040a0">http_encoding</font> <font color="4444FF">=</font> <font color="#2040a0">_parseHTTPContentType</font><font color="4444FF">(</font><font color="#2040a0">http_headers</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">&quot;content-type&quot;</font><font color="4444FF">)</font><font color="4444FF">)</font>
    <font color="#444444"># Must sniff for non-ASCII-compatible character encodings before</font>
    <font color="#444444"># searching for XML declaration.  This heuristic is defined in</font>
    <font color="#444444"># section F of the XML specification:</font>
    <font color="#444444"># http://www.w3.org/TR/REC-xml/#sec-guessing-no-ext-info</font>
    <strong>try</strong><font color="4444FF">:</font>
        <strong>if</strong> <font color="#2040a0">xml_data</font><font color="4444FF">[</font><font color="4444FF">:</font><font color="#FF0000">4</font><font color="4444FF">]</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">'\x4c\x6f\xa7\x94'</font><font color="4444FF">:</font>
            <font color="#444444"># EBCDIC</font>
            <font color="#2040a0">xml_data</font> <font color="4444FF">=</font> <font color="#2040a0">_ebcdic_to_ascii</font><font color="4444FF">(</font><font color="#2040a0">xml_data</font><font color="4444FF">)</font>
        <strong>elif</strong> <font color="#2040a0">xml_data</font><font color="4444FF">[</font><font color="4444FF">:</font><font color="#FF0000">4</font><font color="4444FF">]</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">'\x00\x3c\x00\x3f'</font><font color="4444FF">:</font>
            <font color="#444444"># UTF-16BE</font>
            <font color="#2040a0">sniffed_xml_encoding</font> <font color="4444FF">=</font> <font color="#008000">'utf-16be'</font>
            <font color="#2040a0">xml_data</font> <font color="4444FF">=</font> <font color="#2040a0">unicode</font><font color="4444FF">(</font><font color="#2040a0">xml_data</font>, <font color="#008000">'utf-16be'</font><font color="4444FF">)</font>.<font color="#2040a0">encode</font><font color="4444FF">(</font><font color="#008000">'utf-8'</font><font color="4444FF">)</font>
        <strong>elif</strong> <font color="4444FF">(</font><font color="#2040a0">len</font><font color="4444FF">(</font><font color="#2040a0">xml_data</font><font color="4444FF">)</font> <font color="4444FF">&gt;</font><font color="4444FF">=</font> <font color="#FF0000">4</font><font color="4444FF">)</font> <strong>and</strong> <font color="4444FF">(</font><font color="#2040a0">xml_data</font><font color="4444FF">[</font><font color="4444FF">:</font><font color="#FF0000">2</font><font color="4444FF">]</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">'\xfe\xff'</font><font color="4444FF">)</font> <strong>and</strong> <font color="4444FF">(</font><font color="#2040a0">xml_data</font><font color="4444FF">[</font><font color="#FF0000">2</font><font color="4444FF">:</font><font color="#FF0000">4</font><font color="4444FF">]</font> <font color="4444FF">!</font><font color="4444FF">=</font> <font color="#008000">'\x00\x00'</font><font color="4444FF">)</font><font color="4444FF">:</font>
            <font color="#444444"># UTF-16BE with BOM</font>
            <font color="#2040a0">sniffed_xml_encoding</font> <font color="4444FF">=</font> <font color="#008000">'utf-16be'</font>
            <font color="#2040a0">xml_data</font> <font color="4444FF">=</font> <font color="#2040a0">unicode</font><font color="4444FF">(</font><font color="#2040a0">xml_data</font><font color="4444FF">[</font><font color="#FF0000">2</font><font color="4444FF">:</font><font color="4444FF">]</font>, <font color="#008000">'utf-16be'</font><font color="4444FF">)</font>.<font color="#2040a0">encode</font><font color="4444FF">(</font><font color="#008000">'utf-8'</font><font color="4444FF">)</font>
        <strong>elif</strong> <font color="#2040a0">xml_data</font><font color="4444FF">[</font><font color="4444FF">:</font><font color="#FF0000">4</font><font color="4444FF">]</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">'\x3c\x00\x3f\x00'</font><font color="4444FF">:</font>
            <font color="#444444"># UTF-16LE</font>
            <font color="#2040a0">sniffed_xml_encoding</font> <font color="4444FF">=</font> <font color="#008000">'utf-16le'</font>
            <font color="#2040a0">xml_data</font> <font color="4444FF">=</font> <font color="#2040a0">unicode</font><font color="4444FF">(</font><font color="#2040a0">xml_data</font>, <font color="#008000">'utf-16le'</font><font color="4444FF">)</font>.<font color="#2040a0">encode</font><font color="4444FF">(</font><font color="#008000">'utf-8'</font><font color="4444FF">)</font>
        <strong>elif</strong> <font color="4444FF">(</font><font color="#2040a0">len</font><font color="4444FF">(</font><font color="#2040a0">xml_data</font><font color="4444FF">)</font> <font color="4444FF">&gt;</font><font color="4444FF">=</font> <font color="#FF0000">4</font><font color="4444FF">)</font> <strong>and</strong> <font color="4444FF">(</font><font color="#2040a0">xml_data</font><font color="4444FF">[</font><font color="4444FF">:</font><font color="#FF0000">2</font><font color="4444FF">]</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">'\xff\xfe'</font><font color="4444FF">)</font> <strong>and</strong> <font color="4444FF">(</font><font color="#2040a0">xml_data</font><font color="4444FF">[</font><font color="#FF0000">2</font><font color="4444FF">:</font><font color="#FF0000">4</font><font color="4444FF">]</font> <font color="4444FF">!</font><font color="4444FF">=</font> <font color="#008000">'\x00\x00'</font><font color="4444FF">)</font><font color="4444FF">:</font>
            <font color="#444444"># UTF-16LE with BOM</font>
            <font color="#2040a0">sniffed_xml_encoding</font> <font color="4444FF">=</font> <font color="#008000">'utf-16le'</font>
            <font color="#2040a0">xml_data</font> <font color="4444FF">=</font> <font color="#2040a0">unicode</font><font color="4444FF">(</font><font color="#2040a0">xml_data</font><font color="4444FF">[</font><font color="#FF0000">2</font><font color="4444FF">:</font><font color="4444FF">]</font>, <font color="#008000">'utf-16le'</font><font color="4444FF">)</font>.<font color="#2040a0">encode</font><font color="4444FF">(</font><font color="#008000">'utf-8'</font><font color="4444FF">)</font>
        <strong>elif</strong> <font color="#2040a0">xml_data</font><font color="4444FF">[</font><font color="4444FF">:</font><font color="#FF0000">4</font><font color="4444FF">]</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">'\x00\x00\x00\x3c'</font><font color="4444FF">:</font>
            <font color="#444444"># UTF-32BE</font>
            <font color="#2040a0">sniffed_xml_encoding</font> <font color="4444FF">=</font> <font color="#008000">'utf-32be'</font>
            <font color="#2040a0">xml_data</font> <font color="4444FF">=</font> <font color="#2040a0">unicode</font><font color="4444FF">(</font><font color="#2040a0">xml_data</font>, <font color="#008000">'utf-32be'</font><font color="4444FF">)</font>.<font color="#2040a0">encode</font><font color="4444FF">(</font><font color="#008000">'utf-8'</font><font color="4444FF">)</font>
        <strong>elif</strong> <font color="#2040a0">xml_data</font><font color="4444FF">[</font><font color="4444FF">:</font><font color="#FF0000">4</font><font color="4444FF">]</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">'\x3c\x00\x00\x00'</font><font color="4444FF">:</font>
            <font color="#444444"># UTF-32LE</font>
            <font color="#2040a0">sniffed_xml_encoding</font> <font color="4444FF">=</font> <font color="#008000">'utf-32le'</font>
            <font color="#2040a0">xml_data</font> <font color="4444FF">=</font> <font color="#2040a0">unicode</font><font color="4444FF">(</font><font color="#2040a0">xml_data</font>, <font color="#008000">'utf-32le'</font><font color="4444FF">)</font>.<font color="#2040a0">encode</font><font color="4444FF">(</font><font color="#008000">'utf-8'</font><font color="4444FF">)</font>
        <strong>elif</strong> <font color="#2040a0">xml_data</font><font color="4444FF">[</font><font color="4444FF">:</font><font color="#FF0000">4</font><font color="4444FF">]</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">'\x00\x00\xfe\xff'</font><font color="4444FF">:</font>
            <font color="#444444"># UTF-32BE with BOM</font>
            <font color="#2040a0">sniffed_xml_encoding</font> <font color="4444FF">=</font> <font color="#008000">'utf-32be'</font>
            <font color="#2040a0">xml_data</font> <font color="4444FF">=</font> <font color="#2040a0">unicode</font><font color="4444FF">(</font><font color="#2040a0">xml_data</font><font color="4444FF">[</font><font color="#FF0000">4</font><font color="4444FF">:</font><font color="4444FF">]</font>, <font color="#008000">'utf-32be'</font><font color="4444FF">)</font>.<font color="#2040a0">encode</font><font color="4444FF">(</font><font color="#008000">'utf-8'</font><font color="4444FF">)</font>
        <strong>elif</strong> <font color="#2040a0">xml_data</font><font color="4444FF">[</font><font color="4444FF">:</font><font color="#FF0000">4</font><font color="4444FF">]</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">'\xff\xfe\x00\x00'</font><font color="4444FF">:</font>
            <font color="#444444"># UTF-32LE with BOM</font>
            <font color="#2040a0">sniffed_xml_encoding</font> <font color="4444FF">=</font> <font color="#008000">'utf-32le'</font>
            <font color="#2040a0">xml_data</font> <font color="4444FF">=</font> <font color="#2040a0">unicode</font><font color="4444FF">(</font><font color="#2040a0">xml_data</font><font color="4444FF">[</font><font color="#FF0000">4</font><font color="4444FF">:</font><font color="4444FF">]</font>, <font color="#008000">'utf-32le'</font><font color="4444FF">)</font>.<font color="#2040a0">encode</font><font color="4444FF">(</font><font color="#008000">'utf-8'</font><font color="4444FF">)</font>
        <strong>elif</strong> <font color="#2040a0">xml_data</font><font color="4444FF">[</font><font color="4444FF">:</font><font color="#FF0000">3</font><font color="4444FF">]</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">'\xef\xbb\xbf'</font><font color="4444FF">:</font>
            <font color="#444444"># UTF-8 with BOM</font>
            <font color="#2040a0">sniffed_xml_encoding</font> <font color="4444FF">=</font> <font color="#008000">'utf-8'</font>
            <font color="#2040a0">xml_data</font> <font color="4444FF">=</font> <font color="#2040a0">unicode</font><font color="4444FF">(</font><font color="#2040a0">xml_data</font><font color="4444FF">[</font><font color="#FF0000">3</font><font color="4444FF">:</font><font color="4444FF">]</font>, <font color="#008000">'utf-8'</font><font color="4444FF">)</font>.<font color="#2040a0">encode</font><font color="4444FF">(</font><font color="#008000">'utf-8'</font><font color="4444FF">)</font>
        <strong>else</strong><font color="4444FF">:</font>
            <font color="#444444"># ASCII-compatible</font>
            <strong>pass</strong>
        <font color="#2040a0">xml_encoding_match</font> <font color="4444FF">=</font> <font color="#2040a0">re</font>.<font color="#2040a0">compile</font><font color="4444FF">(</font><font color="#008000">'^&lt;\?.*encoding=[\'</font><font color="#008000">&quot;](.*?)[<font color="#77dd77">\'</font>&quot;</font><font color="4444FF">]</font>.<font color="4444FF">*</font>\?<font color="4444FF">&gt;</font><font color="#008000">').match(xml_data)
    except:
        xml_encoding_match = None
    if xml_encoding_match:
        xml_encoding = xml_encoding_match.groups()[0].lower()
        if sniffed_xml_encoding and (xml_encoding in ('</font><font color="#2040a0">iso</font><font color="4444FF">-</font><font color="#FF0000">10646</font><font color="4444FF">-</font><font color="#2040a0">ucs</font><font color="4444FF">-</font><font color="#FF0000">2</font><font color="#008000">', '</font><font color="#2040a0">ucs</font><font color="4444FF">-</font><font color="#FF0000">2</font><font color="#008000">', '</font><font color="#2040a0">csunicode</font><font color="#008000">', '</font><font color="#2040a0">iso</font><font color="4444FF">-</font><font color="#FF0000">10646</font><font color="4444FF">-</font><font color="#2040a0">ucs</font><font color="4444FF">-</font><font color="#FF0000">4</font><font color="#008000">', '</font><font color="#2040a0">ucs</font><font color="4444FF">-</font><font color="#FF0000">4</font><font color="#008000">', '</font><font color="#2040a0">csucs4</font><font color="#008000">', '</font><font color="#2040a0">utf</font><font color="4444FF">-</font><font color="#FF0000">16</font><font color="#008000">', '</font><font color="#2040a0">utf</font><font color="4444FF">-</font><font color="#FF0000">32</font><font color="#008000">', '</font><font color="#2040a0">utf_16</font><font color="#008000">', '</font><font color="#2040a0">utf_32</font><font color="#008000">', '</font><font color="#2040a0">utf16</font><font color="#008000">', '</font><font color="#2040a0">u16</font><font color="#008000">')):
            xml_encoding = sniffed_xml_encoding
    acceptable_content_type = 0
    application_content_types = ('</font><font color="#2040a0">application</font>/<font color="#2040a0">xml</font><font color="#008000">', '</font><font color="#2040a0">application</font>/<font color="#2040a0">xml</font><font color="4444FF">-</font><font color="#2040a0">dtd</font><font color="#008000">', '</font><font color="#2040a0">application</font>/<font color="#2040a0">xml</font><font color="4444FF">-</font><font color="#2040a0">external</font><font color="4444FF">-</font><font color="#2040a0">parsed</font><font color="4444FF">-</font><font color="#2040a0">entity</font><font color="#008000">')
    text_content_types = ('</font><font color="#2040a0">text</font>/<font color="#2040a0">xml</font><font color="#008000">', '</font><font color="#2040a0">text</font>/<font color="#2040a0">xml</font><font color="4444FF">-</font><font color="#2040a0">external</font><font color="4444FF">-</font><font color="#2040a0">parsed</font><font color="4444FF">-</font><font color="#2040a0">entity</font><font color="#008000">')
    if (http_content_type in application_content_types) or \
       (http_content_type.startswith('</font><font color="#2040a0">application</font>/<font color="#008000">') and http_content_type.endswith('</font><font color="4444FF">+</font><font color="#2040a0">xml</font><font color="#008000">')):
        acceptable_content_type = 1
        true_encoding = http_encoding or xml_encoding or '</font><font color="#2040a0">utf</font><font color="4444FF">-</font><font color="#FF0000">8</font><font color="#008000">'
    elif (http_content_type in text_content_types) or \
         (http_content_type.startswith('</font><font color="#2040a0">text</font>/<font color="#008000">')) and http_content_type.endswith('</font><font color="4444FF">+</font><font color="#2040a0">xml</font><font color="#008000">'):
        acceptable_content_type = 1
        true_encoding = http_encoding or '</font><font color="#2040a0">us</font><font color="4444FF">-</font><font color="#2040a0">ascii</font><font color="#008000">'
    elif http_content_type.startswith('</font><font color="#2040a0">text</font>/<font color="#008000">'):
        true_encoding = http_encoding or '</font><font color="#2040a0">us</font><font color="4444FF">-</font><font color="#2040a0">ascii</font><font color="#008000">'
    elif http_headers and (not http_headers.has_key('</font><font color="#2040a0">content</font><font color="4444FF">-</font><font color="#2040a0">type</font><font color="#008000">')):
        true_encoding = xml_encoding or '</font><font color="#2040a0">iso</font><font color="4444FF">-</font><font color="#FF0000">8859</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="#008000">'
    else:
        true_encoding = xml_encoding or '</font><font color="#2040a0">utf</font><font color="4444FF">-</font><font color="#FF0000">8</font><font color="#008000">'
    return true_encoding, http_encoding, xml_encoding, sniffed_xml_encoding, acceptable_content_type
    
def _toUTF8(data, encoding):
    &quot;&quot;&quot;Changes an XML data stream on the fly to specify a new encoding

    data is a raw sequence of bytes (not Unicode) that is presumed to be in %encoding already
    encoding is a string recognized by encodings.aliases
    &quot;&quot;&quot;
    if _debug: sys.stderr.write('</font><font color="#2040a0">entering</font> <font color="#2040a0">_toUTF8</font>, <font color="#2040a0">trying</font> <font color="#2040a0">encoding</font> <font color="4444FF">%</font><font color="#2040a0">s</font>\<font color="#2040a0">n</font><font color="#008000">' % encoding)
    # strip Byte Order Mark (if present)
    if (len(data) &gt;= 4) and (data[:2] == '</font>\<font color="#2040a0">xfe</font>\<font color="#2040a0">xff</font><font color="#008000">') and (data[2:4] != '</font>\<font color="#2040a0">x00</font>\<font color="#2040a0">x00</font><font color="#008000">'):
        if _debug:
            sys.stderr.write('</font><font color="#2040a0">stripping</font> <font color="#2040a0">BOM</font>\<font color="#2040a0">n</font><font color="#008000">')
            if encoding != '</font><font color="#2040a0">utf</font><font color="4444FF">-</font>16<font color="#2040a0">be</font><font color="#008000">':
                sys.stderr.write('</font><font color="#2040a0">trying</font> <font color="#2040a0">utf</font><font color="4444FF">-</font>16<font color="#2040a0">be</font> <font color="#2040a0">instead</font>\<font color="#2040a0">n</font><font color="#008000">')
        encoding = '</font><font color="#2040a0">utf</font><font color="4444FF">-</font>16<font color="#2040a0">be</font><font color="#008000">'
        data = data[2:]
    elif (len(data) &gt;= 4) and (data[:2] == '</font>\<font color="#2040a0">xff</font>\<font color="#2040a0">xfe</font><font color="#008000">') and (data[2:4] != '</font>\<font color="#2040a0">x00</font>\<font color="#2040a0">x00</font><font color="#008000">'):
        if _debug:
            sys.stderr.write('</font><font color="#2040a0">stripping</font> <font color="#2040a0">BOM</font>\<font color="#2040a0">n</font><font color="#008000">')
            if encoding != '</font><font color="#2040a0">utf</font><font color="4444FF">-</font>16<font color="#2040a0">le</font><font color="#008000">':
                sys.stderr.write('</font><font color="#2040a0">trying</font> <font color="#2040a0">utf</font><font color="4444FF">-</font>16<font color="#2040a0">le</font> <font color="#2040a0">instead</font>\<font color="#2040a0">n</font><font color="#008000">')
        encoding = '</font><font color="#2040a0">utf</font><font color="4444FF">-</font>16<font color="#2040a0">le</font><font color="#008000">'
        data = data[2:]
    elif data[:3] == '</font>\<font color="#2040a0">xef</font>\<font color="#2040a0">xbb</font>\<font color="#2040a0">xbf</font><font color="#008000">':
        if _debug:
            sys.stderr.write('</font><font color="#2040a0">stripping</font> <font color="#2040a0">BOM</font>\<font color="#2040a0">n</font><font color="#008000">')
            if encoding != '</font><font color="#2040a0">utf</font><font color="4444FF">-</font><font color="#FF0000">8</font><font color="#008000">':
                sys.stderr.write('</font><font color="#2040a0">trying</font> <font color="#2040a0">utf</font><font color="4444FF">-</font><font color="#FF0000">8</font> <font color="#2040a0">instead</font>\<font color="#2040a0">n</font><font color="#008000">')
        encoding = '</font><font color="#2040a0">utf</font><font color="4444FF">-</font><font color="#FF0000">8</font><font color="#008000">'
        data = data[3:]
    elif data[:4] == '</font>\<font color="#2040a0">x00</font>\<font color="#2040a0">x00</font>\<font color="#2040a0">xfe</font>\<font color="#2040a0">xff</font><font color="#008000">':
        if _debug:
            sys.stderr.write('</font><font color="#2040a0">stripping</font> <font color="#2040a0">BOM</font>\<font color="#2040a0">n</font><font color="#008000">')
            if encoding != '</font><font color="#2040a0">utf</font><font color="4444FF">-</font>32<font color="#2040a0">be</font><font color="#008000">':
                sys.stderr.write('</font><font color="#2040a0">trying</font> <font color="#2040a0">utf</font><font color="4444FF">-</font>32<font color="#2040a0">be</font> <font color="#2040a0">instead</font>\<font color="#2040a0">n</font><font color="#008000">')
        encoding = '</font><font color="#2040a0">utf</font><font color="4444FF">-</font>32<font color="#2040a0">be</font><font color="#008000">'
        data = data[4:]
    elif data[:4] == '</font>\<font color="#2040a0">xff</font>\<font color="#2040a0">xfe</font>\<font color="#2040a0">x00</font>\<font color="#2040a0">x00</font><font color="#008000">':
        if _debug:
            sys.stderr.write('</font><font color="#2040a0">stripping</font> <font color="#2040a0">BOM</font>\<font color="#2040a0">n</font><font color="#008000">')
            if encoding != '</font><font color="#2040a0">utf</font><font color="4444FF">-</font>32<font color="#2040a0">le</font><font color="#008000">':
                sys.stderr.write('</font><font color="#2040a0">trying</font> <font color="#2040a0">utf</font><font color="4444FF">-</font>32<font color="#2040a0">le</font> <font color="#2040a0">instead</font>\<font color="#2040a0">n</font><font color="#008000">')
        encoding = '</font><font color="#2040a0">utf</font><font color="4444FF">-</font>32<font color="#2040a0">le</font><font color="#008000">'
        data = data[4:]
    newdata = unicode(data, encoding)
    if _debug: sys.stderr.write('</font><font color="#2040a0">successfully</font> <font color="#2040a0">converted</font> <font color="4444FF">%</font><font color="#2040a0">s</font> <font color="#2040a0">data</font> <font color="#2040a0">to</font> <font color="#2040a0">unicode</font>\<font color="#2040a0">n</font><font color="#008000">' % encoding)
    declmatch = re.compile('</font>^<font color="4444FF">&lt;</font>\?<font color="#2040a0">xml</font><font color="4444FF">[</font>^<font color="4444FF">&gt;</font><font color="4444FF">]</font><font color="4444FF">*</font>?<font color="4444FF">&gt;</font><font color="#008000">')
    newdecl = &quot;&quot;&quot;&lt;?xml version='</font><font color="#FF0000">1.0</font><font color="#008000">' encoding='</font><font color="#2040a0">utf</font><font color="4444FF">-</font><font color="#FF0000">8</font><font color="#008000">'?&gt;&quot;&quot;&quot;
    if declmatch.search(newdata):
        newdata = declmatch.sub(newdecl, newdata)
    else:
        newdata = newdecl + u'</font>\<font color="#2040a0">n</font><font color="#008000">' + newdata
    return newdata.encode(&quot;utf-8&quot;)

def _stripDoctype(data):
    &quot;&quot;&quot;Strips DOCTYPE from XML document, returns (rss_version, stripped_data)

    rss_version may be &quot;rss091n&quot; or None
    stripped_data is the same XML document, minus the DOCTYPE
    &quot;&quot;&quot;
    entity_pattern = re.compile(r'</font><font color="4444FF">&lt;</font><font color="4444FF">!</font><font color="#2040a0">ENTITY</font><font color="4444FF">(</font><font color="4444FF">[</font>^<font color="4444FF">&gt;</font><font color="4444FF">]</font><font color="4444FF">*</font>?<font color="4444FF">)</font><font color="4444FF">&gt;</font><font color="#008000">', re.MULTILINE)
    data = entity_pattern.sub('</font><font color="#008000">', data)
    doctype_pattern = re.compile(r'</font><font color="4444FF">&lt;</font><font color="4444FF">!</font><font color="#2040a0">DOCTYPE</font><font color="4444FF">(</font><font color="4444FF">[</font>^<font color="4444FF">&gt;</font><font color="4444FF">]</font><font color="4444FF">*</font>?<font color="4444FF">)</font><font color="4444FF">&gt;</font><font color="#008000">', re.MULTILINE)
    doctype_results = doctype_pattern.findall(data)
    doctype = doctype_results and doctype_results[0] or '</font><font color="#008000">'
    if doctype.lower().count('</font><font color="#2040a0">netscape</font><font color="#008000">'):
        version = '</font><font color="#2040a0">rss091n</font><font color="#008000">'
    else:
        version = None
    data = doctype_pattern.sub('</font><font color="#008000">', data)
    return version, data
    
def parse(url_file_stream_or_string, etag=None, modified=None, agent=None, referrer=None, handlers=[]):
    &quot;&quot;&quot;Parse a feed from a URL, file, stream, or string&quot;&quot;&quot;
    result = FeedParserDict()
    result['</font><font color="#2040a0">feed</font><font color="#008000">'] = FeedParserDict()
    result['</font><font color="#2040a0">entries</font><font color="#008000">'] = []
    if _XML_AVAILABLE:
        result['</font><font color="#2040a0">bozo</font><font color="#008000">'] = 0
    if type(handlers) == types.InstanceType:
        handlers = [handlers]
    try:
        f = _open_resource(url_file_stream_or_string, etag, modified, agent, referrer, handlers)
        data = f.read()
    except Exception, e:
        result['</font><font color="#2040a0">bozo</font><font color="#008000">'] = 1
        result['</font><font color="#2040a0">bozo_exception</font><font color="#008000">'] = e
        data = '</font><font color="#008000">'
        f = None

    # if feed is gzip-compressed, decompress it
    if f and data and hasattr(f, &quot;headers&quot;):
        if gzip and f.headers.get('</font><font color="#2040a0">content</font><font color="4444FF">-</font><font color="#2040a0">encoding</font><font color="#008000">', '</font><font color="#008000">') == '</font><font color="#2040a0">gzip</font><font color="#008000">':
            try:
                data = gzip.GzipFile(fileobj=_StringIO(data)).read()
            except Exception, e:
                # Some feeds claim to be gzipped but they'</font><font color="#2040a0">re</font> <strong>not</strong>, <font color="#2040a0">so</font>
                <font color="#444444"># we get garbage.  Ideally, we should re-request the</font>
                <font color="#444444"># feed without the &quot;Accept-encoding: gzip&quot; header,</font>
                <font color="#444444"># but we don't.</font>
                <font color="#2040a0">result</font><font color="4444FF">[</font><font color="#008000">'bozo'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#FF0000">1</font>
                <font color="#2040a0">result</font><font color="4444FF">[</font><font color="#008000">'bozo_exception'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">e</font>
                <font color="#2040a0">data</font> <font color="4444FF">=</font> <font color="#008000">''</font>
        <strong>elif</strong> <font color="#2040a0">zlib</font> <strong>and</strong> <font color="#2040a0">f</font>.<font color="#2040a0">headers</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'content-encoding'</font>, <font color="#008000">''</font><font color="4444FF">)</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">'deflate'</font><font color="4444FF">:</font>
            <strong>try</strong><font color="4444FF">:</font>
                <font color="#2040a0">data</font> <font color="4444FF">=</font> <font color="#2040a0">zlib</font>.<font color="#2040a0">decompress</font><font color="4444FF">(</font><font color="#2040a0">data</font>, <font color="4444FF">-</font><font color="#2040a0">zlib</font>.<font color="#2040a0">MAX_WBITS</font><font color="4444FF">)</font>
            <strong>except</strong> <font color="#2040a0">Exception</font>, <font color="#2040a0">e</font><font color="4444FF">:</font>
                <font color="#2040a0">result</font><font color="4444FF">[</font><font color="#008000">'bozo'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#FF0000">1</font>
                <font color="#2040a0">result</font><font color="4444FF">[</font><font color="#008000">'bozo_exception'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">e</font>
                <font color="#2040a0">data</font> <font color="4444FF">=</font> <font color="#008000">''</font>

    <font color="#444444"># save HTTP headers</font>
    <strong>if</strong> <font color="#2040a0">hasattr</font><font color="4444FF">(</font><font color="#2040a0">f</font>, <font color="#008000">&quot;info&quot;</font><font color="4444FF">)</font><font color="4444FF">:</font>
        <font color="#2040a0">info</font> <font color="4444FF">=</font> <font color="#2040a0">f</font>.<font color="#2040a0">info</font><font color="4444FF">(</font><font color="4444FF">)</font>
        <font color="#2040a0">result</font><font color="4444FF">[</font><font color="#008000">&quot;etag&quot;</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">info</font>.<font color="#2040a0">getheader</font><font color="4444FF">(</font><font color="#008000">&quot;ETag&quot;</font><font color="4444FF">)</font>
        <font color="#2040a0">last_modified</font> <font color="4444FF">=</font> <font color="#2040a0">info</font>.<font color="#2040a0">getheader</font><font color="4444FF">(</font><font color="#008000">&quot;Last-Modified&quot;</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">last_modified</font><font color="4444FF">:</font>
            <font color="#2040a0">result</font><font color="4444FF">[</font><font color="#008000">&quot;modified&quot;</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">_parse_date</font><font color="4444FF">(</font><font color="#2040a0">last_modified</font><font color="4444FF">)</font>
    <strong>if</strong> <font color="#2040a0">hasattr</font><font color="4444FF">(</font><font color="#2040a0">f</font>, <font color="#008000">&quot;url&quot;</font><font color="4444FF">)</font><font color="4444FF">:</font>
        <font color="#2040a0">result</font><font color="4444FF">[</font><font color="#008000">&quot;url&quot;</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">f</font>.<font color="#2040a0">url</font>
        <font color="#2040a0">result</font><font color="4444FF">[</font><font color="#008000">&quot;status&quot;</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#FF0000">200</font>
    <strong>if</strong> <font color="#2040a0">hasattr</font><font color="4444FF">(</font><font color="#2040a0">f</font>, <font color="#008000">&quot;status&quot;</font><font color="4444FF">)</font><font color="4444FF">:</font>
        <font color="#2040a0">result</font><font color="4444FF">[</font><font color="#008000">&quot;status&quot;</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">f</font>.<font color="#2040a0">status</font>
    <strong>if</strong> <font color="#2040a0">hasattr</font><font color="4444FF">(</font><font color="#2040a0">f</font>, <font color="#008000">&quot;headers&quot;</font><font color="4444FF">)</font><font color="4444FF">:</font>
        <font color="#2040a0">result</font><font color="4444FF">[</font><font color="#008000">&quot;headers&quot;</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">f</font>.<font color="#2040a0">headers</font>.<font color="#2040a0">dict</font>
    <strong>if</strong> <font color="#2040a0">hasattr</font><font color="4444FF">(</font><font color="#2040a0">f</font>, <font color="#008000">&quot;close&quot;</font><font color="4444FF">)</font><font color="4444FF">:</font>
        <font color="#2040a0">f</font>.<font color="#2040a0">close</font><font color="4444FF">(</font><font color="4444FF">)</font>

    <font color="#444444"># there are four encodings to keep track of:</font>
    <font color="#444444"># - http_encoding is the encoding declared in the Content-Type HTTP header</font>
    <font color="#444444"># - xml_encoding is the encoding declared in the &lt;?xml declaration</font>
    <font color="#444444"># - sniffed_encoding is the encoding sniffed from the first 4 bytes of the XML data</font>
    <font color="#444444"># - result['encoding'] is the actual encoding, as per RFC 3023 and a variety of other conflicting specifications</font>
    <font color="#2040a0">http_headers</font> <font color="4444FF">=</font> <font color="#2040a0">result</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">&quot;headers&quot;</font>, <font color="4444FF"><strong>{</strong></font><font color="4444FF"><strong>}</strong></font><font color="4444FF">)</font>
    <font color="#2040a0">result</font><font color="4444FF">[</font><font color="#008000">'encoding'</font><font color="4444FF">]</font>, <font color="#2040a0">http_encoding</font>, <font color="#2040a0">xml_encoding</font>, <font color="#2040a0">sniffed_xml_encoding</font>, <font color="#2040a0">acceptable_content_type</font> <font color="4444FF">=</font> \
        <font color="#2040a0">_getCharacterEncoding</font><font color="4444FF">(</font><font color="#2040a0">http_headers</font>, <font color="#2040a0">data</font><font color="4444FF">)</font>
    <strong>if</strong> <font color="#2040a0">http_headers</font> <strong>and</strong> <font color="4444FF">(</font><strong>not</strong> <font color="#2040a0">acceptable_content_type</font><font color="4444FF">)</font><font color="4444FF">:</font>
        <strong>if</strong> <font color="#2040a0">http_headers</font>.<font color="#2040a0">has_key</font><font color="4444FF">(</font><font color="#008000">'content-type'</font><font color="4444FF">)</font><font color="4444FF">:</font>
            <font color="#2040a0">bozo_message</font> <font color="4444FF">=</font> <font color="#008000">'%s is not an XML media type'</font> <font color="4444FF">%</font> <font color="#2040a0">http_headers</font><font color="4444FF">[</font><font color="#008000">'content-type'</font><font color="4444FF">]</font>
        <strong>else</strong><font color="4444FF">:</font>
            <font color="#2040a0">bozo_message</font> <font color="4444FF">=</font> <font color="#008000">'no Content-type specified'</font>
        <font color="#2040a0">result</font><font color="4444FF">[</font><font color="#008000">'bozo'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#FF0000">1</font>
        <font color="#2040a0">result</font><font color="4444FF">[</font><font color="#008000">'bozo_exception'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">NonXMLContentType</font><font color="4444FF">(</font><font color="#2040a0">bozo_message</font><font color="4444FF">)</font>
        
    <font color="#2040a0">result</font><font color="4444FF">[</font><font color="#008000">'version'</font><font color="4444FF">]</font>, <font color="#2040a0">data</font> <font color="4444FF">=</font> <font color="#2040a0">_stripDoctype</font><font color="4444FF">(</font><font color="#2040a0">data</font><font color="4444FF">)</font>

    <font color="#2040a0">baseuri</font> <font color="4444FF">=</font> <font color="#2040a0">http_headers</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'content-location'</font>, <font color="#2040a0">result</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'url'</font><font color="4444FF">)</font><font color="4444FF">)</font>
    <font color="#2040a0">baselang</font> <font color="4444FF">=</font> <font color="#2040a0">http_headers</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">'content-language'</font>, <font color="#2040a0">None</font><font color="4444FF">)</font>

    <font color="#444444"># if server sent 304, we're done</font>
    <strong>if</strong> <font color="#2040a0">result</font>.<font color="#2040a0">get</font><font color="4444FF">(</font><font color="#008000">&quot;status&quot;</font>, <font color="#FF0000">0</font><font color="4444FF">)</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#FF0000">304</font><font color="4444FF">:</font>
        <font color="#2040a0">result</font><font color="4444FF">[</font><font color="#008000">'version'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#008000">''</font>
        <font color="#2040a0">result</font><font color="4444FF">[</font><font color="#008000">'debug_message'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#008000">&quot;The feed has not changed since you last checked, &quot;</font> <font color="4444FF">+</font> \
            <font color="#008000">&quot;so the server sent no data.  This is a feature, not a bug!&quot;</font>
        <strong>return</strong> <font color="#2040a0">result</font>

    <font color="#444444"># if there was a problem downloading, we're done</font>
    <strong>if</strong> <strong>not</strong> <font color="#2040a0">data</font><font color="4444FF">:</font>
        <strong>return</strong> <font color="#2040a0">result</font>

    <font color="#444444"># determine character encoding</font>
    <font color="#2040a0">use_strict_parser</font> <font color="4444FF">=</font> <font color="#FF0000">0</font>
    <font color="#2040a0">known_encoding</font> <font color="4444FF">=</font> <font color="#FF0000">0</font>
    <font color="#2040a0">tried_encodings</font> <font color="4444FF">=</font> <font color="4444FF">[</font><font color="4444FF">]</font>
    <strong>for</strong> <font color="#2040a0">proposed_encoding</font> <strong>in</strong> <font color="4444FF">(</font><font color="#2040a0">result</font><font color="4444FF">[</font><font color="#008000">'encoding'</font><font color="4444FF">]</font>, <font color="#2040a0">xml_encoding</font>, <font color="#2040a0">sniffed_xml_encoding</font>, <font color="#008000">'utf-8'</font>, <font color="#008000">'windows-1252'</font><font color="4444FF">)</font><font color="4444FF">:</font>
        <strong>if</strong> <font color="#2040a0">proposed_encoding</font> <strong>in</strong> <font color="#2040a0">tried_encodings</font><font color="4444FF">:</font> <strong>continue</strong>
        <strong>if</strong> <strong>not</strong> <font color="#2040a0">proposed_encoding</font><font color="4444FF">:</font> <strong>continue</strong>
        <strong>try</strong><font color="4444FF">:</font>
            <font color="#2040a0">data</font> <font color="4444FF">=</font> <font color="#2040a0">_toUTF8</font><font color="4444FF">(</font><font color="#2040a0">data</font>, <font color="#2040a0">proposed_encoding</font><font color="4444FF">)</font>
            <font color="#2040a0">known_encoding</font> <font color="4444FF">=</font> <font color="#FF0000">1</font>
            <font color="#2040a0">use_strict_parser</font> <font color="4444FF">=</font> <font color="#FF0000">1</font>
            <strong>break</strong>
        <strong>except</strong><font color="4444FF">:</font>
            <strong>pass</strong>
        <font color="#2040a0">tried_encodings</font>.<font color="#2040a0">append</font><font color="4444FF">(</font><font color="#2040a0">proposed_encoding</font><font color="4444FF">)</font>
    <strong>if</strong> <strong>not</strong> <font color="#2040a0">known_encoding</font><font color="4444FF">:</font>
        <font color="#2040a0">result</font><font color="4444FF">[</font><font color="#008000">'bozo'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#FF0000">1</font>
        <font color="#2040a0">result</font><font color="4444FF">[</font><font color="#008000">'bozo_exception'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">CharacterEncodingUnknown</font><font color="4444FF">(</font> \
            <font color="#008000">&quot;document encoding unknown, I tried &quot;</font> <font color="4444FF">+</font> \
            <font color="#008000">&quot;%s, %s, utf-8, and windows-1252 but nothing worked&quot;</font> <font color="4444FF">%</font> \
            <font color="4444FF">(</font><font color="#2040a0">result</font><font color="4444FF">[</font><font color="#008000">'encoding'</font><font color="4444FF">]</font>, <font color="#2040a0">xml_encoding</font><font color="4444FF">)</font><font color="4444FF">)</font>
        <font color="#2040a0">result</font><font color="4444FF">[</font><font color="#008000">'encoding'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#008000">''</font>
    <strong>elif</strong> <font color="#2040a0">proposed_encoding</font> <font color="4444FF">!</font><font color="4444FF">=</font> <font color="#2040a0">result</font><font color="4444FF">[</font><font color="#008000">'encoding'</font><font color="4444FF">]</font><font color="4444FF">:</font>
        <font color="#2040a0">result</font><font color="4444FF">[</font><font color="#008000">'bozo'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#FF0000">1</font>
        <font color="#2040a0">result</font><font color="4444FF">[</font><font color="#008000">'bozo_exception'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">CharacterEncodingOverride</font><font color="4444FF">(</font> \
            <font color="#008000">&quot;documented declared as %s, but parsed as %s&quot;</font> <font color="4444FF">%</font> \
            <font color="4444FF">(</font><font color="#2040a0">result</font><font color="4444FF">[</font><font color="#008000">'encoding'</font><font color="4444FF">]</font>, <font color="#2040a0">proposed_encoding</font><font color="4444FF">)</font><font color="4444FF">)</font>
        <font color="#2040a0">result</font><font color="4444FF">[</font><font color="#008000">'encoding'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">proposed_encoding</font>

    <strong>if</strong> <strong>not</strong> <font color="#2040a0">_XML_AVAILABLE</font><font color="4444FF">:</font>
        <font color="#2040a0">use_strict_parser</font> <font color="4444FF">=</font> <font color="#FF0000">0</font>
    <strong>if</strong> <font color="#2040a0">use_strict_parser</font><font color="4444FF">:</font>
        <font color="#444444"># initialize the SAX parser</font>
        <font color="#2040a0">feedparser</font> <font color="4444FF">=</font> <font color="#2040a0">_StrictFeedParser</font><font color="4444FF">(</font><font color="#2040a0">baseuri</font>, <font color="#2040a0">baselang</font>, <font color="#008000">'utf-8'</font><font color="4444FF">)</font>
        <font color="#2040a0">saxparser</font> <font color="4444FF">=</font> <font color="#2040a0">xml</font>.<font color="#2040a0">sax</font>.<font color="#2040a0">make_parser</font><font color="4444FF">(</font><font color="#2040a0">PREFERRED_XML_PARSERS</font><font color="4444FF">)</font>
        <font color="#2040a0">saxparser</font>.<font color="#2040a0">setFeature</font><font color="4444FF">(</font><font color="#2040a0">xml</font>.<font color="#2040a0">sax</font>.<font color="#2040a0">handler</font>.<font color="#2040a0">feature_namespaces</font>, <font color="#FF0000">1</font><font color="4444FF">)</font>
        <font color="#2040a0">saxparser</font>.<font color="#2040a0">setContentHandler</font><font color="4444FF">(</font><font color="#2040a0">feedparser</font><font color="4444FF">)</font>
        <font color="#2040a0">saxparser</font>.<font color="#2040a0">setErrorHandler</font><font color="4444FF">(</font><font color="#2040a0">feedparser</font><font color="4444FF">)</font>
        <font color="#2040a0">source</font> <font color="4444FF">=</font> <font color="#2040a0">xml</font>.<font color="#2040a0">sax</font>.<font color="#2040a0">xmlreader</font>.<font color="#2040a0">InputSource</font><font color="4444FF">(</font><font color="4444FF">)</font>
        <font color="#2040a0">source</font>.<font color="#2040a0">setByteStream</font><font color="4444FF">(</font><font color="#2040a0">_StringIO</font><font color="4444FF">(</font><font color="#2040a0">data</font><font color="4444FF">)</font><font color="4444FF">)</font>
        <strong>if</strong> <font color="#2040a0">hasattr</font><font color="4444FF">(</font><font color="#2040a0">saxparser</font>, <font color="#008000">'_ns_stack'</font><font color="4444FF">)</font><font color="4444FF">:</font>
            <font color="#444444"># work around bug in built-in SAX parser (doesn't recognize xml: namespace)</font>
            <font color="#444444"># PyXML doesn't have this problem, and it doesn't have _ns_stack either</font>
            <font color="#2040a0">saxparser</font>.<font color="#2040a0">_ns_stack</font>.<font color="#2040a0">append</font><font color="4444FF">(</font><font color="4444FF"><strong>{</strong></font><font color="#008000">'http://www.w3.org/XML/1998/namespace'</font><font color="4444FF">:</font><font color="#008000">'xml'</font><font color="4444FF"><strong>}</strong></font><font color="4444FF">)</font>
        <strong>try</strong><font color="4444FF">:</font>
            <font color="#2040a0">saxparser</font>.<font color="#2040a0">parse</font><font color="4444FF">(</font><font color="#2040a0">source</font><font color="4444FF">)</font>
        <strong>except</strong> <font color="#2040a0">Exception</font>, <font color="#2040a0">e</font><font color="4444FF">:</font>
            <strong>if</strong> <font color="#2040a0">_debug</font><font color="4444FF">:</font>
                <strong>import</strong> <font color="#2040a0">traceback</font>
                <font color="#2040a0">traceback</font>.<font color="#2040a0">print_stack</font><font color="4444FF">(</font><font color="4444FF">)</font>
                <font color="#2040a0">traceback</font>.<font color="#2040a0">print_exc</font><font color="4444FF">(</font><font color="4444FF">)</font>
                <font color="#2040a0">sys</font>.<font color="#2040a0">stderr</font>.<font color="#2040a0">write</font><font color="4444FF">(</font><font color="#008000">'xml parsing failed\n'</font><font color="4444FF">)</font>
            <font color="#2040a0">result</font><font color="4444FF">[</font><font color="#008000">'bozo'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#FF0000">1</font>
            <font color="#2040a0">result</font><font color="4444FF">[</font><font color="#008000">'bozo_exception'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">feedparser</font>.<font color="#2040a0">exc</font> <strong>or</strong> <font color="#2040a0">e</font>
            <font color="#2040a0">use_strict_parser</font> <font color="4444FF">=</font> <font color="#FF0000">0</font>
    <strong>if</strong> <strong>not</strong> <font color="#2040a0">use_strict_parser</font><font color="4444FF">:</font>
        <font color="#2040a0">feedparser</font> <font color="4444FF">=</font> <font color="#2040a0">_LooseFeedParser</font><font color="4444FF">(</font><font color="#2040a0">baseuri</font>, <font color="#2040a0">baselang</font>, <font color="#2040a0">known_encoding</font> <strong>and</strong> <font color="#008000">'utf-8'</font> <strong>or</strong> <font color="#008000">''</font><font color="4444FF">)</font>
        <font color="#2040a0">feedparser</font>.<font color="#2040a0">feed</font><font color="4444FF">(</font><font color="#2040a0">data</font><font color="4444FF">)</font>
    <font color="#2040a0">result</font><font color="4444FF">[</font><font color="#008000">'feed'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">feedparser</font>.<font color="#2040a0">feeddata</font>
    <font color="#2040a0">result</font><font color="4444FF">[</font><font color="#008000">'entries'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">feedparser</font>.<font color="#2040a0">entries</font>
    <font color="#2040a0">result</font><font color="4444FF">[</font><font color="#008000">'version'</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#2040a0">result</font><font color="4444FF">[</font><font color="#008000">'version'</font><font color="4444FF">]</font> <strong>or</strong> <font color="#2040a0">feedparser</font>.<font color="#2040a0">version</font>
    <strong>return</strong> <font color="#2040a0">result</font>

<strong>if</strong> <font color="#2040a0">__name__</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#008000">'__main__'</font><font color="4444FF">:</font>
    <strong>if</strong> <strong>not</strong> <font color="#2040a0">sys</font>.<font color="#2040a0">argv</font><font color="4444FF">[</font><font color="#FF0000">1</font><font color="4444FF">:</font><font color="4444FF">]</font><font color="4444FF">:</font>
        <strong>print</strong> <font color="#2040a0">__doc__</font>
        <font color="#2040a0">sys</font>.<font color="#2040a0">exit</font><font color="4444FF">(</font><font color="#FF0000">0</font><font color="4444FF">)</font>
    <strong>else</strong><font color="4444FF">:</font>
        <font color="#2040a0">urls</font> <font color="4444FF">=</font> <font color="#2040a0">sys</font>.<font color="#2040a0">argv</font><font color="4444FF">[</font><font color="#FF0000">1</font><font color="4444FF">:</font><font color="4444FF">]</font>
    <font color="#2040a0">zopeCompatibilityHack</font><font color="4444FF">(</font><font color="4444FF">)</font>
    <strong>from</strong> <font color="#2040a0">pprint</font> <strong>import</strong> <font color="#2040a0">pprint</font>
    <strong>for</strong> <font color="#2040a0">url</font> <strong>in</strong> <font color="#2040a0">urls</font><font color="4444FF">:</font>
        <strong>print</strong> <font color="#2040a0">url</font>
        <strong>print</strong>
        <font color="#2040a0">result</font> <font color="4444FF">=</font> <font color="#2040a0">parse</font><font color="4444FF">(</font><font color="#2040a0">url</font><font color="4444FF">)</font>
        <font color="#2040a0">pprint</font><font color="4444FF">(</font><font color="#2040a0">result</font><font color="4444FF">)</font>
        <strong>print</strong>

<font color="#444444">#REVISION HISTORY</font>
<font color="#444444">#1.0 - 9/27/2002 - MAP - fixed namespace processing on prefixed RSS 2.0 elements,</font>
<font color="#444444">#  added Simon Fell's test suite</font>
<font color="#444444">#1.1 - 9/29/2002 - MAP - fixed infinite loop on incomplete CDATA sections</font>
<font color="#444444">#2.0 - 10/19/2002</font>
<font color="#444444">#  JD - use inchannel to watch out for image and textinput elements which can</font>
<font color="#444444">#  also contain title, link, and description elements</font>
<font color="#444444">#  JD - check for isPermaLink=&quot;false&quot; attribute on guid elements</font>
<font color="#444444">#  JD - replaced openAnything with open_resource supporting ETag and</font>
<font color="#444444">#  If-Modified-Since request headers</font>
<font color="#444444">#  JD - parse now accepts etag, modified, agent, and referrer optional</font>
<font color="#444444">#  arguments</font>
<font color="#444444">#  JD - modified parse to return a dictionary instead of a tuple so that any</font>
<font color="#444444">#  etag or modified information can be returned and cached by the caller</font>
<font color="#444444">#2.0.1 - 10/21/2002 - MAP - changed parse() so that if we don't get anything</font>
<font color="#444444">#  because of etag/modified, return the old etag/modified to the caller to</font>
<font color="#444444">#  indicate why nothing is being returned</font>
<font color="#444444">#2.0.2 - 10/21/2002 - JB - added the inchannel to the if statement, otherwise its</font>
<font color="#444444">#  useless.  Fixes the problem JD was addressing by adding it.</font>
<font color="#444444">#2.1 - 11/14/2002 - MAP - added gzip support</font>
<font color="#444444">#2.2 - 1/27/2003 - MAP - added attribute support, admin:generatorAgent.</font>
<font color="#444444">#  start_admingeneratoragent is an example of how to handle elements with</font>
<font color="#444444">#  only attributes, no content.</font>
<font color="#444444">#2.3 - 6/11/2003 - MAP - added USER_AGENT for default (if caller doesn't specify);</font>
<font color="#444444">#  also, make sure we send the User-Agent even if urllib2 isn't available.</font>
<font color="#444444">#  Match any variation of backend.userland.com/rss namespace.</font>
<font color="#444444">#2.3.1 - 6/12/2003 - MAP - if item has both link and guid, return both as-is.</font>
<font color="#444444">#2.4 - 7/9/2003 - MAP - added preliminary Pie/Atom/Echo support based on Sam Ruby's</font>
<font color="#444444">#  snapshot of July 1 &lt;http://www.intertwingly.net/blog/1506.html&gt;; changed</font>
<font color="#444444">#  project name</font>
<font color="#444444">#2.5 - 7/25/2003 - MAP - changed to Python license (all contributors agree);</font>
<font color="#444444">#  removed unnecessary urllib code -- urllib2 should always be available anyway;</font>
<font color="#444444">#  return actual url, status, and full HTTP headers (as result['url'],</font>
<font color="#444444">#  result['status'], and result['headers']) if parsing a remote feed over HTTP --</font>
<font color="#444444">#  this should pass all the HTTP tests at &lt;http://diveintomark.org/tests/client/http/&gt;;</font>
<font color="#444444">#  added the latest namespace-of-the-week for RSS 2.0</font>
<font color="#444444">#2.5.1 - 7/26/2003 - RMK - clear opener.addheaders so we only send our custom</font>
<font color="#444444">#  User-Agent (otherwise urllib2 sends two, which confuses some servers)</font>
<font color="#444444">#2.5.2 - 7/28/2003 - MAP - entity-decode inline xml properly; added support for</font>
<font color="#444444">#  inline &lt;xhtml:body&gt; and &lt;xhtml:div&gt; as used in some RSS 2.0 feeds</font>
<font color="#444444">#2.5.3 - 8/6/2003 - TvdV - patch to track whether we're inside an image or</font>
<font color="#444444">#  textInput, and also to return the character encoding (if specified)</font>
<font color="#444444">#2.6 - 1/1/2004 - MAP - dc:author support (MarekK); fixed bug tracking</font>
<font color="#444444">#  nested divs within content (JohnD); fixed missing sys import (JohanS);</font>
<font color="#444444">#  fixed regular expression to capture XML character encoding (Andrei);</font>
<font color="#444444">#  added support for Atom 0.3-style links; fixed bug with textInput tracking;</font>
<font color="#444444">#  added support for cloud (MartijnP); added support for multiple</font>
<font color="#444444">#  category/dc:subject (MartijnP); normalize content model: &quot;description&quot; gets</font>
<font color="#444444">#  description (which can come from description, summary, or full content if no</font>
<font color="#444444">#  description), &quot;content&quot; gets dict of base/language/type/value (which can come</font>
<font color="#444444">#  from content:encoded, xhtml:body, content, or fullitem);</font>
<font color="#444444">#  fixed bug matching arbitrary Userland namespaces; added xml:base and xml:lang</font>
<font color="#444444">#  tracking; fixed bug tracking unknown tags; fixed bug tracking content when</font>
<font color="#444444">#  &lt;content&gt; element is not in default namespace (like Pocketsoap feed);</font>
<font color="#444444">#  resolve relative URLs in link, guid, docs, url, comments, wfw:comment,</font>
<font color="#444444">#  wfw:commentRSS; resolve relative URLs within embedded HTML markup in</font>
<font color="#444444">#  description, xhtml:body, content, content:encoded, title, subtitle,</font>
<font color="#444444">#  summary, info, tagline, and copyright; added support for pingback and</font>
<font color="#444444">#  trackback namespaces</font>
<font color="#444444">#2.7 - 1/5/2004 - MAP - really added support for trackback and pingback</font>
<font color="#444444">#  namespaces, as opposed to 2.6 when I said I did but didn't really;</font>
<font color="#444444">#  sanitize HTML markup within some elements; added mxTidy support (if</font>
<font color="#444444">#  installed) to tidy HTML markup within some elements; fixed indentation</font>
<font color="#444444">#  bug in _parse_date (FazalM); use socket.setdefaulttimeout if available</font>
<font color="#444444">#  (FazalM); universal date parsing and normalization (FazalM): 'created', modified',</font>
<font color="#444444">#  'issued' are parsed into 9-tuple date format and stored in 'created_parsed',</font>
<font color="#444444">#  'modified_parsed', and 'issued_parsed'; 'date' is duplicated in 'modified'</font>
<font color="#444444">#  and vice-versa; 'date_parsed' is duplicated in 'modified_parsed' and vice-versa</font>
<font color="#444444">#2.7.1 - 1/9/2004 - MAP - fixed bug handling &amp;quot; and &amp;apos;.  fixed memory</font>
<font color="#444444">#  leak not closing url opener (JohnD); added dc:publisher support (MarekK);</font>
<font color="#444444">#  added admin:errorReportsTo support (MarekK); Python 2.1 dict support (MarekK)</font>
<font color="#444444">#2.7.4 - 1/14/2004 - MAP - added workaround for improperly formed &lt;br/&gt; tags in</font>
<font color="#444444">#  encoded HTML (skadz); fixed unicode handling in normalize_attrs (ChrisL);</font>
<font color="#444444">#  fixed relative URI processing for guid (skadz); added ICBM support; added</font>
<font color="#444444">#  base64 support</font>
<font color="#444444">#2.7.5 - 1/15/2004 - MAP - added workaround for malformed DOCTYPE (seen on many</font>
<font color="#444444">#  blogspot.com sites); added _debug variable</font>
<font color="#444444">#2.7.6 - 1/16/2004 - MAP - fixed bug with StringIO importing</font>
<font color="#444444">#3.0b3 - 1/23/2004 - MAP - parse entire feed with real XML parser (if available);</font>
<font color="#444444">#  added several new supported namespaces; fixed bug tracking naked markup in</font>
<font color="#444444">#  description; added support for enclosure; added support for source; re-added</font>
<font color="#444444">#  support for cloud which got dropped somehow; added support for expirationDate</font>
<font color="#444444">#3.0b4 - 1/26/2004 - MAP - fixed xml:lang inheritance; fixed multiple bugs tracking</font>
<font color="#444444">#  xml:base URI, one for documents that don't define one explicitly and one for</font>
<font color="#444444">#  documents that define an outer and an inner xml:base that goes out of scope</font>
<font color="#444444">#  before the end of the document</font>
<font color="#444444">#3.0b5 - 1/26/2004 - MAP - fixed bug parsing multiple links at feed level</font>
<font color="#444444">#3.0b6 - 1/27/2004 - MAP - added feed type and version detection, result[&quot;version&quot;]</font>
<font color="#444444">#  will be one of SUPPORTED_VERSIONS.keys() or empty string if unrecognized;</font>
<font color="#444444">#  added support for creativeCommons:license and cc:license; added support for</font>
<font color="#444444">#  full Atom content model in title, tagline, info, copyright, summary; fixed bug</font>
<font color="#444444">#  with gzip encoding (not always telling server we support it when we do)</font>
<font color="#444444">#3.0b7 - 1/28/2004 - MAP - support Atom-style author element in author_detail</font>
<font color="#444444">#  (dictionary of &quot;name&quot;, &quot;url&quot;, &quot;email&quot;); map author to author_detail if author</font>
<font color="#444444">#  contains name + email address</font>
<font color="#444444">#3.0b8 - 1/28/2004 - MAP - added support for contributor</font>
<font color="#444444">#3.0b9 - 1/29/2004 - MAP - fixed check for presence of dict function; added</font>
<font color="#444444">#  support for summary</font>
<font color="#444444">#3.0b10 - 1/31/2004 - MAP - incorporated ISO-8601 date parsing routines from</font>
<font color="#444444">#  xml.util.iso8601</font>
<font color="#444444">#3.0b11 - 2/2/2004 - MAP - added 'rights' to list of elements that can contain</font>
<font color="#444444">#  dangerous markup; fiddled with decodeEntities (not right); liberalized</font>
<font color="#444444">#  date parsing even further</font>
<font color="#444444">#3.0b12 - 2/6/2004 - MAP - fiddled with decodeEntities (still not right);</font>
<font color="#444444">#  added support to Atom 0.2 subtitle; added support for Atom content model</font>
<font color="#444444">#  in copyright; better sanitizing of dangerous HTML elements with end tags</font>
<font color="#444444">#  (script, frameset)</font>
<font color="#444444">#3.0b13 - 2/8/2004 - MAP - better handling of empty HTML tags (br, hr, img,</font>
<font color="#444444">#  etc.) in embedded markup, in either HTML or XHTML form (&lt;br&gt;, &lt;br/&gt;, &lt;br /&gt;)</font>
<font color="#444444">#3.0b14 - 2/8/2004 - MAP - fixed CDATA handling in non-wellformed feeds under</font>
<font color="#444444">#  Python 2.1</font>
<font color="#444444">#3.0b15 - 2/11/2004 - MAP - fixed bug resolving relative links in wfw:commentRSS;</font>
<font color="#444444">#  fixed bug capturing author and contributor URL; fixed bug resolving relative</font>
<font color="#444444">#  links in author and contributor URL; fixed bug resolvin relative links in</font>
<font color="#444444">#  generator URL; added support for recognizing RSS 1.0; passed Simon Fell's</font>
<font color="#444444">#  namespace tests, and included them permanently in the test suite with his</font>
<font color="#444444">#  permission; fixed namespace handling under Python 2.1</font>
<font color="#444444">#3.0b16 - 2/12/2004 - MAP - fixed support for RSS 0.90 (broken in b15)</font>
<font color="#444444">#3.0b17 - 2/13/2004 - MAP - determine character encoding as per RFC 3023</font>
<font color="#444444">#3.0b18 - 2/17/2004 - MAP - always map description to summary_detail (Andrei);</font>
<font color="#444444">#  use libxml2 (if available)</font>
<font color="#444444">#3.0b19 - 3/15/2004 - MAP - fixed bug exploding author information when author</font>
<font color="#444444">#  name was in parentheses; removed ultra-problematic mxTidy support; patch to</font>
<font color="#444444">#  workaround crash in PyXML/expat when encountering invalid entities</font>
<font color="#444444">#  (MarkMoraes); support for textinput/textInput</font>
<font color="#444444">#3.0b20 - 4/7/2004 - MAP - added CDF support</font>
<font color="#444444">#3.0b21 - 4/14/2004 - MAP - added Hot RSS support</font>
<font color="#444444">#3.0b22 - 4/19/2004 - MAP - changed 'channel' to 'feed', 'item' to 'entries' in</font>
<font color="#444444">#  results dict; changed results dict to allow getting values with results.key</font>
<font color="#444444">#  as well as results[key]; work around embedded illformed HTML with half</font>
<font color="#444444">#  a DOCTYPE; work around malformed Content-Type header; if character encoding</font>
<font color="#444444">#  is wrong, try several common ones before falling back to regexes (if this</font>
<font color="#444444">#  works, bozo_exception is set to CharacterEncodingOverride); fixed character</font>
<font color="#444444">#  encoding issues in BaseHTMLProcessor by tracking encoding and converting</font>
<font color="#444444">#  from Unicode to raw strings before feeding data to sgmllib.SGMLParser;</font>
<font color="#444444">#  convert each value in results to Unicode (if possible), even if using</font>
<font color="#444444">#  regex-based parsing</font>
<font color="#444444">#3.0b23 - 4/21/2004 - MAP - fixed UnicodeDecodeError for feeds that contain</font>
<font color="#444444">#  high-bit characters in attributes in embedded HTML in description (thanks</font>
<font color="#444444">#  Thijs van de Vossen); moved guid, date, and date_parsed to mapped keys in</font>
<font color="#444444">#  FeedParserDict; tweaked FeedParserDict.has_key to return True if asking</font>
<font color="#444444">#  about a mapped key</font>
<font color="#444444">#3.0fc1 - 4/23/2004 - MAP - made results.entries[0].links[0] and</font>
<font color="#444444">#  results.entries[0].enclosures[0] into FeedParserDict; fixed typo that could</font>
<font color="#444444">#  cause the same encoding to be tried twice (even if it failed the first time);</font>
<font color="#444444">#  fixed DOCTYPE stripping when DOCTYPE contained entity declarations;</font>
<font color="#444444">#  better textinput and image tracking in illformed RSS 1.0 feeds</font>
<font color="#444444">#3.0fc2 - 5/10/2004 - MAP - added and passed Sam's amp tests; added and passed</font>
<font color="#444444">#  my blink tag tests</font>
<font color="#444444">#3.0fc3 - 6/18/2004 - MAP - fixed bug in _changeEncodingDeclaration that</font>
<font color="#444444">#  failed to parse utf-16 encoded feeds; made source into a FeedParserDict;</font>
<font color="#444444">#  duplicate admin:generatorAgent/@rdf:resource in generator_detail.url;</font>
<font color="#444444">#  added support for image; refactored parse() fallback logic to try other</font>
<font color="#444444">#  encodings if SAX parsing fails (previously it would only try other encodings</font>
<font color="#444444">#  if re-encoding failed); remove unichr madness in normalize_attrs now that</font>
<font color="#444444">#  we're properly tracking encoding in and out of BaseHTMLProcessor; set</font>
<font color="#444444">#  feed.language from root-level xml:lang; set entry.id from rdf:about;</font>
<font color="#444444">#  send Accept header</font>
<font color="#444444">#3.0 - 6/21/2004 - MAP - don't try iso-8859-1 (can't distinguish between</font>
<font color="#444444">#  iso-8859-1 and windows-1252 anyway, and most incorrectly marked feeds are</font>
<font color="#444444">#  windows-1252); fixed regression that could cause the same encoding to be</font>
<font color="#444444">#  tried twice (even if it failed the first time)</font>
<font color="#444444">#3.0.1 - 6/22/2004 - MAP - default to us-ascii for all text/* content types;</font>
<font color="#444444">#  recover from malformed content-type header parameter with no equals sign</font>
<font color="#444444">#  (&quot;text/xml; charset:iso-8859-1&quot;)</font>
<font color="#444444">#3.1 - 6/28/2004 - MAP - added and passed tests for converting HTML entities</font>
<font color="#444444">#  to Unicode equivalents in illformed feeds (aaronsw); added and</font>
<font color="#444444">#  passed tests for converting character entities to Unicode equivalents</font>
<font color="#444444">#  in illformed feeds (aaronsw); test for valid parsers when setting</font>
<font color="#444444">#  XML_AVAILABLE; make version and encoding available when server returns</font>
<font color="#444444">#  a 304; add handlers parameter to pass arbitrary urllib2 handlers (like</font>
<font color="#444444">#  digest auth or proxy support); add code to parse username/password</font>
<font color="#444444">#  out of url and send as basic authentication; expose downloading-related</font>
<font color="#444444">#  exceptions in bozo_exception (aaronsw); added __contains__ method to</font>
<font color="#444444">#  FeedParserDict (aaronsw); added publisher_detail (aaronsw)</font>
<font color="#444444">#3.2 - 7/3/2004 - MAP - use cjkcodecs and iconv_codec if available; always</font>
<font color="#444444">#  convert feed to UTF-8 before passing to XML parser; completely revamped</font>
<font color="#444444">#  logic for determining character encoding and attempting XML parsing</font>
<font color="#444444">#  (much faster); increased default timeout to 20 seconds; test for presence</font>
<font color="#444444">#  of Location header on redirects; added tests for many alternate character</font>
<font color="#444444">#  encodings; support various EBCDIC encodings; support UTF-16BE and</font>
<font color="#444444">#  UTF16-LE with or without a BOM; support UTF-8 with a BOM; support</font>
<font color="#444444">#  UTF-32BE and UTF-32LE with or without a BOM; fixed crashing bug if no</font>
<font color="#444444">#  XML parsers are available; added support for &quot;Content-encoding: deflate&quot;;</font>
<font color="#444444">#  send blank &quot;Accept-encoding: &quot; header if neither gzip nor zlib modules</font>
<font color="#444444">#  are available</font>
<font color="#444444">#3.3 - 7/15/2004 - MAP - optimize EBCDIC to ASCII conversion; fix obscure</font>
<font color="#444444">#  problem tracking xml:base and xml:lang if element declares it, child</font>
<font color="#444444">#  doesn't, first grandchild redeclares it, and second grandchild doesn't;</font>
<font color="#444444">#  refactored date parsing; defined public registerDateHandler so callers</font>
<font color="#444444">#  can add support for additional date formats at runtime; added support</font>
<font color="#444444">#  for OnBlog, Nate, MSSQL, Greek, and Hungarian dates (ytrewq1); added</font>
<font color="#444444">#  zopeCompatibilityHack() which turns FeedParserDict into a regular</font>
<font color="#444444">#  dictionary, required for Zope compatibility, and also makes command-</font>
<font color="#444444">#  line debugging easier because pprint module formats real dictionaries</font>
<font color="#444444">#  better than dictionary-like objects; added NonXMLContentType exception,</font>
<font color="#444444">#  which is stored in bozo_exception when a feed is served with a non-XML</font>
<font color="#444444">#  media type such as &quot;text/plain&quot;; respect Content-Language as default</font>
<font color="#444444">#  language if not xml:lang is present; cloud dict is now FeedParserDict;</font>
<font color="#444444">#  generator dict is now FeedParserDict; better tracking of xml:lang,</font>
<font color="#444444">#  including support for xml:lang=&quot;&quot; to unset the current language;</font>
<font color="#444444">#  recognize RSS 1.0 feeds even when RSS 1.0 namespace is not the default</font>
<font color="#444444">#  namespace; don't overwrite final status on redirects (scenarios:</font>
<font color="#444444">#  redirecting to a URL that returns 304, redirecting to a URL that</font>
<font color="#444444">#  redirects to another URL with a different type of redirect); add</font>
<font color="#444444">#  support for HTTP 303 redirects</font>

</pre>
<hr>
syntax highlighted by <a href="http://www.palfrader.org/code2html">Code2HTML</a>, v. 0.9.1
</body>
</html>
